<!DOCTYPE html>

<html lang="en">
<head>
  <link rel="manifest" href="manifest.json">
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Blokjesspel met Levens</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+Bhaina+2&amp;display=swap" rel="stylesheet"/>
<style>

@keyframes fromTop {
  from { transform: translateY(-100vh); opacity: 0; }
  to   { transform: translateY(0); opacity: 1; }
}
@keyframes fromRight {
  from { transform: translateX(100vw); opacity: 0; }
  to   { transform: translateX(0); opacity: 1; }
}
@keyframes fromBottom {
  from { transform: translateY(100vh); opacity: 0; }
  to   { transform: translateY(0); opacity: 1; }
}
@keyframes fromLeft {
  from { transform: translateX(-100vw); opacity: 0; }
  to   { transform: translateX(0); opacity: 1; }
}
.start-button {
  opacity: 0;
  position: relative;
  animation-fill-mode: forwards;
}


html, body {
  /*background-color: black;
  background-color: #e3e1dc;*/
background-color: #c9a878;


  background-size: cover;
  color: white;
  font-family: sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100vh;
  overflow: hidden;
  margin: 0;
  padding: 0;
}


body {
  /*background-color: black;*/
  background-color: #c9a878;
  background-size: cover;
  color: white;
  font-family: sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100vh;
  overflow: hidden;
  margin: 0;
  padding: 0;
}

/* het volledige scherm */

/*#continueButton {
  display: none;
}
*/

#container {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  max-width: 1500px;
  flex-grow: 1;
  overflow: hidden;
  /* NAKIJKEN*/
  /*height: calc(100vh - 240px);*/
  height: calc(100vh);
}

.orange-line.top-line {
  position: absolute;
  top: 22vh;
  height: 0px;
  width: 100%;
  background-color: #e88a2d;
  z-index: 10;
}

.orange-line.bottom-line {
  position: absolute;
  top: 75.5vh; 
  height: 0px;
  width: 100%;
  background-color: #e88a2d;
  z-index: 10;
}

/* het speelveld */

.canvas-wrapper {
  
  width: 100%;
  max-width: 100%;
  height: auto;  
  display: flex;
  justify-content: center;
  position: relative;
  top: 1.5vh;
  height: 51vh;
  align-items: center;
}

.gameCanvas {
  height: 100%;
  aspect-ratio: 1 / 1;
  width: auto; /* hierdoor past breedte zich aan aan hoogte */
  display: block;
   /*background-color: black;
    background-color: #e3e1dc;*/
background-color: #c9a878;
}

.backgroundLayer {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;

   /* achtergrond tweede scherm background: url('https://iili.io/3hoKrlI.png') no-repeat center center;
  background: url('https://i.ibb.co/vxvcWzd7/Feestelijke-karakters-in-levendige-outfits-1.png') no-repeat center center;
  background: url('https://i.ibb.co/7NLPTcZc/1000013052.png') no-repeat center center; 
background: url('https://i.ibb.co/4w7ydH39/voorblad3-vierkant.png') no-repeat center center; */
background: url(./images/fig1.png) no-repeat center center;




  background-size: cover;
  z-index: 0;
  opacity: 0.6; /* iets lager voor meer subtiliteit */
  filter: saturate(0.7) brightness(0.85) contrast(0.9) blur(1px);
}

canvas {
  position: relative;
  z-index: 1;
  display: block;
  border: none;
  background-color: transparent; 
 width: 100%;
  height: auto;
}


/* 10 op 10 grid maar het raster staat op 0 dus w elders gedefinieerd*/

.grid {
 position: absolute;
  pointer-events: none;
  z-index: 2;

  background-image: 
    repeating-linear-gradient(
      to right,
      #223344 0px,
      #223344 0px,
      transparent 0px,
      transparent 0px
    ),
    repeating-linear-gradient(
      to bottom,
      #223344 0px,
      #223344 0px,
      transparent 0px,
      transparent 0px
    );
  opacity: 0.0;
  border-radius: 0px;
}

    .orange-line {
  height: 4px;
  width: 100%;
  background-color: #e88a2d; /* De oranje kleur */
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3); /* Optionele subtiele schaduw */
}

/* de 3 cellen onderaan*/

.controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px; /* ruimte tussen de knoppen */
  margin: 0 auto 10px auto; /* centreren en marge onderaan */
  
  background: rgba(0, 0, 0, 0.6);
}

/*geen nut*/
.controls button {
  margin-right: 0px; 
}
.controls button:last-child {
  margin-right: 0; 
}
    .controls .up    { grid-area: up; }
    .controls .down  { grid-area: down; }
    .controls .left  { grid-area: left; }
    .controls .right { grid-area: right; }
    .controls .reset { grid-area: reset; }



    /* specifiek de 3 onderste buttins*/

    .controls button {
        flex-wrap: wrap;
  justify-content: center;
  margin-top: 0px;
  font-size: 20px;
  border: none;
  border: 2px solid #e88a2d;
  /* schaduw box-shadow: 0 0 10px #e88a2d; */
  
  background: rgba(0, 0, 0, 0.6);
  border-radius: 10px; /* of gewoon: 0 voor scherpe hoeken */
  width: 70px; /* wordt verderop overschreven */
  height: 70px; /* wordt verderop overschreven */

  /* background-color: transparent;  transparante achtergrondkleur */
  color: #2b2b2b;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
  background-image: none; /* geen achtergrondafbeelding */
  transition: transform 0.2s ease, background-color 0.3s ease;
  outline: none;
}

    .controls button:active {
      transform: scale(0.95);
    }

/* bovenste 9 cellen */

    .info-container {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  /* NAKIJKEN 4 naar 5 gezet*/
  grid-template-rows: repeat(4, 4vh); 
  height: 22vh;
  gap: 10px;
  width: 100%;
  max-width: 600px;
  margin: 5px auto 0px auto;
  padding: 10px;
  box-sizing: border-box;
}

/* Elke cel: standaard styling */
.info-cell {
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: 'Baloo Bhaina 2', sans-serif;
  font-weight: 700;
  color: #e88a2d;
  /*background: rgba(0, 0, 0, 0.6);*/
  background: rgba(0, 0, 0, 0.6);
  border: 2px solid #e88a2d;
  /*box-shadow: 0 0 6px #e88a2d;*/
  border-radius: 10px;
  height: 100%;
  text-align: center;
  font-size: 1.2rem;
  line-height: 100%;

  /*background-color: #e3e1dc; */
}

.info-cell.challenge-active {
  background-color: #e88a2d !important; /* of een andere kleur */
}

.challenge-active #levelImage {
  width: 30% !important;
}

.challenge-active #challengeInfoText {
  width: 70% !important;
}

/* Specifieke inhoud: Levens */
#livesDisplay {
  flex-direction: column;
  gap: 4px;
}
#livesDisplay .info-line {
  flex: 1;
  width: 100%;
  box-sizing: border-box;
}

/* Pauze knop */
#pauseButton {
  all: unset;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  width: 100%;
  height: 100%;
}
#pauseButton img {
  max-height: 100%;
  max-width: 100%;
  object-fit: contain;
}



#livesDisplay {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 4px;
  height: 100%;
}

.info-line {
  font-family: 'Baloo Bhaina 2', sans-serif;
  font-size: 16px;
  font-weight: 700;
  color: #e88a2d;
  background: rgba(0, 0, 0, 0.6);
  border: 2px solid #e88a2d;
  box-shadow: 0 0 6px #e88a2d;
  border-radius: 10px;
  text-align: center;
  height: 24px;
  line-height: 24px;
  padding: 0 6px;
  white-space: nowrap;
}

#livesDisplay .info-line,
#scoreDisplay .info-line {
  flex: 1;
  width: 100%;
  box-sizing: border-box;
}




#pauseButton {
  all: unset;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  width: 100%;
  cursor: pointer;
}


/* niet gebruikt */
@keyframes popEffect {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.5); opacity: 0.7; }
  100% { transform: scale(1); opacity: 1; }
}
.pop {
  animation: popEffect 0.6s ease;
}
.combo-message {
  position: absolute;
  top: 20%;
  left: 50%;
  transform: translateX(-50%);
  font-size: 3rem;
  background: rgba(255, 255, 255, 0.9);
  padding: 0.5em 1em;
  border-radius: 1em;
  box-shadow: 0 0 10px #000;
  animation: fadeInOut 1s ease;
}
.celebration-image {
  position: absolute;
  z-index: 9999;  /* Zorg ervoor dat het boven andere elementen komt */
  object-fit: cover;  /* Zorg ervoor dat de afbeelding de cel vult zonder uit te rekken */
  pointer-events: none;  /* Zorg ervoor dat de afbeelding geen andere interactie blokkeert */
  transition: transform 0.2s ease; /* Optioneel, je kunt hier een animatie aan toevoegen als je wilt */
}
@keyframes fadeInOut {
  0%   { opacity: 0; }
  20%  { opacity: 1; }
  80%  { opacity: 1; }
  100% { opacity: 0; }
}



    .block {
  width: 40px; /* Pas de breedte aan naar je voorkeur */
  height: 40px; /* Pas de hoogte aan naar je voorkeur */
  background-color: #00FF00; /* Groen, kan je aanpassen */
  border-radius: 50%; /* Maak het blokje cirkelvormig */
  display: inline-block;
  box-shadow: 0 0 8px white; /* Voeg een witte schaduw toe voor een randachtig effect */
  transition: background-color 0.3s, transform 0.2s ease; /* Animaties bij hover */
}



/* Media Query voor kleinere schermen (zoals mobiel): 600 --> 768 - gaat over de 9 cellen bovenaan */
@media (max-width: 768px) {
  .info {  
    font-size: 1.1rem; /* Maak de tekst iets kleiner voor mobiel */
    margin: 0 5px; /* Kleinere marge voor mobiel */
  }
      .info {
  white-space: nowrap;    /* Nooit afbreken naar een nieuwe lijn */
  overflow: hidden;       /* Als te groot: niet tonen buiten blokje */
  text-overflow: ellipsis; /* Eventueel ... als het echt niet past */
  text-align: center;
  font-size: 32px;         /* Startgrootte, mag je aanpassen */
}

    .info:first-child {
      text-align: left;
    }

    .info:last-child {
      text-align: right;
    }

  .info-container {
    flex-direction: row; /* heeft geen meerwaarde */
    padding: 10px;
  }

/* geen meerwaarde want hogerop exact zelfde body*/

body {
/*background-color: black;*/
background-color: #c9a878;
  /*background-color: #e3e1dc;*/
  background-size: cover;
  color: white;
  font-family: sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100vh;
  overflow: hidden;
  margin: 0;
  padding: 0;
}

}

/* heel kleine schermen  */
@media (max-width: 600px) {
  .info-container {
    gap: 6px;
  }

  .info-cell {
  height: 100%;
    font-size: 1.2rem;
    height: 100%;
    line-height: 100%;
  }
}

/* onderste 3 buttins*/
.vertical-controls,
.horizontal-controls {
  position: fixed;
  top: 76vh;
  height: 22vh;
  width: 100vw;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  display: flex;
  justify-content: center;
  gap: 10px;
  padding: 0;
  background: none;
  border: none;
  box-shadow: none;
}

.vertical-controls > button,
.horizontal-controls > button {
  flex: 1;
  height: 90%;
  max-height: 100%;
  aspect-ratio: unset !important;
}

.button-wrapper {
  flex: 1.4;
  height: 90%;
  max-height: 100%;
  aspect-ratio: unset !important;

  display: flex;
  flex-direction: column;
  gap: 10px;
}

.button-wrapper button {
  flex: 1;
  width: 100%;
  height: 3vh;
  padding: 0;
  border: 2px solid #e88a2d;
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
  background-color: transparent;
  cursor: pointer;
}



.button-wrapper .text-button {
  flex: 2;
  font-family: 'Baloo Bhaina 2', sans-serif;
  font-weight: bold;
  font-size: 0.65rem;
  text-transform: uppercase;
  color: #f4c644;
  background-color: rgba(0, 0, 0, 0.6);
  border: 2px solid #e88a2d;
  border-radius: 10px;
  box-shadow: 0 0 6px #e88a2d;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  padding-top: 2px;
}

.button-wrapper .reset-btn {
  flex: 5;
  background-color: rgba(0, 0, 0, 0.6);
}

.button-wrapper .home-btn {
  flex: 3;
  background-color: rgba(0, 0, 0, 0.6);
}

.button-wrapper img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}


#dropButton {
  all: unset;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  width: 100%;
  height: 100%;
}

#renewCell {
  cursor: pointer;
  transition: transform 0.15s ease;
}

#renewCell:hover {
  transform: scale(1.03);
  box-shadow: 0 0 8px #e88a2d;
}

#dropButton img {
  max-height: 100%;
  max-width: 100%;
  object-fit: contain;
}


/* beginscherm */

#startOverlay {
  position: relative;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0, 0, 0, 0.9);
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding-top: 5vh;
  z-index: 99999;
  font-family: 'Baloo Bhaina 2', sans-serif;
}

/* afbeelding op beginscherm
https://i.ibb.co/1YdV4rPy/Chat-GPT-Image-4-mei-2025-22-54-41.png

background: url('https://iili.io/Fgd78mP.md.jpg') no-repeat center top;*/

#startOverlay .intro-image {
  width: 100%;
  aspect-ratio: 3 / 4;
  background: url(./images/achtergrondbegin.jpg) no-repeat center top;
  background-size: contain;
  margin-top: auto;
  max-height: 45vh;
}


/* zogezegd frame rond de 4 opties om er eventueel iets boven te zetten*/
#startOverlay .content-box {
  width: 90vw;
  max-width: 360px;
  border-radius: 16px;
  background: transparent; /* volledig doorzichtig */
  box-shadow: none; /* geen schaduw */

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;

  padding: 1rem;
  box-sizing: border-box;
  max-height: 90vh;

  position: absolute;
  bottom: min(15vh, 250px);
  left: 50%;
  transform: translateX(-50%);
  z-index: 1;
}



#startOverlay .button-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  width: 100%;

  padding: 0.5rem;
  box-sizing: border-box;
  overflow-y: auto;
  max-height: 42vh;
}

.start-button {
  background: #e88a2d !important;
  color: #FFE680 !important;
  border: none;
  border-radius: 8px;
  padding: 0.6rem 1rem;
  font-size: 1rem;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 0 10px #C35A10;
  text-align: center;
  width: 100%;
}



.start-button:hover {
  transform: scale(1.05);
  box-shadow: 0 0 14px #FFA94D;
}

#startOverlay .button-group {
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
  width: 100%;
  max-width: 360px;
  padding: 0.5rem;
  box-sizing: border-box;
}

#startOverlay .primary-group {
  margin-bottom: 2rem;
}

#startOverlay .numbered-button {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  width: 100%;
  max-width: 360px;
}

#startOverlay .number-label {
  width: 2rem;
  text-align: center;
  font-weight: bold;
  color: #e88a2d;
  font-size: 1rem;
}

.numbered-button {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  width: 100%;
  max-width: 360px;
}



.number-label {
  background: #FFE680;
  color: #000;
  font-weight: bold;
  font-size: 1rem;
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 6px rgba(255, 255, 0, 0.6);
  opacity: 0; /* nodig voor fade-in */
}




/* Animatie: van boven 
.fromTop {
  opacity: 0;
  transform: translateY(-20px);
  animation: fromTopAnim 0.6s ease-out forwards;
}
*/

/* De animatie zelf */
@keyframes fromTopAnim {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}


#colorChoiceModal {
  z-index: 100000 !important;
}

/* stuk van challanges*/

.challenge-cell {
  position: relative;
  border: 2px solid #e88a2d;
  border-radius: 10px;
  color: #FFE680;
  box-shadow: 0 0 10px #e88a2d;
  background-image: url(.images/fig2.png);
  background-size: cover;
  background-position: center;
  padding: 10px;
  text-align: left;
  font-family: 'Baloo Bhaina 2', sans-serif;
  /*
  display: flex;
  align-items: center;
  justify-content: center;
  */
  min-height: 80px;
  height: 120px; /* â† vaste hoogte voor uniforme cellen */
  transition: filter 0.3s ease;
}

.challenge-cell.inactive {
  filter: grayscale(100%);
}

.challenge-content {
  z-index: 1;
}

.challenge-title {
  color: #e88a2d;
  font-weight: bold;
  font-size: 1.1rem;
  letter-spacing: -1px;
  margin-bottom: 6px;
}

.challenge-stats {
  display: flex;
  justify-content: center;
  gap: 14px;
  font-size: 0.9rem;
  align-items: center;
}

.challenge-stats span {
  display: flex;
  align-items: center;
  gap: 4px;
}

.clock-icon {
  width: 18px;
  height: 18px;
  vertical-align: middle;
  object-fit: contain;
}

  

@media (max-height: 640px) {
  .button-container button {
    font-size: 0.8rem;
    padding: 0.4rem 0.5rem;
  }
}





/* het startscherm*/
/*box met 4 opties*/
#startOverlay .content-box {
  position: relative;
  z-index: 2;
  position: absolute;
  bottom: min(15vh, 250px);
  left: 50%;
  transform: translateX(-50%);
  z-index: 1;
}

/*achtergrond*/
.bg-wrapper {
  position: absolute;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;

background: rgba(0, 0, 0, 0.6);
  /*background-color: #e3e1dc;*/
  z-index: -1;
}
.bg-wrapper .bg-image {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}

.bg-image {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  object-fit: contain;
  
  background: rgba(0, 0, 0, 0.6);
  z-index: -1;

  object-position: center;
}
  
.info-cell * {
  max-height: 100%;
  object-fit: contain;
}


.practice-cell {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border: 2px solid #e88a2d;
  border-radius: 10px;
  background: rgba(255, 255, 255, 0.07);
  color: #FFE680;
  padding: 5px 5px;
  font-family: 'Baloo Bhaina 2', sans-serif;
  font-weight: bold;
  box-shadow: 0 0 8px #e88a2d;
  cursor: pointer;
  min-height: 30px;
  box-sizing: border-box;
width: 100%;
}

.practice-text {
  font-size: 0.5rem;
  flex: 1;
  text-align: left;
}

.practice-counter {
  font-size: 1rem;
  width: 60px;
  text-align: right;
  color: #FFA94D;
}
.practice-cell:hover {
  background: rgba(255, 255, 255, 0.12);
}


/* einde eerste stuk code*/


</style>
</head>
<body>


<!-- vorm tutorial -->
<div id="tutorialOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: rgba(0, 0, 0, 0.9); z-index: 99999; flex-direction: column; justify-content: flex-start; align-items: center; padding-top: 5vh;">
<img id="tutorialImage" src="" style="max-width: 90vw; max-height: 80vh; border: 4px solid #e88a2d; border-radius: 12px;"/>
<button id="tutorialNextButton" style="
          margin-top: 1rem;
          background: #e88a2d;
          color: white;
          border: none;
          padding: 0.6rem 1.2rem;
          border-radius: 12px;
          font-size: 1rem;
          font-weight: bold;
          cursor: pointer;
          box-shadow: 0 0 10px #e88a2d;
          transition: transform 0.2s ease;
        ">Next</button>

</div>



<!-- achtergrond eerste scherm -->
<div id="startOverlay">
<!--
    <div class="bg-wrapper"><img alt="Achtergrond" class="bg-image" src="https://i.ibb.co/1YdV4rPy/Chat-GPT-Image-4-mei-2025-22-54-41.png"/>

 <div class="bg-wrapper"><img alt="Achtergrond" class="bg-image" src="https://i.ibb.co/mFDbxGwN/start2.png"/>
    
<div class="bg-wrapper"><img alt="Achtergrond" class="bg-image" src="https://iili.io/Fgd78mP.md.jpg">
   -->

<div class="bg-wrapper"><img alt="Achtergrond" class="bg-image" src="images/achtergrondbegin.jpg">


</div>

  <!-- zogezegd frame rond de 4 opties om er eventueel iets boven te zetten -->

<div class="content-box">

  <!-- Debugtekst bovenaan -->
<!--
<div id="loadingText" style="position: fixed; top: 4px; left: 4px; color: yellow; font-size: 14px; z-index: 10000;">
  Bezig met laden...
</div>
-->

<!-- 
<div class="button-container">

  <button id="teachButton" onclick="startTutorialFromIntro1()" class="start-button fromTop main-button" disabled>
    Teach me how to party!
  </button>
  <button id="partyTogetherButton" onclick="startNormalGame()" class="start-button fromTop main-button" disabled>
    Letâ€™s throw this party together!
  </button>
  <button id="proPlannerButton" onclick="startAtLevel10()" class="start-button fromTop main-button" disabled>
    Professional party planner in the house!
  </button>
    <button id="oefenen" onclick="startoefenen()" class="start-button fromTop main-button" disabled>
    Practice the party missions!
  </button>
    <button id="continueButton" class="start-button fromTop main-button" onclick="continueWithScore()" disabled>
    Continue your saved party
  </button>
</div>
-->

<div class="button-container">

  <div style="position: relative; width: 100%;">
    <div class="number-label" id="number1" style="position: absolute; left: 10px; top: 0.2rem; z-index: 2;">1</div>
    <button id="teachButton" onclick="startTutorialFromIntro1()" class="start-button main-button" disabled style="padding-left: 3rem;">
      WHO IS WHO
    </button>
  </div>

  <div style="position: relative; width: 100%;">
    <div class="number-label" id="number2" style="position: absolute; left: 10px; top: 0.2rem; z-index: 2;">2</div>
    <button id="partyTogetherButton" onclick="startNormalGame()" class="start-button main-button" disabled style="padding-left: 3rem;">
      HOW TO PARTY
    </button>
  </div>

  <div style="position: relative; width: 100%;">
    <div class="number-label" id="number3" style="position: absolute; left: 10px; top: 0.2rem; z-index: 2;">3</div>
    <button id="proPlannerButton" onclick="startAtLevel10()" class="start-button main-button" disabled style="padding-left: 3rem;">
      READY TO PARTY
    </button>
  </div>

  <div style="width: 100%; margin-top: 20px;">
    <button id="oefenen" onclick="startoefenen()" class="start-button main-button" disabled>
      PRACTICE PARTY MISSIONS
    </button>
  </div>

  <div style="width: 100%;">
    <button id="continueButton" onclick="continueWithScore()" class="start-button main-button" disabled>
      RESUME SAVED PARTY
    </button>
  </div>

</div>


</div>


<!-- oefenen missions -->


<div id="practiceOverlay" style="
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.95);
  z-index: 99999;
  font-family: 'Baloo Bhaina 2', sans-serif;
  color: #FFE680;
  padding: 0px 0px;
  box-sizing: border-box;
  overflow-y: auto;
  text-align: center;
">
<div style="text-align: center; margin-bottom: 30px;">
  <img src="images/fig3.png" alt="Practice the Party Missions" style="max-width: 100%; height: auto; border-radius: 10px;">
</div>

<button onclick="closePracticeOverlay()" style="
  
  background: #e88a2d;
  color: black;
  border: none;
  padding: 0.8rem 1.5rem;
  border-radius: 12px;
  font-weight: bold;
  font-size: 1.1rem;
  box-shadow: 0 0 8px #FFA94D;
  cursor: pointer;
">
  RETURN TO THE PARTY
</button>



<!-- Titelcel met oranje achtergrond -->
<div style="
  max-width: 800px;
  margin: 40px auto 10px auto;
  padding: 8px 15px;
  background-color: #e88a2d;
  border-radius: 8px;
  color: #000;
  font-family: 'Baloo Bhaina 2', sans-serif;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 1.05rem;
  letter-spacing: 1px;
">
  <div style="background-color: #000; color: #FFE680; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold;">
    1
  </div>
  <span style="font-weight: bold;">30 Times Love</span>
</div>

<!-- Tekst + afbeelding -->
<div style="
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  max-width: 600px;
  margin: 0 auto 18px auto;
  padding: 8px 12px;
  background-color: rgba(255, 255, 255, 0.07);
  border-radius: 10px;
  box-sizing: border-box;
  flex-wrap: wrap;
  text-align: left;
">
  <div style="flex: 1; min-width: 160px; color: #FFE680; font-size: 0.95rem; line-height: 1.3;">
    Brace yourself â€“ 30 heart blocks are coming in a row! Make them all vanish within 100 blocks. No multicolor, skip or free picture tricks allowed.
  </div>
  <div style="flex: 0 0 auto; width: 60px;">
    <img src="images/fig4.png" style="width: 100%; height: auto; border-radius: 8px;">
  </div>
</div>

<!-- Oefenmatrix -->
<div style="display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 360px;
            margin: 0 auto;
            padding: 0 5px;
            box-sizing: border-box;">

<!-- CEL 1 -->
<div onclick="startPracticeWithPreFilledGridch11()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch11" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 2 -->
<div onclick="startPracticeWithPreFilledGridch12()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>.</span>
      <span>.</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch12" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 3 -->
<div onclick="startPracticeWithPreFilledGridch13()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>.</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch13" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 4 -->
<div onclick="startPracticeWithPreFilledGridch14()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch14" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 5 -->
<div onclick="startPracticeWithPreFilledGridch15()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>.</span>
      <span>.</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch15" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 6 -->
<div onclick="startPracticeWithPreFilledGridch16()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>.</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch16" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 7 -->
<div onclick="startPracticeWithPreFilledGridch17()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch17" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 8 -->
<div onclick="startPracticeWithPreFilledGridch18()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch18" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 9 -->
<div onclick="startPracticeWithPreFilledGridch19()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch19" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

</div>

<!-- Titelcel met oranje achtergrond -->
<div style="
  max-width: 800px;
  margin: 40px auto 10px auto;
  padding: 8px 15px;
  background-color: #e88a2d;
  border-radius: 8px;
  color: #000;
  font-family: 'Baloo Bhaina 2', sans-serif;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 1.05rem;
  letter-spacing: 1px;
">
  <div style="background-color: #000; color: #FFE680; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold;">
    2
  </div>
  <span style="font-weight: bold;">30 Times The Rainbow</span>
</div>

<!-- Tekst + afbeelding -->
<div style="
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  max-width: 600px;
  margin: 0 auto 18px auto;
  padding: 8px 12px;
  background-color: rgba(255, 255, 255, 0.07);
  border-radius: 10px;
  box-sizing: border-box;
  flex-wrap: wrap;
  text-align: left;
">
  <div style="flex: 1; min-width: 160px; color: #FFE680; font-size: 0.95rem; line-height: 1.3;">
    Are you ready cause every third block will be a multicolor during the mission! Make 30 of them leave the dancefloor within 100 blocks. No multicolor, skip or free picture tricks allowed.
  </div>
  <div style="flex: 0 0 auto; width: 60px;">
    <img src="images/fig32.png" alt="Multicolor block" style="width: 100%; height: auto; border-radius: 8px;">
  </div>
</div>

<!-- Oefenmatrix -->
<div style="display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 360px;
            margin: 0 auto;
            padding: 0 5px;
            box-sizing: border-box;">

<!-- CEL 1 -->
<div onclick="startPracticeWithPreFilledGridch21()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch21" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 2 -->
<div onclick="startPracticeWithPreFilledGridch22()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>.</span>
      <span>.</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch22" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 3 -->
<div onclick="startPracticeWithPreFilledGridch23()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>.</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch23" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 4 -->
<div onclick="startPracticeWithPreFilledGridch24()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch24" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 5 -->
<div onclick="startPracticeWithPreFilledGridch25()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>.</span>
      <span>.</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch25" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 6 -->
<div onclick="startPracticeWithPreFilledGridch26()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>.</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch26" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 7 -->
<div onclick="startPracticeWithPreFilledGridch27()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch27" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 8 -->
<div onclick="startPracticeWithPreFilledGridch28()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch28" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<!-- CEL 9 -->
<div onclick="startPracticeWithPreFilledGridch29()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
    <div class="practice-counter" id="practiceWinsch29" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

</div>


<!-- Titelcel met oranje achtergrond -->
<div style="
  max-width: 800px;
  margin: 40px auto 10px auto;
  padding: 8px 15px;
  background-color: #e88a2d;
  border-radius: 8px;
  color: #000;
  font-family: 'Baloo Bhaina 2', sans-serif;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 1.05rem;
  letter-spacing: 1px;
">
  <div style="background-color: #000; color: #FFE680; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold;">
    3
  </div>
  <span style="font-weight: bold;">No One Left Behind</span>
</div>


<!-- Tekst + hartje compacter en naast elkaar -->
<div style="
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  max-width: 600px;
  margin: 0 auto 18px auto;
  padding: 8px 12px;
  background-color: rgba(255, 255, 255, 0.07);
  border-radius: 10px;
  box-sizing: border-box;
  flex-wrap: wrap;
  text-align: left;
">

  <!-- Compacte tekst -->
  <div style="flex: 1; min-width: 160px; color: #FFE680; font-size: 0.95rem; line-height: 1.3;">
    Stay sharp â€“ survive the next 100 blocks without losing a single life!
  </div>

  <!-- Kleinere afbeelding -->
  <div style="flex: 0 0 auto; width: 60px;">
    <img src="images/fig2.png" alt="Heart block" style="width: 100%; height: auto; border-radius: 8px;">
  </div>

</div>

<!-- Lijst met oefencellen -->




<!-- 3x3 klikbare matrix -->
<div style="display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 360px;
            margin: 0 auto;
            padding: 0 5px;
            box-sizing: border-box;
            justify-items: start;">

  <!-- Genereer 9 cellen met ster, kruisjes en beker -->
  <!-- CEL 1 -->
  <div onclick="startPracticeWithPreFilledGridch31()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch31" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 2 -->
  <div onclick="startPracticeWithPreFilledGridch32()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>.</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch32" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 3 -->
  <div onclick="startPracticeWithPreFilledGridch33()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch33" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 4 -->
  <div onclick="startPracticeWithPreFilledGridch34()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch34" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 5 -->
  <div onclick="startPracticeWithPreFilledGridch35()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch35" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 6 -->
  <div onclick="startPracticeWithPreFilledGridch36()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch36" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 7 -->
  <div onclick="startPracticeWithPreFilledGridch37()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch37" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 8 -->
  <div onclick="startPracticeWithPreFilledGridch38()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch38" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 9 -->
  <div onclick="startPracticeWithPreFilledGridch39()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch39" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

</div>

<!-- Titelcel met oranje achtergrond -->
<div style="
  max-width: 800px;
  margin: 40px auto 10px auto;
  padding: 8px 15px;
  background-color: #e88a2d;
  border-radius: 8px;
  color: #000;
  font-family: 'Baloo Bhaina 2', sans-serif;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 1.05rem;
  letter-spacing: 1px;
">
  <div style="background-color: #000; color: #FFE680; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold;">
    4
  </div>
  <span style="font-weight: bold;">50+ Block Bonanza</span>
</div>

<!-- Tekst + afbeelding -->
<div style="
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  max-width: 600px;
  margin: 0 auto 18px auto;
  padding: 8px 12px;
  background-color: rgba(255, 255, 255, 0.07);
  border-radius: 10px;
  box-sizing: border-box;
  flex-wrap: wrap;
  text-align: left;
">
  <div style="flex: 1; min-width: 160px; color: #FFE680; font-size: 0.95rem; line-height: 1.3;">
    Time to party â€“ hit 50+ blocks on the dance floor at least 10 times in the next 100 moves!
  </div>
  <div style="flex: 0 0 auto; width: 60px;">
    <img src="images/fig82.png" alt="Block party" style="width: 100%; height: auto; border-radius: 8px;">
  </div>
</div>

<!-- 3x3 klikbare matrix -->
<div style="display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 360px;
            margin: 0 auto;
            padding: 0 5px;
            box-sizing: border-box;
            justify-items: start;">

  <!-- CEL 1 -->
  <div onclick="startPracticeWithPreFilledGridch41()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch41" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 2 -->
  <div onclick="startPracticeWithPreFilledGridch42()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>.</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch42" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 3 -->
  <div onclick="startPracticeWithPreFilledGridch43()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch43" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 4 -->
  <div onclick="startPracticeWithPreFilledGridch44()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch44" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 5 -->
  <div onclick="startPracticeWithPreFilledGridch45()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch45" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 6 -->
  <div onclick="startPracticeWithPreFilledGridch46()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch46" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 7 -->
  <div onclick="startPracticeWithPreFilledGridch47()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch47" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 8 -->
  <div onclick="startPracticeWithPreFilledGridch48()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch48" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 9 -->
  <div onclick="startPracticeWithPreFilledGridch49()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch49" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>
</div>

<!-- Titelcel met oranje achtergrond -->
<div style="
  max-width: 800px;
  margin: 40px auto 10px auto;
  padding: 8px 15px;
  background-color: #e88a2d;
  border-radius: 8px;
  color: #000;
  font-family: 'Baloo Bhaina 2', sans-serif;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 1.05rem;
  letter-spacing: 1px;
">
  <div style="background-color: #000; color: #FFE680; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold;">
    5
  </div>
  <span style="font-weight: bold;">Diva Takeover</span>
</div>

<!-- Tekst + afbeelding -->
<div style="
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  max-width: 600px;
  margin: 0 auto 18px auto;
  padding: 8px 12px;
  background-color: rgba(255, 255, 255, 0.07);
  border-radius: 10px;
  box-sizing: border-box;
  flex-wrap: wrap;
  text-align: left;
">
  <div style="flex: 1; min-width: 160px; color: #FFE680; font-size: 0.95rem; line-height: 1.3;">
    Survive the diva storm â€“ all blocks turn into long-countdown divas! More are coming, and they take their sweet time. Outlast them and you win.
  </div>
  <div style="flex: 0 0 auto; width: 60px;">
    <img src="images/fig87.png" alt="Diva blocks" style="width: 100%; height: auto; border-radius: 8px;">
  </div>
</div>

<!-- 3x3 klikbare matrix -->
<div style="display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 360px;
            margin: 0 auto;
            padding: 0 5px;
            box-sizing: border-box;
            justify-items: start;">

  <!-- CEL 1 -->
  <div onclick="startPracticeWithPreFilledGridch51()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch51" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 2 -->
  <div onclick="startPracticeWithPreFilledGridch52()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>.</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch52" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 3 -->
  <div onclick="startPracticeWithPreFilledGridch53()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch53" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 4 -->
  <div onclick="startPracticeWithPreFilledGridch54()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch54" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 5 -->
  <div onclick="startPracticeWithPreFilledGridch55()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch55" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 6 -->
  <div onclick="startPracticeWithPreFilledGridch56()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch56" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 7 -->
  <div onclick="startPracticeWithPreFilledGridch57()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch57" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 8 -->
  <div onclick="startPracticeWithPreFilledGridch58()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch58" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 9 -->
  <div onclick="startPracticeWithPreFilledGridch59()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch59" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

</div>

<!-- Titelcel met oranje achtergrond -->
<div style="
  max-width: 800px;
  margin: 40px auto 10px auto;
  padding: 8px 15px;
  background-color: #e88a2d;
  border-radius: 8px;
  color: #000;
  font-family: 'Baloo Bhaina 2', sans-serif;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 1.05rem;
  letter-spacing: 1px;
">
  <div style="background-color: #000; color: #FFE680; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold;">
    6
  </div>
  <span style="font-weight: bold;">One Colour Rules Them All</span>
</div>

<!-- Tekst + afbeelding -->
<div style="
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  max-width: 600px;
  margin: 0 auto 18px auto;
  padding: 8px 12px;
  background-color: rgba(255, 255, 255, 0.07);
  border-radius: 10px;
  box-sizing: border-box;
  flex-wrap: wrap;
  text-align: left;
">
  <div style="flex: 1; min-width: 160px; color: #FFE680; font-size: 0.95rem; line-height: 1.3;">
    Think bigger â€“ clear 10 groups of 6 matching blocks (5 wonâ€™t cut it)!
  </div>
  <div style="flex: 0 0 auto; width: 60px;">
    <img src="images/fig88.png" alt="One Colour" style="width: 100%; height: auto; border-radius: 8px;">
  </div>
</div>

<!-- 3x3 klikbare matrix -->
<div style="display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 360px;
            margin: 0 auto;
            padding: 0 5px;
            box-sizing: border-box;
            justify-items: start;">

  <!-- CEL 1 -->
  <div onclick="startPracticeWithPreFilledGridch61()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch61" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 2 -->
  <div onclick="startPracticeWithPreFilledGridch62()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>.</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch62" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 3 -->
  <div onclick="startPracticeWithPreFilledGridch63()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch63" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 4 -->
  <div onclick="startPracticeWithPreFilledGridch64()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch64" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 5 -->
  <div onclick="startPracticeWithPreFilledGridch65()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch65" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 6 -->
  <div onclick="startPracticeWithPreFilledGridch66()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch66" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 7 -->
  <div onclick="startPracticeWithPreFilledGridch67()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch67" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 8 -->
  <div onclick="startPracticeWithPreFilledGridch68()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch68" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 9 -->
  <div onclick="startPracticeWithPreFilledGridch69()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch69" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

</div>

<!-- Titelcel met oranje achtergrond -->
<div style="
  max-width: 800px;
  margin: 40px auto 10px auto;
  padding: 8px 15px;
  background-color: #e88a2d;
  border-radius: 8px;
  color: #000;
  font-family: 'Baloo Bhaina 2', sans-serif;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 1.05rem;
  letter-spacing: 1px;
">
  <div style="background-color: #000; color: #FFE680; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold;">
    7
  </div>
  <span style="font-weight: bold;">Night Fever Mode</span>
</div>

<!-- Tekst + afbeelding -->
<div style="
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  max-width: 600px;
  margin: 0 auto 18px auto;
  padding: 8px 12px;
  background-color: rgba(255, 255, 255, 0.07);
  border-radius: 10px;
  box-sizing: border-box;
  flex-wrap: wrap;
  text-align: left;
">
  <div style="flex: 1; min-width: 160px; color: #FFE680; font-size: 0.95rem; line-height: 1.3;">
    Speed mode on â€“ 10 groups of 5 blocks must vanish within 100 drops! But beware: each block hits the dancefloor faster and faster...
  </div>
  <div style="flex: 0 0 auto; width: 60px;">
    <img src="images/fig85.png" alt="Night Fever" style="width: 100%; height: auto; border-radius: 8px;">
  </div>
</div>

<!-- 3x3 klikbare matrix -->
<div style="display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 360px;
            margin: 0 auto;
            padding: 0 5px;
            box-sizing: border-box;
            justify-items: start;">

  <!-- CEL 1 -->
  <div onclick="startPracticeWithPreFilledGridch71()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch71" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 2 -->
  <div onclick="startPracticeWithPreFilledGridch72()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>.</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch72" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 3 -->
  <div onclick="startPracticeWithPreFilledGridch73()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>.</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch73" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 4 -->
  <div onclick="startPracticeWithPreFilledGridch74()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>.</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch74" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 5 -->
  <div onclick="startPracticeWithPreFilledGridch75()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>.</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch75" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 6 -->
  <div onclick="startPracticeWithPreFilledGridch76()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>.</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch76" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 7 -->
  <div onclick="startPracticeWithPreFilledGridch77()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>.</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch77" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 8 -->
  <div onclick="startPracticeWithPreFilledGridch78()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>.</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch78" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

  <!-- CEL 9 -->
  <div onclick="startPracticeWithPreFilledGridch79()" style="display: flex; justify-content: space-between; align-items: center; border: 2px solid #e88a2d; border-radius: 10px; background: rgba(255, 255, 255, 0.07); padding: 4px 6px; min-width: 50px;">
    <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
      <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span>
        <span>â˜…</span><span>â˜…</span><span>â˜…</span> 
      </div>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 50px;">
      <div class="practice-counter" id="practiceWinsch79" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
    </div>
  </div>

</div>

 <!-- 


<div style="display: grid;
             grid-template-columns: repeat(3, 1fr);
             gap: 8px;
             width: 80vw;
             max-width: 80vw;
             margin: 0 auto;
             padding: 0 5px;
             box-sizing: border-box;">





<div class="practice-cell" onclick="startPracticeWithPreFilledGridch31()" style="display: flex; justify-content: space-between; align-items: center; gap: 8px; padding: 6px 10px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span> 
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 20px;">
    <div class="practice-counter" id="practiceWinsch31" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

<div class="practice-cell" onclick="startPracticeWithPreFilledGridch32()" style="display: flex; justify-content: space-between; align-items: center; gap: 8px; padding: 6px 10px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>.</span>
      <span>.</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span>
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 40px;">
    <div class="practice-counter" id="practiceWinsch32" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>


<div class="practice-cell" onclick="startPracticeWithPreFilledGridch33()" style="display: flex; justify-content: space-between; align-items: center; gap: 8px; padding: 6px 10px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>.</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span>
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 40px;">
    <div class="practice-counter" id="practiceWinsch33" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>


<div class="practice-cell" onclick="startPracticeWithPreFilledGridch34()" style="display: flex; justify-content: space-between; align-items: center; gap: 8px; padding: 6px 10px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>.</span><span>.</span>
      <span>.</span><span>.</span><span>.</span>
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 40px;">
    <div class="practice-counter" id="practiceWinsch34" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>


<div class="practice-cell" onclick="startPracticeWithPreFilledGridch35()" style="display: flex; justify-content: space-between; align-items: center; gap: 8px; padding: 6px 10px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>.</span>
      <span>.</span><span>.</span><span>.</span>
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 40px;">
    <div class="practice-counter" id="practiceWinsch35" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>


<div class="practice-cell" onclick="startPracticeWithPreFilledGridch36()" style="display: flex; justify-content: space-between; align-items: center; gap: 8px; padding: 6px 10px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>.</span><span>.</span><span>.</span>
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 40px;">
    <div class="practice-counter" id="practiceWinsch36" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>


<div class="practice-cell" onclick="startPracticeWithPreFilledGridch37()" style="display: flex; justify-content: space-between; align-items: center; gap: 8px; padding: 6px 10px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>.</span><span>.</span>
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 40px;">
    <div class="practice-counter" id="practiceWinsch37" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>


<div class="practice-cell" onclick="startPracticeWithPreFilledGridch38()" style="display: flex; justify-content: space-between; align-items: center; gap: 8px; padding: 6px 10px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>.</span>
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 40px;">
    <div class="practice-counter" id="practiceWinsch38" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>


<div class="practice-cell" onclick="startPracticeWithPreFilledGridch39()" style="display: flex; justify-content: space-between; align-items: center; gap: 8px; padding: 6px 10px;">
  <div style="display: flex; justify-content: center; align-items: center; flex: 1;">
    <div class="practice-text" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2px; justify-items: center; align-items: center; font-size: 1rem; line-height: 1; color: #FFE680;">
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
      <span>â˜…</span><span>â˜…</span><span>â˜…</span>
    </div>
  </div>
  <div style="display: flex; justify-content: center; align-items: center; width: 40px;">
    <div class="practice-counter" id="practiceWinsch39" style="font-size: 1rem; color: #FFA94D; text-align: center; width: 100%;">ğŸ† 0</div>
  </div>
</div>

-->



<!--
    <div class="practice-cell" onclick="startPracticeWithPreFilledGridch32()">
  <div class="practice-text">NIV 2</div>
  <div class="practice-counter" id="practiceWinsch32">ğŸ† 0</div>
</div>

    <div class="practice-cell" onclick="startPracticeWithPreFilledGridch33()">
  <div class="practice-text">NIV 3</div>
  <div class="practice-counter" id="practiceWinsch33">ğŸ† 0</div>
</div>

    <div class="practice-cell" onclick="startPracticeWithPreFilledGridch34()">
  <div class="practice-text">NIV 4</div>
  <div class="practice-counter" id="practiceWinsch34">ğŸ† 0</div>
</div>

    <div class="practice-cell" onclick="startPracticeWithPreFilledGridch35()">
  <div class="practice-text">NIV 5</div>
  <div class="practice-counter" id="practiceWinsch35">ğŸ† 0</div>
</div>

    <div class="practice-cell" onclick="startPracticeWithPreFilledGridch36()">
  <div class="practice-text">NIV 6</div>
  <div class="practice-counter" id="practiceWinsch36">ğŸ† 0</div>
</div>

    <div class="practice-cell" onclick="startPracticeWithPreFilledGridch37()">
  <div class="practice-text">NIV 7</div>
  <div class="practice-counter" id="practiceWinsch37">ğŸ† 0</div>
</div>

    <div class="practice-cell" onclick="startPracticeWithPreFilledGridch38()">
  <div class="practice-text">NIV 8</div>
  <div class="practice-counter" id="practiceWinsch38">ğŸ† 0</div>
</div>

    <div class="practice-cell" onclick="startPracticeWithPreFilledGridch39()">
  <div class="practice-text">NIV 9</div>
  <div class="practice-counter" id="practiceWinsch39">ğŸ† 0</div>
</div>


    <div class="practice-cell">Veld 4</div>
    <div class="practice-cell">Veld 5</div>
    <div class="practice-cell">Veld 6</div>
    <div class="practice-cell">Veld 7</div>
    <div class="practice-cell">Veld 8</div>
    <div class="practice-cell">Veld 9</div>
-->

</div>



</div>


<!-- de 12 cellen -->

</div>
<div class="info-container">

<!-- multi-->

<div class="info-cell" id="multicolorDisplay" style="display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 0 6px;">
  <div style="display: flex; align-items: center; width: 100%;">
    <img alt="Multicolor" src="images/fig32.png" style="width: 33.33%; object-fit: contain;" />

<div style="width: 33.33%; display: flex; align-items: center; justify-content: center;">
  <div style="text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.60rem; color: #f4c644; line-height: 1.1; padding-top: 5px;">
    MULTI<br>COLOR
  </div>
</div>
    <div id="multicolorCount" style="width: 33.33%; font-size: 1rem; text-align: center; color: #f4c644; font-weight: bold;padding-top: 2px;">0</div>
  </div>
</div>


  <!-- leven -->

<div class="info-cell" id="livesDisplay" style="display: flex; justify-content: center; align-items: center; padding: 0 6px;">
  <div style="display: flex; align-items: center; width: 100%;">
    <img src="images/fig4.png" alt="Heart" style="width: 33.33%; object-fit: contain;" />

    <div style="width: 33.33%; display: flex; align-items: center; justify-content: center;">
      <div style="text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.75rem; color: #f4c644; line-height: 1.1; padding-top: 2px;">
        LIVES
      </div>
    </div>

    <div id="livesText" style="width: 33.33%; font-size: 1rem; text-align: center; color: #f4c644; font-weight: bold;padding-top: 2px;">5</div>
  </div>
</div>


<!-- pause -->

<div class="info-cell" id="pauseCell" style="display: flex; justify-content: center; align-items: center; padding: 0 6px;">
  <button id="pauseButton" style="all: unset; width: 100%;">
    <div style="display: flex; width: 100%; height: 100%; align-items: center;">
      <img alt="Pause" src="images/fig5.png" style="width: 50%; height: 90%; object-fit: contain;" />

      <div style="width: 50%; display: flex; align-items: center; justify-content: center;">
        <div style="text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.60rem; color: #f4c644; text-transform: uppercase; line-height: 1.1; padding-top: 2px;">
          PAUSE
        </div>
      </div>
    </div>
  </button>
</div>




<!-- skip block -->

<div class="info-cell" id="renewCell" style="display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 0 6px;">
  <div style="display: flex; width: 100%; height: 100%; align-items: center;">

    <!-- Linkse skip afbeelding -->
    <img alt="Skip Icon 1" src="images/fig6.png" style="width: 33.33%; height: 80%; object-fit: contain;" />

    <!-- Middelste skip afbeelding -->
  <div style="width: 33.33%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.60rem; color: #f4c644; line-height: 1.1; padding-top: 5px; text-transform: uppercase;">
  SKIP<br>BLOCK
</div>
    <!-- Rechterdeel met teller + horizontale progress bar -->
    <div style="position: relative; width: 33.33%; height: 100%; display: flex; align-items: center; justify-content: center;padding-top: 2px;">

      <!-- De oranje voortgangsbalk achter het cijfer -->
      <div id="renewProgressBar" style="
        position: absolute;
        left: 0;
        top: 20%;
        bottom: 20%;
        width: 0%;
        background-color: rgba(222, 105, 17, 0.4);
     
        border-radius: 4px;
        z-index: 1;
      "></div>

      <!-- Het cijfer, centraal -->
      <div id="renewCounter" style="
        position: relative;
        color: #f4c644;
        font-weight: bold;
        font-size: 1rem;
        font-family: 'Baloo Bhaina 2', sans-serif;
        text-align: center;
        z-index: 2;
      ">
        0
      </div>

    </div>

  </div>
</div>



<!-- score-->

<div class="info-cell" id="scoreDisplay" style="display: flex; align-items: center; justify-content: center; padding: 0 6px;">
  <div style="display: flex; width: 100%; align-items: center;">
    <img alt="Star" src="images/fig7.png" style="width: 33%; object-fit: contain;" />
    <div style="width: 33%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.75rem; color: #f4c644; line-height: 1.1; padding-top: 5px; text-transform: uppercase;">
  SCORE
</div>

    <div id="scoreValue" style="width: 34%; font-size: 0.7rem; text-align: center; color: #f4c644; font-weight: bold;padding-top: 4px;">0</div>
  </div>
</div>

<!-- shop-->

<div class="info-cell" id="shopCell" style="display: flex; justify-content: center; align-items: center; padding: 0 6px;">
  <button id="shopButton" style="all: unset; width: 100%;">
    <div style="display: flex; width: 100%; height: 100%; align-items: center;">
      <img src="images/fig8.png" alt="Shop Part 1" style="width: 50%; height: 90%; object-fit: contain;" />
      <div style="width: 50%; height: 100%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.85rem; color: #f4c644; line-height: 1.1; padding-top: 5px; text-transform: uppercase; display: flex; justify-content: center; align-items: center;">
  SHOP
</div>
    </div>
  </button>
</div>



<!-- free picture -->
<div class="info-cell" id="freePictureDisplay" style="display: flex; align-items: center; justify-content: center; gap: 4px; padding: 0 6px;" onclick="useFreePicture()">
  <img src="images/fig9.png" alt="Free Picture" style="width: 33%; object-fit: contain;" />
 <div style="width: 33%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.55rem; color: #f4c644; line-height: 1.1; padding-top: 5px; text-transform: uppercase;">
  TAKE A<br>PICTURE
</div>
  <span id="freePictureCount" style="width: 33%; text-align: center; color: #f4c644; font-weight: bold; font-size: 1rem; font-family: 'Baloo Bhaina 2', sans-serif;padding-top: 2px;">3</span>
</div>



<!-- level -->
<div class="info-cell" id="extraCell1" style="display: flex; align-items: center; justify-content: center; padding: 0 6px;">
  <div style="display: flex; width: 100%; align-items: center; position: relative; height: 100%;">

    <!-- Linkse icoon -->
    <img alt="Level icon 1" src="images/fig10.png" style="width: 33%; object-fit: contain;" />

    <!-- Midden: DJ SET + BEAT RATE -->
    <div style="
      width: 33%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2px;
      font-family: 'Baloo Bhaina 2', sans-serif;
      font-weight: bold;
      color: #f4c644;
      padding-top: 10px;
padding-bottom: 6px;
      box-sizing: border-box;
    ">
   <span style="font-size: 0.7rem; line-height: 0.9;">DJ SET</span>
  <span style="font-size: 0.7rem; line-height: 0.9;">BPM</span>
    </div>
<!-- Rechterdeel met LEVEL + BPM, voortgangsbalk enkel onder LEVEL -->
<div style="
  width: 34%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 2px;
   padding-top: 10px;
padding-bottom: 6px;
  box-sizing: border-box;
">

  <!-- Container voor level + voortgangsbalk -->
  <div style="position: relative; width: 100%; display: flex; justify-content: center;">
    <!-- Voortgangsbalk alleen onder level -->
    <div id="levelProgressBar" style="
      position: absolute;
      left: 0;
      top: 20%;
      height: 60%;
      width: 0%;
      background-color: rgba(222, 105, 17, 0.4);
      border-radius: 4px;
      z-index: 1;
    "></div>

    <!-- Level-cijfer -->
    <span id="levelDisplayExtra" style="
      position: relative;
      font-size: 0.7rem;
      line-height: 0.9;
      text-align: center;
      color: #f4c644;
      font-weight: bold;
      font-family: 'Baloo Bhaina 2', sans-serif;
      z-index: 2;
    ">0</span>
  </div>

  <!-- BPM-waarde -->
  <span id="bpmDisplay" style="
    font-size: 0.7rem;
    line-height: 0.9;
    text-align: center;
    color: #f4c644;
    font-weight: bold;
    font-family: 'Baloo Bhaina 2', sans-serif;
  ">0</span>



    </div>
  </div>
</div>





<!-- quest block -->
<div class="info-cell" id="levelDisplay" style="cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0 6px;" title="Klik voor challenge overzicht">
  <div style="display: flex; width: 100%;height: 100%; align-items: center;">
    <img id="levelImage" src="images/fig11.png" alt="Level" style="width: 50%;height: 100%; object-fit: contain;" />
<div id="challengeInfoText" style="width: 50%; height: 100%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.7rem; color: #f4c644; line-height: 1.1; padding-top: 5px; text-transform: uppercase; display: flex; justify-content: center; align-items: center;">
  PARTY<br>MISSIONS
</div>

  </div>
  <span id="levelValue" style="display: none;"></span>
</div>




<!-- bewaren-->

<div class="info-cell" id="saveScoreCell" style="display: flex; justify-content: center; align-items: center;">
  <div id="saveWrapper" style="display: flex; align-items: center; justify-content: center; width: 100%;height: 100%;padding: 0 6px;">
    <img src="images/fig12.png" style="width: 33.33%; object-fit: contain;">
 <div style="width: 33.33%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.60rem; color: #f4c644; line-height: 1.1; padding-top: 5px; text-transform: uppercase;">
  SAVE ?
</div>

    <span id="saveBlockCounter" style="width: 33.33%; text-align: center; color:  #f4c644; font-weight: bold; font-size: 1rem; font-family: 'Baloo Bhaina 2', sans-serif;">50</span>
  </div>
</div>





<!-- next star -->

<div class="info-cell" id="nextBlockDisplay" style="display: flex; justify-content: center; align-items: center; padding: 0 6px;">
  <div style="display: flex; width: 100%; align-items: center;">
    <img alt="Next Star 1" src="images/fig13.png" style="width: 33.33%; object-fit: contain;" />
   <div style="width: 33.33%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.60rem; color: #f4c644; line-height: 1.1; padding-top: 5px; text-transform: uppercase;">
  NEXT<br>STAR
</div>

    <div id="nextBlockPreview" style="width: 33.33%; display: flex; align-items: center; justify-content: center;"></div>
  </div>
</div>



<div class="info-cell" id="dropCell" style="display: flex; justify-content: center; align-items: center; padding: 0 6px;">
  <button onclick="returnToMenu()" style="all: unset; width: 100%; height: 100%;">
    <div style="display: flex; width: 100%; height: 100%; align-items: center;">
      <!-- Linkse afbeelding -->
      <img alt="Home" src="images/fig14.png" style="width: 50%; height: 90%; object-fit: contain;" />

      <!-- Rechtse tekst -->
      <div style="width: 50%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.75rem; color: #f4c644; line-height: 1.1; padding-top: 0px;">
        GO<br>HOME
      </div>
    </div>
  </button>
</div>


<!-- continue 

<div class="info-cell" id="dropCell" style="display: flex; justify-content: center; align-items: center; padding: 0 6px;">
  <button onclick="returnToMenu()" style="all: unset; width: 100%;">
    <div style="display: flex; width: 100%; height: 100%; align-items: center;">
      <img alt="Home" src="https://i.ibb.co/3YRwhWCd/Chat-GPT-Image-14-jun-2025-19-17-12.png" style="width: 100%; height: 100%; object-fit: contain;" />
    </div>
  </button>
</div>
-->

<!-- deze wekt niet
<div class="info-cell" id="homeCell" style="display: flex; justify-content: center; align-items: center; padding: 0 6px;">
  <button id="homeButton" onclick="returnToMenu()" style="all: unset; width: 100%;">
    <img alt="Home" src="https://i.ibb.co/3YRwhWCd/Chat-GPT-Image-14-jun-2025-19-17-12.png" style="width: 100%; height: 100%; object-fit: contain;" />
  </button>
</div>

<div class="info-cell" id="dropCell" style="cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0 6px;">
  <div id="dropButton" style="display: flex; width: 100%; height: 100%; align-items: center;">
    <img alt="Drop 1" src="https://i.ibb.co/HDpnknq9/square-format-transparent-background-designify-14.png" style="width: 50%; object-fit: contain;" />
    <img alt="Drop 2" src="https://i.ibb.co/ns18V4sz/Chat-GPT-Image-23-jun-2025-21-09-10.png" style="width: 50%; object-fit: contain;" />
  </div>
</div>

drop cell 
<div class="info-cell" id="dropButton" style="cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0 6px; border: 3px solid #e88a2d; border-radius: 10px;">
  <div style="display: flex; width: 100%; align-items: center;">
    <img id="dropImage1" src="https://i.ibb.co/HDpnknq9/square-format-transparent-background-designify-14.png" alt="Drop 1" style="width: 50%; object-fit: contain;" />
    <img id="dropImage2" src="https://i.ibb.co/ns18V4sz/Chat-GPT-Image-23-jun-2025-21-09-10.png" alt="Drop 2" style="width: 50%; object-fit: contain;" />
  </div>
  <span id="dropValue" style="display: none;"></span>
</div>

-->


</div>




<div class="orange-line top-line"></div>


<div id="container">
<div class="canvas-wrapper">
<div class="backgroundLayer"></div> <!-- Achtergrond voor het spel -->
<canvas height="1540" id="gameCanvas" width="1540"></canvas> <!-- Het speelveld -->
<div class="grid"></div> <!-- Subtiele grid laag boven de achtergrond -->
</div>


<div class="orange-line bottom-line"></div>

</div>



<!-- Voor verticale blokjes (â¬†ï¸ - reset - â¬‡ï¸) -->
<div class="controls vertical-controls">

<button class="up" onpointerdown="moveGridH(1)">
<img alt="Up" src="images/fig15.png" style="width: 100%; height: 100%; object-fit: contain;"/>
</button>


<div class="button-wrapper">




<button class="info-cell text-button" id="allTimeDisplay">
   <span id="highScoreValue"></span><br>
   <span id="highRoundValue"></span>
</button>



  <!--
  <button class="reset-btn" onclick="resetGrid()">
    <img alt="Reset" src="https://iili.io/FhzjWBt.md.png" /> 
  </button>
-->

<button class="reset-btn" onclick="resetGrid()" style="position: relative; display: flex; flex-direction: column; align-items: center;">
  <img id="resetImage" alt="Reset" src="images/fig16.png" />


</button>



<button class="home-btn" onclick="dropButton()">
  <img alt="Drop" src="images/fig17.png" style="width: 100%; height: 100%; object-fit: contain;" />
</button>





</div>



<button class="down" onpointerdown="moveGridH(-1)">
<img alt="Down" src="images/fig18.png" style="width: 100%; height: 100%; object-fit: contain;"/>
</button>

</div>

<!-- Voor horizontale blokjes (â¬…ï¸ - reset - â¡ï¸) -->
<div class="controls horizontal-controls">
<button class="left" onpointerdown="moveGrid(1)">
<img alt="Left" src="images/fig19.png" style="width: 100%; height: 100%; object-fit: contain;"/>
</button>



<div class="button-wrapper">

<button class="info-cell text-button" id="allTimeDisplay1">
   <span id="highScoreValue"></span><br>
   <span id="highRoundValue"></span>
</button>

<!--
  <button class="reset-btn" onclick="resetGrid()">
    <img alt="Reset" src="https://iili.io/FhzjWBt.md.png" /> 
  </button>
-->

<button class="reset-btn" onclick="resetGrid()" style="position: relative; display: flex; flex-direction: column; align-items: center;">
  <img id="resetImage1" alt="Reset" src="images/fig16.png" />


</button> 



<button class="home-btn" onclick="dropButton()">
  <img alt="Drop" src="images/fig17.png" style="width: 100%; height: 100%; object-fit: contain;" />
</button>

  <!--
  <button class="home-btn" onclick="returnToMenu()">
   <img alt="Home" src="https://i.ibb.co/3YRwhWCd/Chat-GPT-Image-14-jun-2025-19-17-12.png" /> 
  </button>

<button id="dropButton" onclick="dropBlock()" style="all: unset; width: 100%;">
  <div style="display: flex; width: 100%; height: 100%; align-items: center;">
    <img alt="Drop 1" src="https://i.ibb.co/HDpnknq9/square-format-transparent-background-designify-14.png" style="width: 50%; height: 70%; object-fit: contain;" />
    <img alt="Drop 2" src="https://i.ibb.co/ns18V4sz/Chat-GPT-Image-23-jun-2025-21-09-10.png" style="width: 50%; height: 70%; object-fit: contain;" />
  </div>
</button>
-->



</div>

<button class="right" onpointerdown="moveGrid(-1)">
<img alt="Right" src="images/fig20.png" style="width: 100%; height: 100%; object-fit: contain;"/>
</button>
</div>


<!--
<button class="reset" onclick="resetGrid()">
<img alt="Reset" src="https://iili.io/3XL22Rt.png" style="width: 100%; height: 100%; object-fit: contain;"/>
</button>
-->

<!-- layer van de levels met de 9 challengecellen -->
 <!-- height 100vh toegevoegd -->


  <!-- 
<div id="levelMatrixOverlay" style="
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  max-height: 100vh; /* â† dit zorgt dat scrollen mogelijk is */
  height: 100vh;
  background-color: rgba(0, 0, 0, 0.9);
  z-index: 99999;
  justify-content: center;
  align-items: flex-start;
padding-top: 10px;
  font-family: 'Baloo Bhaina 2', sans-serif;
  flex-direction: column;
  padding: 20px;
  box-sizing: border-box;
  overflow-y: auto;
">


<div style="color: #e88a2d; font-size: 2rem; font-weight: bold; margin-bottom: 20px;">
    CHALLENGE TIME
</div>
 -->

<div id="levelMatrixOverlay" style="
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: #1c1712; /* donkerbruin/retrozwart zoals op poster */
  z-index: 99999;
  padding: 40px 20px;
  box-sizing: border-box;
  overflow-y: auto;
  font-family: 'Baloo Bhaina 2', sans-serif;
  text-align: center;
">

<!--
<div style="text-align: center; margin-bottom: 20px;">
  <img src="https://iili.io/FNA6els.md.png" alt="Party Missions Info" style="max-width: 100%; height: auto; width: 100%; max-width: 500px; border-radius: 12px;" />
</div>
 -->
 
<div style="text-align: center; margin-bottom: 28px;">
  <img src="images/fig21.png" alt="Party Missions" style="max-width: 100%; height: auto; border-radius: 10px;">
</div>




  <div id="fallSpeedDisplay" style="color: #FFA94D; font-size: 1.3rem; font-weight: bold; background: #2f261f; padding: 10px 20px; border-radius: 12px; margin-bottom: 20px;">
  Speed: ...
</div>

<button onclick="closeLevelMatrixOverlay()" style="
  margin-top: 20px;
  margin-bottom: 20px;
  background: #e88a2d;
  color: black;
  border: none;
  padding: 0.8rem;
  width: 100%;
  max-width: 700px;
  border-radius: 12px;
  font-weight: bold;
  font-size: 1.1rem;
  box-shadow: 0 0 8px #FFA94D;
  cursor: pointer;
  display: block;
  margin-left: auto;
  margin-right: auto;
">
  RETURN TO THE PARTY
</button>


<!-- 
 <div style="display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, auto); gap: 14px; width: 90vw; max-width: 700px;">
 -->

<div style="display: flex; flex-direction: column; gap: 14px; width: 90vw; max-width: 700px;">


<div class="challenge-cell inactive" id="challengeStatusCell"></div>
<div class="challenge-cell inactive" id="challenge2StatusCell"></div>
<div class="challenge-cell inactive" id="challenge3StatusCell"></div>
<div class="challenge-cell inactive" id="challenge4StatusCell"></div>
<div class="challenge-cell inactive" id="challenge5StatusCell"></div>
<div class="challenge-cell inactive" id="challenge6StatusCell"></div>
<div class="challenge-cell inactive" id="challenge7StatusCell"></div>



<!--
<div style="border: 2px solid #e88a2d; border-radius: 10px; padding: 12px; color: #FFE680; text-align: center; font-size: 0.9rem; box-shadow: 0 0 10px #e88a2d;">
<div style="font-size: 1.2rem;">âŒâŒâŒ</div>
<div>Challenge volgt</div>
</div>

<div style="border: 2px solid #e88a2d; border-radius: 10px; padding: 12px; color: #FFE680; text-align: center; font-size: 0.9rem; box-shadow: 0 0 10px #e88a2d;">
<div style="font-size: 1.2rem;">âŒâŒâŒ</div>
<div>Challenge volgt</div>
</div>
 -->

</div>





</div>

<!-- onterechte code

<div id="challengeGridOverlay" style="
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0, 0, 0, 0.85);
  z-index: 99999;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
  box-sizing: border-box;
  font-family: 'Baloo Bhaina 2', sans-serif;
">
<div style="display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); gap: 10px; width: 90vw; max-width: 700px; height: 90vh;">
<div id="challengeCell1" style="
      background: rgba(255, 255, 255, 0.07);
      border: 2px solid #e88a2d;
      border-radius: 12px;
      padding: 16px;
      color: #FFE680;
      font-size: 1rem;
      box-shadow: 0 0 10px #e88a2d;
      overflow-y: auto;
    ">
<h2 style="margin-top: 0;">ğŸ¯ Challenge 1</h2>
<p id="challengeDetails">Laden...</p>
</div>

<div style="border: 2px dashed #555; border-radius: 12px;"></div>
<div style="border: 2px dashed #555; border-radius: 12px;"></div>
<div style="border: 2px dashed #555; border-radius: 12px;"></div>
<div style="border: 2px dashed #555; border-radius: 12px;"></div>
<div style="border: 2px dashed #555; border-radius: 12px;"></div>
<div style="border: 2px dashed #555; border-radius: 12px;"></div>
<div style="border: 2px dashed #555; border-radius: 12px;"></div>
<div style="border: 2px dashed #555; border-radius: 12px;"></div>
</div>

<button onclick="closeChallengeGridOverlay()" style="
    position: absolute;
    top: 20px;
    right: 20px;
    background: #e88a2d;
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 10px;
    font-weight: bold;
    font-size: 1rem;
    box-shadow: 0 0 8px #FFA94D;
    cursor: pointer;
  ">Sluiten</button>
</div>
onterechte code  -->

<div id="saveConfirmOverlay" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(20,20,20,0.9); z-index: 9999; justify-content: center; align-items: center; flex-direction: column; font-family: 'Baloo Bhaina 2', sans-serif;">
  <img src="images/fig22.png" alt="Save popup" style="max-width: 80%; height: auto; margin-bottom: 20px;">
  <div style="display: flex; gap: 20px;">
    <button id="saveYesBtn" style="font-size: 1.2rem; padding: 10px 20px; background-color: #B65A0D; color: white; border: none; border-radius: 8px;">Yes</button>
    <button id="saveNoBtn" style="font-size: 1.2rem; padding: 10px 20px; background-color: #888; color: white; border: none; border-radius: 8px;">No</button>
  </div>
</div>



<div id="pauseModal" style="
  display: none;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 22vh;
  background: rgba(0, 0, 0, 0.9);
  border-bottom: 3px solid #e88a2d;
  z-index: 9999;
  text-align: center;
  font-family: 'Baloo Bhaina 2', sans-serif;
  flex-direction: column;
  justify-content: center;
  align-items: center;
">

  <img src="images/fig23.png" alt="Paused" style="
    max-height: 80%;
    max-width: 90%;
    object-fit: contain;
    margin-bottom: 4px;
  " />

  <button onclick="closePauseModal()" style="
    background: #F4A300;  /* Nieuw: zachter oranje, passend bij hangmatkleur */
    color: black;
    padding: 6px 12px;
    border: none;
    border-radius: 8px;
    font-weight: bold;
    font-size: 1rem;
    box-shadow: 0 0 8px #F4A300;
    cursor: pointer;
  ">Continue the party</button>

</div>





<div id="shopModal" style="
  display: none;
  position: fixed;
  top: 40%;
  left: 50%;
  transform: translate(-50%, -50%);
  
  background: rgba(0, 0, 0, 0.9);
  border: 3px solid #e88a2d;
  border-radius: 10px;
  padding: 20px;
  z-index: 9999;
  text-align: center;
  font-family: 'Baloo Bhaina 2', sans-serif;
width: 90vw; max-width: 500px;
">

<div style="color: #e88a2d; margin-bottom: 10px; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif;">
  <h2 style="margin: 0; font-size: 1.4rem;">Welcome to the Block Party Shop</h2>

</div>

<div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 10px;">

  <button onclick="buyFreePicture()" style="display: flex; align-items: center; background-color: #222; border: 2px solid #e88a2d; border-radius: 8px; padding: 10px; width: 100%;">
    <img id="freePictureImage" src="images/fig24.png" alt="Free Picture" style="width: 60px; height: 60px; object-fit: contain; margin-right: 12px;"/>
    <span style="color: #f4c644; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 1rem;">Buy a "Take a Free Picture" for 500 points.</span>
  </button>

  <button onclick="buyMulticolor()" style="display: flex; align-items: center; background-color: #222; border: 2px solid #e88a2d; border-radius: 8px; padding: 10px; width: 100%;">
    <img id="multicolorImage" src="images/fig25.png" alt="Multicolor" style="width: 60px; height: 60px; object-fit: contain; margin-right: 12px;"/>
    <span style="color: #f4c644; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 1rem;">Buy a "Multicolor Block" for 250 points.</span>
  </button>

  <button onclick="buySkipBlock()" style="display: flex; align-items: center; background-color: #222; border: 2px solid #e88a2d; border-radius: 8px; padding: 10px; width: 100%;">
    <img id="skipBlockImage" src="images/fig26.png" alt="Skip Block" style="width: 60px; height: 60px; object-fit: contain; margin-right: 12px;"/>
    <span style="color: #f4c644; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 1rem;">Buy a"Skip a Block" for 25 points.</span>
  </button>

</div>



<button onclick="closeShopModal()" style="margin-top: 10px; background-color: #e88a2d; color: black; padding: 6px 12px; border: none; border-radius: 6px; font-weight: bold;">
    RETURN TO THE PARTY
  </button>
</div>



<!-- 
<div style="color: #e88a2d; margin-bottom: 10px; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif;">
  <h2 style="margin: 0; font-size: 1.4rem;">Welcome to the Block Party Shop</h2>
</div>

<div style="display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 20px;">

  <button onclick="buyFreePicture()" style="padding: 0; background-color: #222; border: 2px solid #e88a2d; border-radius: 8px;">
    <img id="freePictureImage" src="https://i.ibb.co/Q4yVM4K/Chat-GPT-Image-29-jun-2025-00-46-08.png" alt="Free Picture" style="width: 60px; height: 60px; object-fit: contain;"/>
  </button>

  <button onclick="buyMulticolor()" style="padding: 0; background-color: #222; border: 2px solid #e88a2d; border-radius: 8px;">
    <img id="multicolorImage" src="https://i.ibb.co/yFpZ0V44/Chat-GPT-Image-29-jun-2025-00-45-59.png" alt="Multicolor" style="width: 60px; height: 60px; object-fit: contain;"/>
  </button>

  <button onclick="buySkipBlock()" style="padding: 0; background-color: #222; border: 2px solid #e88a2d; border-radius: 8px;">
    <img id="skipBlockImage" src="https://i.ibb.co/PZSTkGg4/Chat-GPT-Image-29-jun-2025-00-49-57.png" alt="Skip Block" style="width: 60px; height: 60px; object-fit: contain;"/>
  </button>

</div>

<div style="text-align: center;">
  <button onclick="closeShopModal()" style="background-color: #e88a2d; color: black; padding: 8px 16px; border: none; border-radius: 6px; font-weight: bold;">
    RETURN TO THE PARTY
  </button>
</div>
-->


<div id="colorChoiceModal" style="
  display: none;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 22vh;
  background: none;
  z-index: 9999;
  font-family: 'Baloo Bhaina 2', sans-serif;
  justify-content: center;
  align-items: center;
">
  <div class="color-wrapper" style="
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: rgba(0, 0, 0, 0.9);
    border: 3px solid #e88a2d;
    border-radius: 12px;
    padding: 10px;
    width: 95%;
    max-width: 600px;
    box-shadow: 0 0 10px #e88a2d;
    margin: 0 auto;
  ">
    <h2 id="colorChoiceText" style="
      font-size: 1.2rem;
      font-weight: 700;
      color: #e88a2d;
      margin-bottom: 10px;
      line-height: 1.2;
      text-align: center;
    "></h2>

    <div id="colorOptions" style="
      display: flex;
      gap: 10px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      max-width: 100%;
      max-height: 60px;
      overflow: hidden;
    "></div>
  </div>
</div>



<script>

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
  
    const gridCols = 10;
    const gridRows = 10;
    const blockSize = 50;
    const extraRowsAbove = 10;
    const extraRowsBelow = 10;
    const extraColsLeft = 10;
    const extraColsRight = 10;
    const visibleCols = 30;
    let gridOffsetX = 0;
    let gridOffsetY = 0;
    const maxOffset = 10;
    const maxOffsetY = 10;

const defaultDivaChance = 1 / 10;      // 10% kans normaal
const challenge5DivaChance = 1 / 5;     // bijv. 20% kans tijdens challenge 5

let practiceChallenge1Wins11 = 0;
let practiceChallenge1Wins12 = 0;
let practiceChallenge1Wins13 = 0;
let practiceChallenge1Wins14 = 0;
let practiceChallenge1Wins15 = 0;
let practiceChallenge1Wins16 = 0;
let practiceChallenge1Wins17 = 0;
let practiceChallenge1Wins18 = 0;
let practiceChallenge1Wins19 = 0;

let practiceChallenge2Wins21 = 0;
let practiceChallenge2Wins22 = 0;
let practiceChallenge2Wins23 = 0;
let practiceChallenge2Wins24 = 0;
let practiceChallenge2Wins25 = 0;
let practiceChallenge2Wins26 = 0;
let practiceChallenge2Wins27 = 0;
let practiceChallenge2Wins28 = 0;
let practiceChallenge2Wins29 = 0;


let practiceChallenge3Wins31 = 0;
let practiceChallenge3Wins32 = 0;
let practiceChallenge3Wins33 = 0;
let practiceChallenge3Wins34 = 0;
let practiceChallenge3Wins35 = 0;
let practiceChallenge3Wins36 = 0;
let practiceChallenge3Wins37 = 0;
let practiceChallenge3Wins38 = 0;
let practiceChallenge3Wins39 = 0;

let practiceChallenge4Wins41 = 0;
let practiceChallenge4Wins42 = 0;
let practiceChallenge4Wins43 = 0;
let practiceChallenge4Wins44 = 0;
let practiceChallenge4Wins45 = 0;
let practiceChallenge4Wins46 = 0;
let practiceChallenge4Wins47 = 0;
let practiceChallenge4Wins48 = 0;
let practiceChallenge4Wins49 = 0;

let practiceChallenge5Wins51 = 0;
let practiceChallenge5Wins52 = 0;
let practiceChallenge5Wins53 = 0;
let practiceChallenge5Wins54 = 0;
let practiceChallenge5Wins55 = 0;
let practiceChallenge5Wins56 = 0;
let practiceChallenge5Wins57 = 0;
let practiceChallenge5Wins58 = 0;
let practiceChallenge5Wins59 = 0;

let practiceChallenge6Wins61 = 0;
let practiceChallenge6Wins62 = 0;
let practiceChallenge6Wins63 = 0;
let practiceChallenge6Wins64 = 0;
let practiceChallenge6Wins65 = 0;
let practiceChallenge6Wins66 = 0;
let practiceChallenge6Wins67 = 0;
let practiceChallenge6Wins68 = 0;
let practiceChallenge6Wins69 = 0;

let practiceChallenge7Wins71 = 0;
let practiceChallenge7Wins72 = 0;
let practiceChallenge7Wins73 = 0;
let practiceChallenge7Wins74 = 0;
let practiceChallenge7Wins75 = 0;
let practiceChallenge7Wins76 = 0;
let practiceChallenge7Wins77 = 0;
let practiceChallenge7Wins78 = 0;
let practiceChallenge7Wins79 = 0;


let fallInterval;

let round = 1;

let freePictureCount = 5;

let saveBlockCountdown = 1;
let saveUnlocked = false;

let levelProgressThreshold = 8;


// beeld fototoestel


const freePictureIcon = new Image();
freePictureIcon.src = "images/fig27.png";

const freePictureIcon2 = new Image();
freePictureIcon2.src = "images/fig28.png";


// w niet gebruikt
    const blockImage = new Image();
    blockImage.src = "images/fig29.png";
// w niet gebruikt
    const specialImage2 = new Image();
    specialImage2.src = "images/fig30.png";


// beeld van wit hartje
    const specialImage = new Image();
    specialImage.src = "images/fig31.png";

// beeld multicolor    
    const multicolorImage = new Image();
    multicolorImage.src = "images/fig32.png";

    const multicolorImage2 = new Image();
    multicolorImage2.src = "images/fig33.png" ;

// vanaf waar telt diva
    let divaCountdown = 10;  // Startwaarde voor de diva-timer
// hoe vaak
    const multicolorSpawnChance = 1 / 25; // frequentie multicolor

let practiceModech11 = false;
let practiceModech12 = false;
let practiceModech13 = false;
let practiceModech14 = false;
let practiceModech15 = false;
let practiceModech16 = false;
let practiceModech17 = false;
let practiceModech18 = false;
let practiceModech19 = false;

let practiceModech21 = false;
let practiceModech22 = false;
let practiceModech23 = false;
let practiceModech24 = false;
let practiceModech25 = false;
let practiceModech26 = false;
let practiceModech27 = false;
let practiceModech28 = false;
let practiceModech29 = false;


    let practiceModech31 = false;
    let practiceModech32 = false;
    let practiceModech33 = false;
    let practiceModech34 = false;
    let practiceModech35 = false;
    let practiceModech36 = false;
    let practiceModech37 = false;
    let practiceModech38 = false;
    let practiceModech39 = false;

let practiceModech41 = false;
let practiceModech42 = false;
let practiceModech43 = false;
let practiceModech44 = false;
let practiceModech45 = false;
let practiceModech46 = false;
let practiceModech47 = false;
let practiceModech48 = false;
let practiceModech49 = false;

let practiceModech51 = false;
let practiceModech52 = false;
let practiceModech53 = false;
let practiceModech54 = false;
let practiceModech55 = false;
let practiceModech56 = false;
let practiceModech57 = false;
let practiceModech58 = false;
let practiceModech59 = false;

let practiceModech61 = false;
let practiceModech62 = false;
let practiceModech63 = false;
let practiceModech64 = false;
let practiceModech65 = false;
let practiceModech66 = false;
let practiceModech67 = false;
let practiceModech68 = false;
let practiceModech69 = false;

let practiceModech71 = false;
let practiceModech72 = false;
let practiceModech73 = false;
let practiceModech74 = false;
let practiceModech75 = false;
let practiceModech76 = false;
let practiceModech77 = false;
let practiceModech78 = false;
let practiceModech79 = false;


// Welk level activeert de challenge? AANPASSEN
let challengeLevel = 15; 
let challenge2Level = 20;
let challenge3Level = 25;
let challenge4Level = 30;
let challenge5StartLevel = 35; 
let challenge6Level = 40;
let challenge7Level = 45;

let originalChallengeLevel = challengeLevel;
let originalChallenge2Level = challenge2Level;
let originalChallenge3Level = challenge3Level;
let originalChallenge4Level = challenge4Level;
let originalChallenge5StartLevel = challenge5StartLevel;
let originalChallenge6Level = challenge6Level;
let originalChallenge7Level = challenge7Level;


// param chal 1
let challengeBlockLimit = 100;
let challengeHeartTarget = 30; // AANPASSEN

// param chal 2
let challenge2BlockLimit = 100;
let challenge2MultiTarget = 30; // vrij te spelen multicolor

// param chal 3
let challenge3Limit = 100;

// param chal 4
let challenge4Limit = 100;

// param chal 5
let challenge5RequiredBlocks = 100; // aanpassen

// param chal 6 - stopt op 100, manueel ingegeven
let challenge6Active = false;
let challenge6BlockCounter = 0;
let challenge6SixGroupCount = 0;
let challenge6Done = false;
let challenge6Success = false;
let challenge6RewardGiven = false;

// paam chal 7
let challenge7Active = false;
let challenge7BlockCount = 0;
let challenge7GroupCount = 0;

const challenge7BlockLimit = 100;
const challenge7TargetGroups = 10;

const challenge7StartSpeed = 400;
const challenge7SpeedStep = 2;


let challenge7Done = false;
let challenge7Success = false;
let challenge7RewardGiven = false;

const defaultFallSpeed = 400;
let fallSpeed = defaultFallSpeed;

let fallSpeedBeforeChallenge7 = fallSpeed;

let challenge1Done = false;
let challenge2Done = false;
let challenge3Done = false;
let challenge4Done = false;
let challengeLocked = false;
let challengeActive = false;

let blockCounter = 0;

let challenge2SuccessImageShown = false;
let challenge2PendingMulticolors = 0;

let challengeHeartCount = 0;
let challengeHeartOverrideCounter = 0;
let preventHeartReward = false;
let challengeBlockCounter = 0; 
let challengeRewardGiven = false; 
let challenge1Success = false;

let challenge2Active = false;
let challenge2MultiCount = 0;

let challenge2BlockCounter = 0;
let challenge2RewardGiven = false;
let challenge3RewardGiven = false;
let challenge5RewardGiven = false;



let challenge2Success = false;

let challenge3Active = false;
let challenge3Started = false;
let challenge3Failed = false;
let challenge3Success = false;
let challenge3Count = 0;

let challenge4Active = false;

let challenge4Count = 0;
let challenge4FullFieldMoments = 0;
let challenge4Success = false;
let challenge4RewardGiven = false;

let challenge5Active = false;
let challenge5Done = false;
let challenge5Success = false;
let challenge5BlockCounter = 0;
let challenge5StartImageShown = false;
let challenge5SuccessImageShown = false;
let challenge5Started = false;

let passedChallenge1 = false;
let passedChallenge2 = false;
let passedChallenge3 = false;
let passedChallenge4 = false;
let passedChallenge5 = false;
let passedChallenge6 = false;
let passedChallenge7 = false;

let passedChallenge1c = false;
let passedChallenge2c = false;
let passedChallenge3c = false;
let passedChallenge4c = false;
let passedChallenge5c = false;
let passedChallenge6c = false;
let passedChallenge7c = false;

// beelden en par bij opleiding

let level1FixedColor = null;
const level1FixedLength = 1;
let level2ImageShown = false;
let level3ImageShown = false;
let level4ImageShown = false;
let level5ImageShown = false;
let level6ImageShown = false;
let level7ImageShown = false;
let level8ImageShown = false;

let level6Triggered = false;
let level7Triggered = false;
let level8Triggered = false;
let level9Triggered = false;
let level10Triggered = false;    





// allerlei 
    
let forcedNextBlock = null;
let heartFreed = false;

// start
let level = 1;
let bigGroupCount = 0;
let pauseUsesLeft = 1000;
let nextBlockColor = null;
let blockSpawnCount = 0;
let blockSpawnCountfree = 0;
let renewTokenCount = 5;
let nextBlock = null;
let multicolorCount = 5;
let skipUsesLeft = 0;
let nextBlockIsMulticolor = false;
let lives = 5;
let renewcounter = 2;
let score = 0;
let useVertical = true;
let isPaused = false;
let gamePaused = true;

const nextBlockDisplay = document.getElementById("nextBlockDisplay");
//const renewBar = document.getElementById("renewBar");
//const renewCircle = document.getElementById("renewProgressCircle");
const renewCounter = document.getElementById("renewCounter");
const multicolorDisplay = document.getElementById("multicolorCount");
const livesDisplay = document.getElementById("livesDisplay");
const scoreDisplay = document.getElementById("scoreDisplay");
const pauseButton = document.getElementById('pauseButton');
const imgElement = pauseButton.querySelector('img');

// beelden per kleur van vrijspelen groepje van 5 - vera,derd naar tekeningen zonder kleur
//let resetImages = {
//  "#4A90E2": "https://i.ibb.co/MkLQKJZT/landscape-format-transparent-background-shadow-designify-10.png",
//  "#7ED321": "https://i.ibb.co/nqxnLm8T/landscape-format-transparent-background-shadow-designify-9.png",
//  "#F8E71C": "https://i.ibb.co/C5xKZ9xy/landscape-format-transparent-background-shadow-designify-8.png",
//  "#DEDEDE": "https://i.ibb.co/sJHgkqQD/landscape-format-transparent-background-shadow-designify-7.png",
//  "#9B51E0": "https://i.ibb.co/R4tR3sj8/landscape-format-transparent-background-shadow-designify-6.png",
//  "#50E3C2": "https://i.ibb.co/KxJZRMDV/landscape-format-transparent-background-shadow-designify-5.png",
//  "#FF6F61": "https://i.ibb.co/Z69V4NTz/landscape-format-transparent-background-shadow-designify-4.png"
//};

// beelden per kleur van vrijspelen groepje van 5 - vera,derd naar tekeningen zonder kleur
let resetImages = {
  "#4A90E2": "images/fig34.png",
  "#7ED321": "images/fig34.png",
  "#F8E71C": "images/fig34.png",
  "#DEDEDE": "images/fig34.png",
  "#9B51E0": "images/fig34.png",
  "#50E3C2": "images/fig34.png",
  "#FF6F61": "images/fig34.png"



    // "#4A90E2": "https://i.ibb.co/v49v32Jj/landscape-format-transparent-background-shadow-designify-17.png",
 // "#7ED321": "https://i.ibb.co/S9Kf21m/landscape-format-transparent-background-shadow-designify-16.png",
 // "#F8E71C": "https://i.ibb.co/v4K2ZkKP/landscape-format-transparent-background-shadow-designify-15.png",
 // "#DEDEDE": "https://i.ibb.co/DgtbR89f/landscape-format-transparent-background-shadow-designify-14.png",
 // "#9B51E0": "https://i.ibb.co/60XQY94D/landscape-format-transparent-background-shadow-designify-13.png",
 // "#50E3C2": "https://i.ibb.co/60xSc47p/landscape-format-transparent-background-shadow-designify-12.png",
 // "#FF6F61": "https://i.ibb.co/qFMfhqtb/landscape-format-transparent-background-shadow-designify-11.png"
};


let originalResetImage = "images/fig35.png";
let resetButtonElements = document.querySelectorAll(".reset-btn img");


document.addEventListener('DOMContentLoaded', function() {
    updateControls();});


    // smiling faces bij landen 
const images = [
  Object.assign(new Image(), { src: "images/fig36.png" }),
  Object.assign(new Image(), { src: "images/fig37.png"}),
  Object.assign(new Image(), { src: "images/fig38.png"}),
  Object.assign(new Image(), { src: "images/fig39.png"}),
  Object.assign(new Image(), { src: "images/fig41.png"})
];

const altImages = [
  Object.assign(new Image(), { src: "images/fig36.png" }),
  Object.assign(new Image(), { src: "images/fig37.png"}),
  Object.assign(new Image(), { src: "images/fig38.png"}),
  Object.assign(new Image(), { src: "images/fig39.png"}),
  Object.assign(new Image(), { src: "images/fig41.png"})
];

//const altImages = [
//  Object.assign(new Image(), { src: "https://iili.io/Fw4zMt1.md.png" }),
//  Object.assign(new Image(), { src: "https://iili.io/Fw4T8CX.md.png" }),
//  Object.assign(new Image(), { src: "https://iili.io/Fw6YPea.md.png" }),
//  Object.assign(new Image(), { src: "https://iili.io/Fw65fqP.md.png" }),
//  Object.assign(new Image(), { src: "https://iili.io/Fw4ofDX.md.png" })
//];



let field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));

const colors = [
"#4A90E2", // Blauw
  "#7ED321", // Groen
  "#F8E71C", // Geel
  "#DEDEDE", // Rood
  "#9B51E0", // Paars
  "#50E3C2", // Turkoois
  "#FF6F61"  // Koraalroze
];

// onnodig
let markedForRemoval = [];
let disappearingBlocks = [];


// XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX start van de functies


// wat de skip block doet, maar zouden we ook in een functie kunnen zetten

const renewCell = document.getElementById("renewCell");

renewCell.addEventListener("click", () => {
  if (challengeActive) {
    showCelebrationOverlay("images/fig42.png", 1600); // waarschuwing Challenge 1
    return;
  }

  if (challenge2Active) {
    showCelebrationOverlay("images/fig42.png", 1600); // waarschuwing Challenge 2
    return;
  }

  if (renewTokenCount < 1) {
    return; // eventueel later een aparte melding of animatie
  }

  renewTokenCount--;
  updateRenewDisplay();

  fallingBlock = useVertical
    ? createBlock(fallingBlock.direction)
    : createBlockH(fallingBlock.direction);

  drawGrid();
  drawFallingBlock();
});



function showGameOverScreen() {
  document.getElementById("gameOverOverlay").style.display = "flex";
}

function returnToMenu1() {
  document.getElementById("gameOverOverlay").style.display = "none";
  document.getElementById("startOverlay").style.display = "flex";
}


function updatePracticeCellTeller() {

const el11 = document.getElementById("practiceWinsch11");
if (el11) el11.innerText = "ğŸ† " + practiceChallenge1Wins11;

const el12 = document.getElementById("practiceWinsch12");
if (el12) el12.innerText = "ğŸ† " + practiceChallenge1Wins12;

const el13 = document.getElementById("practiceWinsch13");
if (el13) el13.innerText = "ğŸ† " + practiceChallenge1Wins13;

const el14 = document.getElementById("practiceWinsch14");
if (el14) el14.innerText = "ğŸ† " + practiceChallenge1Wins14;

const el15 = document.getElementById("practiceWinsch15");
if (el15) el15.innerText = "ğŸ† " + practiceChallenge1Wins15;

const el16 = document.getElementById("practiceWinsch16");
if (el16) el16.innerText = "ğŸ† " + practiceChallenge1Wins16;

const el17 = document.getElementById("practiceWinsch17");
if (el17) el17.innerText = "ğŸ† " + practiceChallenge1Wins17;

const el18 = document.getElementById("practiceWinsch18");
if (el18) el18.innerText = "ğŸ† " + practiceChallenge1Wins18;

const el19 = document.getElementById("practiceWinsch19");
if (el19) el19.innerText = "ğŸ† " + practiceChallenge1Wins19;


const el21 = document.getElementById("practiceWinsch21");
if (el21) el21.innerText = "ğŸ† " + practiceChallenge2Wins21;

const el22 = document.getElementById("practiceWinsch22");
if (el22) el22.innerText = "ğŸ† " + practiceChallenge2Wins22;

const el23 = document.getElementById("practiceWinsch23");
if (el23) el23.innerText = "ğŸ† " + practiceChallenge2Wins23;

const el24 = document.getElementById("practiceWinsch24");
if (el24) el24.innerText = "ğŸ† " + practiceChallenge2Wins24;

const el25 = document.getElementById("practiceWinsch25");
if (el25) el25.innerText = "ğŸ† " + practiceChallenge2Wins25;

const el26 = document.getElementById("practiceWinsch26");
if (el26) el26.innerText = "ğŸ† " + practiceChallenge2Wins26;

const el27 = document.getElementById("practiceWinsch27");
if (el27) el27.innerText = "ğŸ† " + practiceChallenge2Wins27;

const el28 = document.getElementById("practiceWinsch28");
if (el28) el28.innerText = "ğŸ† " + practiceChallenge2Wins28;

const el29 = document.getElementById("practiceWinsch29");
if (el29) el29.innerText = "ğŸ† " + practiceChallenge2Wins29;


  const el31 = document.getElementById("practiceWinsch31");
  if (el31) el31.innerText = "ğŸ† " + practiceChallenge3Wins31;

  const el32 = document.getElementById("practiceWinsch32");
  if (el32) el32.innerText = "ğŸ† " + practiceChallenge3Wins32;

  const el33 = document.getElementById("practiceWinsch33");
  if (el33) el33.innerText = "ğŸ† " + practiceChallenge3Wins33;

  const el34 = document.getElementById("practiceWinsch34");
  if (el34) el34.innerText = "ğŸ† " + practiceChallenge3Wins34;

  const el35 = document.getElementById("practiceWinsch35");
  if (el35) el35.innerText = "ğŸ† " + practiceChallenge3Wins35;

  const el36 = document.getElementById("practiceWinsch36");
  if (el36) el36.innerText = "ğŸ† " + practiceChallenge3Wins36;

  const el37 = document.getElementById("practiceWinsch37");
  if (el37) el37.innerText = "ğŸ† " + practiceChallenge3Wins37;

  const el38 = document.getElementById("practiceWinsch38");
  if (el38) el38.innerText = "ğŸ† " + practiceChallenge3Wins38;

  const el39 = document.getElementById("practiceWinsch39");
  if (el39) el39.innerText = "ğŸ† " + practiceChallenge3Wins39;

// Challenge 4
const el41 = document.getElementById("practiceWinsch41");
if (el41) el41.innerText = "ğŸ† " + practiceChallenge4Wins41;

const el42 = document.getElementById("practiceWinsch42");
if (el42) el42.innerText = "ğŸ† " + practiceChallenge4Wins42;

const el43 = document.getElementById("practiceWinsch43");
if (el43) el43.innerText = "ğŸ† " + practiceChallenge4Wins43;

const el44 = document.getElementById("practiceWinsch44");
if (el44) el44.innerText = "ğŸ† " + practiceChallenge4Wins44;

const el45 = document.getElementById("practiceWinsch45");
if (el45) el45.innerText = "ğŸ† " + practiceChallenge4Wins45;

const el46 = document.getElementById("practiceWinsch46");
if (el46) el46.innerText = "ğŸ† " + practiceChallenge4Wins46;

const el47 = document.getElementById("practiceWinsch47");
if (el47) el47.innerText = "ğŸ† " + practiceChallenge4Wins47;

const el48 = document.getElementById("practiceWinsch48");
if (el48) el48.innerText = "ğŸ† " + practiceChallenge4Wins48;

const el49 = document.getElementById("practiceWinsch49");
if (el49) el49.innerText = "ğŸ† " + practiceChallenge4Wins49;

// Challenge 5
const el51 = document.getElementById("practiceWinsch51");
if (el51) el51.innerText = "ğŸ† " + practiceChallenge5Wins51;

const el52 = document.getElementById("practiceWinsch52");
if (el52) el52.innerText = "ğŸ† " + practiceChallenge5Wins52;

const el53 = document.getElementById("practiceWinsch53");
if (el53) el53.innerText = "ğŸ† " + practiceChallenge5Wins53;

const el54 = document.getElementById("practiceWinsch54");
if (el54) el54.innerText = "ğŸ† " + practiceChallenge5Wins54;

const el55 = document.getElementById("practiceWinsch55");
if (el55) el55.innerText = "ğŸ† " + practiceChallenge5Wins55;

const el56 = document.getElementById("practiceWinsch56");
if (el56) el56.innerText = "ğŸ† " + practiceChallenge5Wins56;

const el57 = document.getElementById("practiceWinsch57");
if (el57) el57.innerText = "ğŸ† " + practiceChallenge5Wins57;

const el58 = document.getElementById("practiceWinsch58");
if (el58) el58.innerText = "ğŸ† " + practiceChallenge5Wins58;

const el59 = document.getElementById("practiceWinsch59");
if (el59) el59.innerText = "ğŸ† " + practiceChallenge5Wins59;

// Challenge 6
const el61 = document.getElementById("practiceWinsch61");
if (el61) el61.innerText = "ğŸ† " + practiceChallenge6Wins61;

const el62 = document.getElementById("practiceWinsch62");
if (el62) el62.innerText = "ğŸ† " + practiceChallenge6Wins62;

const el63 = document.getElementById("practiceWinsch63");
if (el63) el63.innerText = "ğŸ† " + practiceChallenge6Wins63;

const el64 = document.getElementById("practiceWinsch64");
if (el64) el64.innerText = "ğŸ† " + practiceChallenge6Wins64;

const el65 = document.getElementById("practiceWinsch65");
if (el65) el65.innerText = "ğŸ† " + practiceChallenge6Wins65;

const el66 = document.getElementById("practiceWinsch66");
if (el66) el66.innerText = "ğŸ† " + practiceChallenge6Wins66;

const el67 = document.getElementById("practiceWinsch67");
if (el67) el67.innerText = "ğŸ† " + practiceChallenge6Wins67;

const el68 = document.getElementById("practiceWinsch68");
if (el68) el68.innerText = "ğŸ† " + practiceChallenge6Wins68;

const el69 = document.getElementById("practiceWinsch69");
if (el69) el69.innerText = "ğŸ† " + practiceChallenge6Wins69;

// Challenge 7
const el71 = document.getElementById("practiceWinsch71");
if (el71) el71.innerText = "ğŸ† " + practiceChallenge7Wins71;

const el72 = document.getElementById("practiceWinsch72");
if (el72) el72.innerText = "ğŸ† " + practiceChallenge7Wins72;

const el73 = document.getElementById("practiceWinsch73");
if (el73) el73.innerText = "ğŸ† " + practiceChallenge7Wins73;

const el74 = document.getElementById("practiceWinsch74");
if (el74) el74.innerText = "ğŸ† " + practiceChallenge7Wins74;

const el75 = document.getElementById("practiceWinsch75");
if (el75) el75.innerText = "ğŸ† " + practiceChallenge7Wins75;

const el76 = document.getElementById("practiceWinsch76");
if (el76) el76.innerText = "ğŸ† " + practiceChallenge7Wins76;

const el77 = document.getElementById("practiceWinsch77");
if (el77) el77.innerText = "ğŸ† " + practiceChallenge7Wins77;

const el78 = document.getElementById("practiceWinsch78");
if (el78) el78.innerText = "ğŸ† " + practiceChallenge7Wins78;

const el79 = document.getElementById("practiceWinsch79");
if (el79) el79.innerText = "ğŸ† " + practiceChallenge7Wins79;


for (let i = 11; i <= 19; i++) {
  let wins;
  if (i === 11) wins = practiceChallenge1Wins11;
  else if (i === 12) wins = practiceChallenge1Wins12;
  else if (i === 13) wins = practiceChallenge1Wins13;
  else if (i === 14) wins = practiceChallenge1Wins14;
  else if (i === 15) wins = practiceChallenge1Wins15;
  else if (i === 16) wins = practiceChallenge1Wins16;
  else if (i === 17) wins = practiceChallenge1Wins17;
  else if (i === 18) wins = practiceChallenge1Wins18;
  else if (i === 19) wins = practiceChallenge1Wins19;

  const cell = document.querySelector('[onclick="startPracticeWithPreFilledGridch' + i + '()"]');
  const counter = document.getElementById("practiceWinsch" + i);

  if (counter) {
    counter.innerText = "ğŸ† " + wins;
  }

if (cell) {
  if (wins >= 1) {
    // Bouw op van 0.2 (bij 1 win) naar max 0.5 (bij 10 of meer wins)
    let opacity = 0.2 + Math.min(wins - 1, 9) * 0.08; // max 10 stappen
    cell.style.backgroundColor = `rgba(0, 255, 0, ${opacity.toFixed(3)})`;
  } else {
    cell.style.backgroundColor = "rgba(200, 200, 200, 0.35)";
  }
}

}


for (let i = 21; i <= 29; i++) {
  let wins;
  if (i === 21) wins = practiceChallenge2Wins21;
  else if (i === 22) wins = practiceChallenge2Wins22;
  else if (i === 23) wins = practiceChallenge2Wins23;
  else if (i === 24) wins = practiceChallenge2Wins24;
  else if (i === 25) wins = practiceChallenge2Wins25;
  else if (i === 26) wins = practiceChallenge2Wins26;
  else if (i === 27) wins = practiceChallenge2Wins27;
  else if (i === 28) wins = practiceChallenge2Wins28;
  else if (i === 29) wins = practiceChallenge2Wins29;

  const cell = document.querySelector('[onclick="startPracticeWithPreFilledGridch' + i + '()"]');
  const counter = document.getElementById("practiceWinsch" + i);

  if (counter) {
    counter.innerText = "ğŸ† " + wins;
  }

  if (cell) {
    if (wins >= 1) {
      // Bouw op van 0.2 (bij 1 win) naar max 0.5 (bij 10 of meer wins)
      let opacity = 0.2 + Math.min(wins - 1, 9) * 0.08; // max 10 stappen
      cell.style.backgroundColor = `rgba(0, 255, 0, ${opacity.toFixed(3)})`;
    } else {
      cell.style.backgroundColor = "rgba(200, 200, 200, 0.35)";
    }
  }
}




// Voor challenge 3 (31 t.e.m. 39)
for (let i = 31; i <= 39; i++) {
  let wins = 0;
  if (i === 31) wins = practiceChallenge3Wins31;
  else if (i === 32) wins = practiceChallenge3Wins32;
  else if (i === 33) wins = practiceChallenge3Wins33;
  else if (i === 34) wins = practiceChallenge3Wins34;
  else if (i === 35) wins = practiceChallenge3Wins35;
  else if (i === 36) wins = practiceChallenge3Wins36;
  else if (i === 37) wins = practiceChallenge3Wins37;
  else if (i === 38) wins = practiceChallenge3Wins38;
  else if (i === 39) wins = practiceChallenge3Wins39;

  const cell = document.querySelector('[onclick="startPracticeWithPreFilledGridch' + i + '()"]');
  const counter = document.getElementById("practiceWinsch" + i);

  if (counter) {
    counter.innerText = "ğŸ† " + wins;
  }

  if (cell) {
    if (wins >= 1) {
      let opacity = 0.2 + Math.min(wins - 1, 9) * 0.08; // max 10 stappen tot 0.47
      cell.style.backgroundColor = `rgba(0, 255, 0, ${opacity.toFixed(3)})`;
    } else {
      cell.style.backgroundColor = "rgba(200, 200, 200, 0.35)";
    }
  }
}

// Voor challenge 4 (41 t.e.m. 49)
for (let i = 41; i <= 49; i++) {
  let wins = 0;
  if (i === 41) wins = practiceChallenge4Wins41;
  else if (i === 42) wins = practiceChallenge4Wins42;
  else if (i === 43) wins = practiceChallenge4Wins43;
  else if (i === 44) wins = practiceChallenge4Wins44;
  else if (i === 45) wins = practiceChallenge4Wins45;
  else if (i === 46) wins = practiceChallenge4Wins46;
  else if (i === 47) wins = practiceChallenge4Wins47;
  else if (i === 48) wins = practiceChallenge4Wins48;
  else if (i === 49) wins = practiceChallenge4Wins49;

  const cell = document.querySelector('[onclick="startPracticeWithPreFilledGridch' + i + '()"]');
  const counter = document.getElementById("practiceWinsch" + i);

  if (counter) counter.innerText = "ğŸ† " + wins;
  if (cell) {
    if (wins >= 1) {
      let opacity = 0.2 + Math.min(wins - 1, 9) * 0.08;
      cell.style.backgroundColor = `rgba(0, 255, 0, ${opacity.toFixed(3)})`;
    } else {
      cell.style.backgroundColor = "rgba(200, 200, 200, 0.35)";
    }
  }
}

// Voor challenge 5 (51 t.e.m. 59)
for (let i = 51; i <= 59; i++) {
  let wins = 0;
  if (i === 51) wins = practiceChallenge5Wins51;
  else if (i === 52) wins = practiceChallenge5Wins52;
  else if (i === 53) wins = practiceChallenge5Wins53;
  else if (i === 54) wins = practiceChallenge5Wins54;
  else if (i === 55) wins = practiceChallenge5Wins55;
  else if (i === 56) wins = practiceChallenge5Wins56;
  else if (i === 57) wins = practiceChallenge5Wins57;
  else if (i === 58) wins = practiceChallenge5Wins58;
  else if (i === 59) wins = practiceChallenge5Wins59;

  const cell = document.querySelector('[onclick="startPracticeWithPreFilledGridch' + i + '()"]');
  const counter = document.getElementById("practiceWinsch" + i);

  if (counter) counter.innerText = "ğŸ† " + wins;
  if (cell) {
    if (wins >= 1) {
      let opacity = 0.2 + Math.min(wins - 1, 9) * 0.08;
      cell.style.backgroundColor = `rgba(0, 255, 0, ${opacity.toFixed(3)})`;
    } else {
      cell.style.backgroundColor = "rgba(200, 200, 200, 0.35)";
    }
  }
}

// Voor challenge 6 (61 t.e.m. 69)
for (let i = 61; i <= 69; i++) {
  let wins = 0;
  if (i === 61) wins = practiceChallenge6Wins61;
  else if (i === 62) wins = practiceChallenge6Wins62;
  else if (i === 63) wins = practiceChallenge6Wins63;
  else if (i === 64) wins = practiceChallenge6Wins64;
  else if (i === 65) wins = practiceChallenge6Wins65;
  else if (i === 66) wins = practiceChallenge6Wins66;
  else if (i === 67) wins = practiceChallenge6Wins67;
  else if (i === 68) wins = practiceChallenge6Wins68;
  else if (i === 69) wins = practiceChallenge6Wins69;

  const cell = document.querySelector('[onclick="startPracticeWithPreFilledGridch' + i + '()"]');
  const counter = document.getElementById("practiceWinsch" + i);

  if (counter) counter.innerText = "ğŸ† " + wins;
  if (cell) {
    if (wins >= 1) {
      let opacity = 0.2 + Math.min(wins - 1, 9) * 0.08;
      cell.style.backgroundColor = `rgba(0, 255, 0, ${opacity.toFixed(3)})`;
    } else {
      cell.style.backgroundColor = "rgba(200, 200, 200, 0.35)";
    }
  }
}

// Voor challenge 7 (71 t.e.m. 79)
for (let i = 71; i <= 79; i++) {
  let wins = 0;
  if (i === 71) wins = practiceChallenge7Wins71;
  else if (i === 72) wins = practiceChallenge7Wins72;
  else if (i === 73) wins = practiceChallenge7Wins73;
  else if (i === 74) wins = practiceChallenge7Wins74;
  else if (i === 75) wins = practiceChallenge7Wins75;
  else if (i === 76) wins = practiceChallenge7Wins76;
  else if (i === 77) wins = practiceChallenge7Wins77;
  else if (i === 78) wins = practiceChallenge7Wins78;
  else if (i === 79) wins = practiceChallenge7Wins79;

  const cell = document.querySelector('[onclick="startPracticeWithPreFilledGridch' + i + '()"]');
  const counter = document.getElementById("practiceWinsch" + i);

  if (counter) counter.innerText = "ğŸ† " + wins;
  if (cell) {
    if (wins >= 1) {
      let opacity = 0.2 + Math.min(wins - 1, 9) * 0.08;
      cell.style.backgroundColor = `rgba(0, 255, 0, ${opacity.toFixed(3)})`;
    } else {
      cell.style.backgroundColor = "rgba(200, 200, 200, 0.35)";
    }
  }
}


}



function startoefenen() {
  document.getElementById("practiceOverlay").style.display = "block";
}

function startPracticeWithPreFilledGridch11() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech11 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(10);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 400, score: 2000 });
  restartChallenge1();
}

function startPracticeWithPreFilledGridch12() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech12 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(15);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 375, score: 1900 });
  restartChallenge1();
}

function startPracticeWithPreFilledGridch13() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech13 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(20);
  drawGrid();
  startAtLevel10chal({ lives: 4, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 350, score: 1800 });
  restartChallenge1();
}

function startPracticeWithPreFilledGridch14() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech14 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(25);
  drawGrid();
  startAtLevel10chal({ lives: 4, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 325, score: 1700 });
  restartChallenge1();
}

function startPracticeWithPreFilledGridch15() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech15 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(30);
  drawGrid();
  startAtLevel10chal({ lives: 3, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 300, score: 1500 });
  restartChallenge1();
}

function startPracticeWithPreFilledGridch16() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech16 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(35);
  drawGrid();
  startAtLevel10chal({ lives: 3, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 275, score: 1300 });
  restartChallenge1();
}

function startPracticeWithPreFilledGridch17() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech17 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(40);
  drawGrid();
  startAtLevel10chal({ lives: 3, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 250, score: 1200 });
  restartChallenge1();
}

function startPracticeWithPreFilledGridch18() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech18 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(45);
  drawGrid();
  startAtLevel10chal({ lives: 2, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 225, score: 1100 });
  restartChallenge1();
}

function startPracticeWithPreFilledGridch19() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech19 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(50);
  drawGrid();
  startAtLevel10chal({ lives: 2, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 200, score: 1000 });
  restartChallenge1();
}

function startPracticeWithPreFilledGridch21() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech21 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(10);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 400, score: 2000 });
  restartChallenge2();
}

function startPracticeWithPreFilledGridch22() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech22 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(15);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 375, score: 1900 });
  restartChallenge2();
}

function startPracticeWithPreFilledGridch23() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech23 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(20);
  drawGrid();
  startAtLevel10chal({ lives: 4, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 350, score: 1800 });
  restartChallenge2();
}

function startPracticeWithPreFilledGridch24() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech24 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(25);
  drawGrid();
  startAtLevel10chal({ lives: 4, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 325, score: 1700 });
  restartChallenge2();
}

function startPracticeWithPreFilledGridch25() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech25 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(30);
  drawGrid();
  startAtLevel10chal({ lives: 3, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 300, score: 1500 });
  restartChallenge2();
}

function startPracticeWithPreFilledGridch26() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech26 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(35);
  drawGrid();
  startAtLevel10chal({ lives: 3, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 275, score: 1300 });
  restartChallenge2();
}

function startPracticeWithPreFilledGridch27() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech27 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(40);
  drawGrid();
  startAtLevel10chal({ lives: 3, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 250, score: 1200 });
  restartChallenge2();
}

function startPracticeWithPreFilledGridch28() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech28 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(45);
  drawGrid();
  startAtLevel10chal({ lives: 2, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 225, score: 1100 });
  restartChallenge2();
}

function startPracticeWithPreFilledGridch29() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech29 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(50);
  drawGrid();
  startAtLevel10chal({ lives: 2, renewTokenCount: 0, multicolorCount: 0, freePictureCount: 0, fallSpeed: 200, score: 1000 });
  restartChallenge2();
}



function startPracticeWithPreFilledGridch31() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech31 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(10);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 20, multicolorCount: 10, freePictureCount: 5, fallSpeed: 400, score: 2000 });
  restartChallenge3();
}

function startPracticeWithPreFilledGridch32() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech32 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(15);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 18, multicolorCount: 9, freePictureCount: 4, fallSpeed: 375, score: 1900 });
  restartChallenge3();
}

function startPracticeWithPreFilledGridch33() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech33 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(20);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 16, multicolorCount: 8, freePictureCount: 4, fallSpeed: 350, score: 1800 });
  restartChallenge3();
}

function startPracticeWithPreFilledGridch34() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech34 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(25);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 14, multicolorCount: 7, freePictureCount: 3, fallSpeed: 325, score: 1700 });
  restartChallenge3();
}

function startPracticeWithPreFilledGridch35() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech35 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(30);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 12, multicolorCount: 6, freePictureCount: 3, fallSpeed: 300, score: 1500 });
  restartChallenge3();
}

function startPracticeWithPreFilledGridch36() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech36 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(35);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 10, multicolorCount: 5, freePictureCount: 2, fallSpeed: 275, score: 1300 });
  restartChallenge3();
}

function startPracticeWithPreFilledGridch37() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech37 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(40);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 8, multicolorCount: 4, freePictureCount: 2, fallSpeed: 250, score: 1200 });
  restartChallenge3();
}

function startPracticeWithPreFilledGridch38() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech38 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(45);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 6, multicolorCount: 3, freePictureCount: 1, fallSpeed: 225, score: 1100 });
  restartChallenge3();
}

function startPracticeWithPreFilledGridch39() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech39 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(50);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 4, multicolorCount: 2, freePictureCount: 1, fallSpeed: 200, score: 1000 });
  restartChallenge3();
}

function startPracticeWithPreFilledGridch41() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech41 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(10);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 20, multicolorCount: 10, freePictureCount: 5, fallSpeed: 400, score: 2000 });
  restartChallenge4();
}

function startPracticeWithPreFilledGridch42() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech42 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(15);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 18, multicolorCount: 9, freePictureCount: 4, fallSpeed: 375, score: 1900 });
  restartChallenge4();
}

function startPracticeWithPreFilledGridch43() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech43 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(20);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 16, multicolorCount: 8, freePictureCount: 4, fallSpeed: 350, score: 1800 });
  restartChallenge4();
}

function startPracticeWithPreFilledGridch44() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech44 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(25);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 14, multicolorCount: 7, freePictureCount: 3, fallSpeed: 325, score: 1700 });
  restartChallenge4();
}

function startPracticeWithPreFilledGridch45() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech45 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(30);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 12, multicolorCount: 6, freePictureCount: 3, fallSpeed: 300, score: 1500 });
  restartChallenge4();
}

function startPracticeWithPreFilledGridch46() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech46 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(35);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 10, multicolorCount: 5, freePictureCount: 2, fallSpeed: 275, score: 1300 });
  restartChallenge4();
}

function startPracticeWithPreFilledGridch47() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech47 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(40);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 8, multicolorCount: 4, freePictureCount: 2, fallSpeed: 250, score: 1200 });
  restartChallenge4();
}

function startPracticeWithPreFilledGridch48() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech48 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(45);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 6, multicolorCount: 3, freePictureCount: 1, fallSpeed: 225, score: 1100 });
  restartChallenge4();
}

function startPracticeWithPreFilledGridch49() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech49 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(50);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 4, multicolorCount: 2, freePictureCount: 1, fallSpeed: 200, score: 1000 });
  restartChallenge4();
}

function startPracticeWithPreFilledGridch51() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech51 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(10);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 20, multicolorCount: 10, freePictureCount: 5, fallSpeed: 400, score: 2000 });
  restartChallenge5();
}

function startPracticeWithPreFilledGridch52() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech52 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(15);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 18, multicolorCount: 9, freePictureCount: 4, fallSpeed: 375, score: 1900 });
  restartChallenge5();
}

function startPracticeWithPreFilledGridch53() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech53 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(20);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 16, multicolorCount: 8, freePictureCount: 4, fallSpeed: 350, score: 1800 });
  restartChallenge5();
}

function startPracticeWithPreFilledGridch54() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech54 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(25);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 14, multicolorCount: 7, freePictureCount: 3, fallSpeed: 325, score: 1700 });
  restartChallenge5();
}

function startPracticeWithPreFilledGridch55() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech55 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(30);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 12, multicolorCount: 6, freePictureCount: 3, fallSpeed: 300, score: 1500 });
  restartChallenge5();
}

function startPracticeWithPreFilledGridch56() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech56 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(35);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 10, multicolorCount: 5, freePictureCount: 2, fallSpeed: 275, score: 1300 });
  restartChallenge5();
}

function startPracticeWithPreFilledGridch57() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech57 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(40);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 8, multicolorCount: 4, freePictureCount: 2, fallSpeed: 250, score: 1200 });
  restartChallenge5();
}

function startPracticeWithPreFilledGridch58() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech58 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(45);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 6, multicolorCount: 3, freePictureCount: 1, fallSpeed: 225, score: 1100 });
  restartChallenge5();
}

function startPracticeWithPreFilledGridch59() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech59 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(50);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 4, multicolorCount: 2, freePictureCount: 1, fallSpeed: 200, score: 1000 });
  restartChallenge5();
}

function startPracticeWithPreFilledGridch61() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech61 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(10);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 20, multicolorCount: 10, freePictureCount: 5, fallSpeed: 400, score: 2000 });
  restartChallenge6();
}

function startPracticeWithPreFilledGridch62() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech62 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(15);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 18, multicolorCount: 9, freePictureCount: 4, fallSpeed: 375, score: 1900 });
  restartChallenge6();
}

function startPracticeWithPreFilledGridch63() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech63 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(20);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 16, multicolorCount: 8, freePictureCount: 4, fallSpeed: 350, score: 1800 });
  restartChallenge6();
}

function startPracticeWithPreFilledGridch64() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech64 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(25);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 14, multicolorCount: 7, freePictureCount: 3, fallSpeed: 325, score: 1700 });
  restartChallenge6();
}

function startPracticeWithPreFilledGridch65() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech65 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(30);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 12, multicolorCount: 6, freePictureCount: 3, fallSpeed: 300, score: 1500 });
  restartChallenge6();
}

function startPracticeWithPreFilledGridch66() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech66 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(35);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 10, multicolorCount: 5, freePictureCount: 2, fallSpeed: 275, score: 1300 });
  restartChallenge6();
}

function startPracticeWithPreFilledGridch67() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech67 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(40);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 8, multicolorCount: 4, freePictureCount: 2, fallSpeed: 250, score: 1200 });
  restartChallenge6();
}

function startPracticeWithPreFilledGridch68() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech68 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(45);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 6, multicolorCount: 3, freePictureCount: 1, fallSpeed: 225, score: 1100 });
  restartChallenge6();
}

function startPracticeWithPreFilledGridch69() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech69 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(50);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 4, multicolorCount: 2, freePictureCount: 1, fallSpeed: 200, score: 1000 });
  restartChallenge6();
}

function startPracticeWithPreFilledGridch71() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech71 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(10);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 20, multicolorCount: 10, freePictureCount: 5, fallSpeed: 400, score: 2000 });
  restartChallenge7();
}

function startPracticeWithPreFilledGridch72() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech72 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(15);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 18, multicolorCount: 9, freePictureCount: 4, fallSpeed: 375, score: 1900 });
  restartChallenge7();
}

function startPracticeWithPreFilledGridch73() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech73 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(20);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 16, multicolorCount: 8, freePictureCount: 4, fallSpeed: 350, score: 1800 });
  restartChallenge7();
}

function startPracticeWithPreFilledGridch74() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech74 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(25);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 14, multicolorCount: 7, freePictureCount: 3, fallSpeed: 325, score: 1700 });
  restartChallenge7();
}

function startPracticeWithPreFilledGridch75() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech75 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(30);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 12, multicolorCount: 6, freePictureCount: 3, fallSpeed: 300, score: 1500 });
  restartChallenge7();
}

function startPracticeWithPreFilledGridch76() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech76 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(35);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 10, multicolorCount: 5, freePictureCount: 2, fallSpeed: 275, score: 1300 });
  restartChallenge7();
}

function startPracticeWithPreFilledGridch77() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech77 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(40);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 8, multicolorCount: 4, freePictureCount: 2, fallSpeed: 250, score: 1200 });
  restartChallenge7();
}

function startPracticeWithPreFilledGridch78() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech78 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(45);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 6, multicolorCount: 3, freePictureCount: 1, fallSpeed: 225, score: 1100 });
  restartChallenge7();
}

function startPracticeWithPreFilledGridch79() {
  closePracticeOverlay();
  document.getElementById('startOverlay').style.display = 'none';
  practiceModech79 = true;
  gridOffsetX = 0;
  gridOffsetY = 0;
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));
  drawGrid();
  fillGridWithRandomBlocks(50);
  drawGrid();
  startAtLevel10chal({ lives: 5, renewTokenCount: 4, multicolorCount: 2, freePictureCount: 1, fallSpeed: 200, score: 1000 });
  restartChallenge7();
}



function fillGridWithRandomBlocks(count) {
  let placed = 0;
  const maxTries = 1000; // prevent infinite loop
  let tries = 0;

  while (placed < count && tries < maxTries) {
    const x = Math.floor(Math.random() * gridCols);
    const y = Math.floor(Math.random() * gridRows);

    if (!field[x][y]) {
      const color = colors[Math.floor(Math.random() * colors.length)]; // zelfde als bij normale blokjes
      field[x][y] = {
        color: color,
        x: x,
        y: y,
      };
      drawGrid();
      placed++;
    }

    tries++;
  }
}


function startAtLevel10chal(settings = {}) {
  // Instelbare parameters
  lives = settings.lives ?? 5;
  renewTokenCount = settings.renewTokenCount ?? 5;
  multicolorCount = settings.multicolorCount ?? 5;
  freePictureCount = settings.freePictureCount ?? 5;
  level = settings.level ?? 100;
  fallSpeed = settings.fallSpeed ?? 400;
  score = settings.score ?? 0;

  // Overige vaste resets
  skipUsesLeft = 5;
  saveBlockCountdown = 1;
  saveUnlocked = false;
  pauseUsesLeft = 1000;
  blockSpawnCount = 0;
  blockSpawnCountfree = 0;
  bigGroupCount = 0;
  forcedNextBlock = null;
  isPaused = false;
  gamePaused = false;
  gridOffsetX = 0;
  gridOffsetY = 0;

  // document.getElementById('startOverlay').style.display = 'none';
  document.getElementById('startOverlay').style.display = 'none';

  // Visuele updates
  updateScoreDisplay();
  updateLivesDisplay();
  updateMulticolorDisplay();
  updatePauseDisplay();
  updateRenewDisplay();
  updateLevelDisplay();
  updateFreePictureDisplay();

  // Algemene reset
  challengeActive = false;
  challengeLocked = false;

  // Challenge 1
  challenge1Done = false;
  challengeHeartCount = 0;
  challengeHeartOverrideCounter = 0;
  preventHeartReward = false;
  challengeBlockCounter = 0;
  challengeRewardGiven = false;

  // Challenge 2
  challenge2Active = false;
  challenge2Done = false;
  challenge2MultiCount = 0;
  challenge2BlockCounter = 0;
  challenge2RewardGiven = false;
  challenge2SuccessImageShown = false;
  challenge2PendingMulticolors = 0;

  // Challenge 3
  challenge3Active = false;
  challenge3Started = false;
  challenge3Done = false;
  challenge3Failed = false;
  challenge3Success = false;
  challenge3Count = 0;

  // Challenge 4
  challenge4Active = false;
  challenge4Done = false;
  challenge4Count = 0;
  challenge4FullFieldMoments = 0;
  challenge4Success = false;
  challenge4RewardGiven = false;

  // Challenge 5
  challenge5Active = false;
  challenge5Done = false;
  challenge5Success = false;
  challenge5BlockCounter = 0;
  challenge5StartImageShown = false;
  challenge5SuccessImageShown = false;
  challenge5Started = false;

  // Challenge 6
  challenge6Active = false;
  challenge6Done = false;
  challenge6Success = false;
  challenge6BlockCounter = 0;
  challenge6SixGroupCount = 0;
  challenge6RewardGiven = false;

  // Challenge 7
  challenge7Active = false;
  challenge7Done = false;
  challenge7Success = false;
  challenge7BlockCount = 0;
  challenge7GroupCount = 0;
  challenge7RewardGiven = false;

  updateChallengeStatusCell();
  updateChallenge2StatusCell();
  updateChallenge3StatusCell();
  updateChallenge4StatusCell();
  updateChallenge5StatusCell();
  updateChallenge6StatusCell();
  updateChallenge7StatusCell();
  updateLevelDisplay();
  updateLevelAndBpmDisplay();

  // Start blokje
  nextBlock = generateNextBlock();
  updateNextBlockDisplay(nextBlock.color, nextBlock.length, nextBlock.isDiva);
  fallingBlock = createBlock("down");

  drawGrid();
  drawFallingBlock();

  clearInterval(fallInterval);
  fallInterval = setInterval(gameLoop, fallSpeed);
}

function pauseGameAndShowMessage(message) {
  clearInterval(fallInterval);
  gamePaused = true;

  const overlay = document.createElement("div");
  overlay.style.position = "fixed";
  overlay.style.top = "50%";
  overlay.style.left = "50%";
  overlay.style.transform = "translate(-50%, -50%)";
  overlay.style.width = "90vw";
  overlay.style.maxWidth = "360px"; // betere breedte voor gsm
  overlay.style.padding = "24px";
  overlay.style.background = "rgba(0, 0, 0, 0.95)";
  overlay.style.color = "#FFE680";
  overlay.style.display = "flex";
  overlay.style.flexDirection = "column";
  overlay.style.alignItems = "center";
  overlay.style.justifyContent = "center";
  overlay.style.fontFamily = "'Baloo Bhaina 2', sans-serif";
  overlay.style.fontSize = "1rem";
  overlay.style.lineHeight = "1.3"; // compacter
  overlay.style.borderRadius = "16px";
  overlay.style.boxShadow = "0 0 20px rgba(0,0,0,0.7)";
  overlay.style.zIndex = "99999";
  overlay.style.textAlign = "center";
  overlay.innerText = message;

  const btn = document.createElement("button");
  btn.innerText = "Return to menu";
  btn.style.marginTop = "20px";
  btn.style.padding = "10px 20px";
  btn.style.fontSize = "1rem";
  btn.style.background = "#e88a2d";
  btn.style.color = "black";
  btn.style.border = "none";
  btn.style.borderRadius = "10px";
  btn.style.cursor = "pointer";
  btn.onclick = () => {
    document.body.removeChild(overlay);
    returnToMenu();
  };

  overlay.appendChild(btn);
  document.body.appendChild(overlay);
}



function closePracticeOverlay() {
  document.getElementById("practiceOverlay").style.display = "none";
}

function updateLevelAndBpmDisplay() {
  //  console.log("fallSpeedBeforeChallenge7 =", fallSpeedBeforeChallenge7); 
  const bpm = Math.round(60000 / fallSpeedBeforeChallenge7);
  const levelSpan = document.getElementById("levelDisplayExtra");
  const bpmSpan = document.getElementById("bpmDisplay");
  if (levelSpan) levelSpan.textContent = level;
  if (bpmSpan) bpmSpan.textContent = `${bpm}`;
}



function updateChallengeInfoText() {
  const textElement = document.getElementById("challengeInfoText");
  const cellElement = document.getElementById("levelDisplay");
  if (!textElement || !cellElement) return;

 //  reset eerst altijd
  textElement.innerHTML = "PARTY MISSION";
  cellElement.classList.remove("challenge-active");

  const textColor = "#f4c644";

  if (challengeActive) {
    cellElement.classList.add("challenge-active");
    textElement.innerHTML = `
      <div style="font-size: 0.75rem; line-height: 1.1; text-align: center;">
        <div><span style="font-size: 0.7em;">â¤ï¸</span> <span id="challengeHeartCount">${challengeHeartCount}</span> / ${challengeHeartTarget}</div>
        <div><span style="font-size: 0.7em;">â³</span> <span id="challengeBlockCounter">${challengeBlockCounter}</span> / ${challengeBlockLimit}</div>
      </div>
    `;
  } else if (challenge2Active) {
    cellElement.classList.add("challenge-active");
    const multiText = challenge2MultiCount < 10 ? "0" + challenge2MultiCount : challenge2MultiCount;
    textElement.innerHTML = `
      <div style="font-size: 0.75rem; line-height: 1.1; text-align: center; color: ${textColor};">
        <div>ğŸŒˆ <span id="challenge2MultiCount">${multiText}</span> / ${challenge2MultiTarget}</div>
        <div>â³ <span id="challenge2BlockCounter">${challenge2BlockCounter}</span> / ${challenge2BlockLimit}</div>
      </div>
    `;
  } else if (challenge3Active) {
    cellElement.classList.add("challenge-active");
    textElement.innerHTML = `
      <div style="font-size: 0.85rem; line-height: 1.1; text-align: center; color: ${textColor};">
        <div>ğŸ§â€â™‚ï¸ <span id="challenge3Count">${challenge3Count}</span> / ${challenge3Limit}</div>
      </div>
    `;
  } else if (challenge4Active) {
    const blocksOnField = field.flat().filter(cell => cell !== null).length;
    cellElement.classList.add("challenge-active");
    textElement.innerHTML = `
      <div style="font-size: 0.50rem; line-height: 1.1; text-align: center; color: ${textColor};">
        <div>â³ <span id="challenge4Count">${challenge4Count}</span>/ ${challenge4Limit}</div>
        <div>ğŸ“ˆ <span id="challenge4FullFieldMoments">${challenge4FullFieldMoments}</span></div>  
        <div>ğŸ§± <span id="blocksOnField">${blocksOnField}</span></div>   
      </div>
    `;
  } else if (challenge5Active) {
    cellElement.classList.add("challenge-active");
    textElement.innerHTML = `
      <div style="font-size: 0.85rem; line-height: 1.1; text-align: center; color: ${textColor};">
        <div>ğŸ§â€â™‚ï¸ <span id="challenge5Count">${challenge5BlockCounter}</span> / ${challenge5RequiredBlocks}</div>
      </div>
    `;
  } else if (challenge6Active) {
    cellElement.classList.add("challenge-active");
    textElement.innerHTML = `
      <div style="font-size: 0.75rem; line-height: 1.1; text-align: center; color: ${textColor};">
        <div>ğŸ¯ <span id="challenge6SixGroupCount">${challenge6SixGroupCount}</span> / 10</div>
        <div>â³ <span id="challenge6BlockCounter">${challenge6BlockCounter}</span> / 100</div>
      </div>
    `;
  } else if (challenge7Active) {
    cellElement.classList.add("challenge-active");
    textElement.innerHTML = `
      <div style="font-size: 0.75rem; line-height: 1.1; text-align: center; color: ${textColor};">
        <div>ğŸ¯ <span id="challenge7GroupCount">${challenge7GroupCount}</span> / ${challenge7TargetGroups}</div>
        <div>â³ <span id="challenge7BlockCount">${challenge7BlockCount}</span> / ${challenge7BlockLimit}</div>
        <div style="font-size: 0.8rem;">âš¡ ${Math.round(60000 / fallSpeed)} BPM</div>
      </div>
    `;
  }
}








function updateLevelProgressBar() {
  const progress = Math.min((bigGroupCount / levelProgressThreshold) * 100, 100);
  const bar = document.getElementById("levelProgressBar");
  if (bar) {
    if (progress === 100) {
      bar.style.width = "0%";
    } else {
      bar.style.width = progress + "%";
    }
  }
}

function updateHighStats() {
  const previousHighScore = parseInt(localStorage.getItem("allTimeHighScore") || "0");
  const previousHighRound = parseInt(localStorage.getItem("allTimeHighRound") || "0");

  if (score > previousHighScore) {
    localStorage.setItem("allTimeHighScore", score);
  }
  if (round > previousHighRound) {
    localStorage.setItem("allTimeHighRound", round);
  }
  updateAllTimeDisplay(); 
}

//function updateAllTimeDisplay() {
//  const highScore = localStorage.getItem("allTimeHighScore") || "0";
//  const highRound = localStorage.getItem("allTimeHighRound") || "0";
//  const display = document.getElementById("allTimeDisplay");
//  if (display) {
//    display.textContent = `â˜… ${highScore} | âŸ³ ${highRound}`;
//  }
//}

//function updateAllTimeDisplay() {
//  const highScore = localStorage.getItem("allTimeHighScore") || "0";
//  const highRound = localStorage.getItem("allTimeHighRound") || "0";
//
//  const display = document.getElementById("allTimeDisplay");
//  if (display) {
//    display.innerHTML = `Longest Party:  ${highScore}<br>Max Beat Rate:  ${highRound}`;
//  }
//
//  const display1 = document.getElementById("allTimeDisplay1");
//  if (display1) {
//    display1.innerHTML = `Longest Party: ${highScore}<br>Max Beat Rate:  ${highRound}`;
//  }
//}


function updateAllTimeDisplay() {
  const highScore = localStorage.getItem("allTimeHighScore") || "0";
  const bpm = Math.round(60000 / fallSpeedBeforeChallenge7);

  const display = document.getElementById("allTimeDisplay");
  if (display) {
    display.innerHTML = `Longest Party: ${highScore}<br>Max Beat Rate: ${bpm} BPM`;
  }

  const display1 = document.getElementById("allTimeDisplay1");
  if (display1) {
    display1.innerHTML = `Longest Party: ${highScore}<br>Max Beat Rate: ${bpm} BPM`;
  }
}


//const bpm = Math.round(60000 / fallSpeedBeforeChallenge7);
//el.innerHTML = `Beat Rate: <span style="font-weight: bold; font-size: 2.3rem;">${bpm}</span> BeatsPerMinute`;

// wat de dropbutton doet, maar zouden we ook in een functie kunnen zetten

function dropButton() {
  if (useVertical) {
    if (fallingBlock.direction === "down") {
      while (!blockWouldCollide(fallingBlock) && fallingBlock.y < gridRows) {
        fallingBlock.y++;
      }
      fallingBlock.y--;
    } else if (fallingBlock.direction === "up") {
      while (!blockWouldCollide(fallingBlock) && fallingBlock.y > 0) {
        fallingBlock.y--;
      }
      fallingBlock.y++;
    }
    update();
    drawGrid();
    drawFallingBlock();
  } else {
    if (fallingBlock.direction === "right") {
      while (!blockWouldCollideH(fallingBlock) && fallingBlock.x < gridCols) {
        fallingBlock.x++;
      }
      fallingBlock.x--;
    } else if (fallingBlock.direction === "left") {
      while (!blockWouldCollideH(fallingBlock) && fallingBlock.x > 0) {
        fallingBlock.x--;
      }
      fallingBlock.x++;
    }
    updateH();
    drawGrid();
    drawFallingBlock();
  }
}


// aanpassen
function checkFreePicMilestone() {
  if (level >= 10 && blockSpawnCountfree > 0 && blockSpawnCountfree % 50 === 0) {
    freePictureCount++;
    updateFreePictureDisplay();
    showCelebrationOverlay("images/fig43.png"); // <-- vervang door je eigen afbeelding
  }
}


//function updateFallSpeedDisplay() {
//  const el = document.getElementById("fallSpeedDisplay");
//  if (el) el.textContent = `Round: ${round}  |  Start Speed: ${fallSpeedBeforeChallenge7}ms`;
//}

function updateFallSpeedDisplay() {
  const el = document.getElementById("fallSpeedDisplay");
  if (el) {
    const highScore = localStorage.getItem("allTimeHighScore") || 0;
    const highRound = localStorage.getItem("allTimeHighRound") || 1;
//    el.textContent = `Round: ${round}  |  Start Speed: ${fallSpeedBeforeChallenge7}ms  |  High Score: ${highScore}  |  Highest Round: ${highRound}`;
//el.textContent = `Round: ${round}  |  Start Speed: ${fallSpeedBeforeChallenge7}ms`;  
   const bpm = Math.round(60000 / fallSpeedBeforeChallenge7);
el.innerHTML = `Beat Rate: <span style="font-weight: bold; font-size: 2.3rem;">${bpm}</span> BeatsPerMinute`;
}
}


// wat je doet bij einde van chal 6 - bij andere chal is dit anders
function endChallenge6(success) {
  challenge6Active = false;
  challenge6Done = true;
  challenge6Success = success;
  if (success) {
    if (!challenge6RewardGiven) {
      //score += 250;
      freePictureCount += 3;
      updateFreePictureDisplay();
      updateScoreDisplay();
     
      challenge6RewardGiven = true;

// EXTRA: SUCCES IN PRACTICE-MODUS â€“ CHALLENGE 6
if (practiceModech61) {
  practiceChallenge6Wins61++;
  localStorage.setItem("practiceChallenge6Wins61", practiceChallenge6Wins61);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech62) {
  practiceChallenge6Wins62++;
  localStorage.setItem("practiceChallenge6Wins62", practiceChallenge6Wins62);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech63) {
  practiceChallenge6Wins63++;
  localStorage.setItem("practiceChallenge6Wins63", practiceChallenge6Wins63);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech64) {
  practiceChallenge6Wins64++;
  localStorage.setItem("practiceChallenge6Wins64", practiceChallenge6Wins64);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech65) {
  practiceChallenge6Wins65++;
  localStorage.setItem("practiceChallenge6Wins65", practiceChallenge6Wins65);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech66) {
  practiceChallenge6Wins66++;
  localStorage.setItem("practiceChallenge6Wins66", practiceChallenge6Wins66);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech67) {
  practiceChallenge6Wins67++;
  localStorage.setItem("practiceChallenge6Wins67", practiceChallenge6Wins67);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech68) {
  practiceChallenge6Wins68++;
  localStorage.setItem("practiceChallenge6Wins68", practiceChallenge6Wins68);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech69) {
  practiceChallenge6Wins69++;
  localStorage.setItem("practiceChallenge6Wins69", practiceChallenge6Wins69);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}

 showCelebrationOverlay("images/fig44.png"); // Optioneel

    }
  } else {
    
    challenge6RewardGiven = true;

if (
  practiceModech61 || practiceModech62 || practiceModech63 || practiceModech64 ||
  practiceModech65 || practiceModech66 || practiceModech67 || practiceModech68 ||
  practiceModech69
) {
  pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
  return;
}


showCelebrationOverlay("images/fig45.png") ; // Optioneel

  }
  updateChallenge6StatusCell();
}




function endChallenge7(success) {
  challenge7Active = false;
  challenge7Done = true;
  challenge7Success = success;

  // Altijd terug naar bewaarde snelheid
  fallSpeed = fallSpeedBeforeChallenge7;
  clearInterval(fallInterval);
  fallInterval = setInterval(gameLoop, fallSpeed);

  if (success) {
    if (!challenge7RewardGiven) {
      //score += 250;
      freePictureCount += 3;
      updateFreePictureDisplay();
      updateScoreDisplay();
      challenge7RewardGiven = true;

// EXTRA: SUCCES IN PRACTICE-MODUS â€“ CHALLENGE 7
if (practiceModech71) {
  practiceChallenge7Wins71++;
  localStorage.setItem("practiceChallenge7Wins71", practiceChallenge7Wins71);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech72) {
  practiceChallenge7Wins72++;
  localStorage.setItem("practiceChallenge7Wins72", practiceChallenge7Wins72);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech73) {
  practiceChallenge7Wins73++;
  localStorage.setItem("practiceChallenge7Wins73", practiceChallenge7Wins73);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech74) {
  practiceChallenge7Wins74++;
  localStorage.setItem("practiceChallenge7Wins74", practiceChallenge7Wins74);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech75) {
  practiceChallenge7Wins75++;
  localStorage.setItem("practiceChallenge7Wins75", practiceChallenge7Wins75);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech76) {
  practiceChallenge7Wins76++;
  localStorage.setItem("practiceChallenge7Wins76", practiceChallenge7Wins76);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech77) {
  practiceChallenge7Wins77++;
  localStorage.setItem("practiceChallenge7Wins77", practiceChallenge7Wins77);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech78) {
  practiceChallenge7Wins78++;
  localStorage.setItem("practiceChallenge7Wins78", practiceChallenge7Wins78);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech79) {
  practiceChallenge7Wins79++;
  localStorage.setItem("practiceChallenge7Wins79", practiceChallenge7Wins79);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}



      showCelebrationOverlay("images/fig44.png");
    }
  } else {
    challenge7RewardGiven = true;

if (
  practiceModech71 || practiceModech72 || practiceModech73 || practiceModech74 ||
  practiceModech75 || practiceModech76 || practiceModech77 || practiceModech78 ||
  practiceModech79
) {
  pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
  return;
}



    showCelebrationOverlay("images/fig45.png");
  }

  updateChallenge7StatusCell();
}


// wordt gebruikt als je voor continue hebt gekozen (onduidelijk of nodig)

function startGame() {
  document.getElementById('startOverlay').style.display = 'none';
  gamePaused = false;
  multicolorCount = 5;
  updateMulticolorDisplay();
  pauseUsesLeft = 1000;
  updatePauseDisplay();
  document.getElementById("saveBlockCounter").textContent = saveBlockCountdown;
}

function returnToMenu() {
  document.getElementById("startOverlay").style.display = "flex";
  gamePaused = true;
}

function updateFreePictureDisplay() {
  const el = document.getElementById("freePictureCount");
  if (el) el.textContent = freePictureCount;
}

//function useFreePicture() {
//  if (freePictureCount <= 0 || fallingBlock !== null) return;
//
//  fallingBlock = {
//    x: Math.floor(gridCols / 2),
//    y: -1,
//    color: "white",
//    length: 1,
//    isFreePicture: true
//  };
//
//  freePictureCount--;
//  updateFreePictureDisplay();
//}


function openPauseModal() {
  document.getElementById("pauseModal").style.display = "block";
}

function closePauseModal() {
  document.getElementById("pauseModal").style.display = "none";
  // Simuleer klik op de pauzecel, dus start game opnieuw
  if (isPaused) {
    resumeGame();
    isPaused = false;
    updatePauseDisplay();
  }
}

function updateRenewProgress(percentage) {
  const bar = document.getElementById("renewProgressBar");
  const counter = document.getElementById("renewCounter");

  if (bar) {
    bar.style.width = `${percentage}%`;
  }

  if (counter) {
    counter.textContent = Math.floor(percentage);
  }
}


// optie gekozen in startmenu

//function startAtLevel10() {
//  localStorage.removeItem("testScore");
//  score = 100;
//  updateScoreDisplay();
//  level = 10;
//  multicolorCount = 5;
//  updateMulticolorDisplay();
//  document.getElementById('startOverlay').style.display = 'none';
//  gamePaused = false;
//  pauseUsesLeft = 1000;
//  updatePauseDisplay();
//  updateScoreDisplay();
//}


function startAtLevel10() {
  // Reset alle belangrijke spelwaarden
  level = 10;
  score = 0;
  lives = 5;
  renewTokenCount = 5;
  multicolorCount = 5;
  skipUsesLeft = 0;
  saveBlockCountdown = 1;
  saveUnlocked = false;
  pauseUsesLeft = 1000;
  blockSpawnCount = 0;
  blockSpawnCountfree = 0;
  bigGroupCount = 0;
  forcedNextBlock = null;
  isPaused = false;
  gamePaused = false;
  freePictureCount = 5;

  gridOffsetX = 0;
  gridOffsetY = 0;

  // Reset veld
  field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));

  // Overlay weg
  document.getElementById('startOverlay').style.display = 'none';

  // Visuele updates
  updateScoreDisplay();
  updateLivesDisplay();
  updateMulticolorDisplay();
  updatePauseDisplay();
  updateRenewDisplay();
  updateLevelDisplay();
  updateFreePictureDisplay();



// Algemene reset
challengeActive = false;
challengeLocked = false;

// Challenge 1
challenge1Done = false;
challengeHeartCount = 0;
challengeHeartOverrideCounter = 0;
preventHeartReward = false;
challengeBlockCounter = 0;
challengeRewardGiven = false;

// Challenge 2
challenge2Active = false;
challenge2Done = false;
challenge2MultiCount = 0;
challenge2BlockCounter = 0;
challenge2RewardGiven = false;
challenge2SuccessImageShown = false;
challenge2PendingMulticolors = 0;

// Challenge 3
challenge3Active = false;
challenge3Started = false;
challenge3Done = false;
challenge3Failed = false;
challenge3Success = false;
challenge3Count = 0;

// Challenge 4
challenge4Active = false;
challenge4Done = false;
challenge4Count = 0;
challenge4FullFieldMoments = 0;
challenge4Success = false;
challenge4RewardGiven = false;

// Challenge 5
challenge5Active = false;
challenge5Done = false;
challenge5Success = false;
challenge5BlockCounter = 0;
challenge5StartImageShown = false;
challenge5SuccessImageShown = false;
challenge5Started = false;

// Challenge 6
challenge6Active = false;
challenge6Done = false;
challenge6Success = false;
challenge6BlockCounter = 0;
challenge6SixGroupCount = 0;
challenge6RewardGiven = false;

// Challenge 7
challenge7Active = false;
challenge7Done = false;
challenge7Success = false;
challenge7BlockCount = 0;
challenge7GroupCount = 0;
challenge7RewardGiven = false;

updateChallengeStatusCell();
updateChallenge2StatusCell();
updateChallenge3StatusCell();
updateChallenge4StatusCell();
updateChallenge5StatusCell();
updateChallenge6StatusCell();
updateChallenge7StatusCell();
updateLevelDisplay();
updateLevelAndBpmDisplay();

  // Nieuw blokje genereren
  nextBlock = generateNextBlock();
 updateNextBlockDisplay(nextBlock.color, nextBlock.length, nextBlock.isDiva);
  fallingBlock = createBlock("down");

  drawGrid();
  drawFallingBlock();

 
  fallSpeed = 400;
clearInterval(fallInterval);
fallInterval = setInterval(gameLoop, fallSpeed);

}


// pauzeren en herstarten - console.log lijkt mij niet nuttig

function pauseGame() {
  gamePaused = true;
    score -= 10;
  if (score < 0) score = 0;  // Optioneel: score mag niet negatief worden
  updateScoreDisplay();
  console.log('Game gepauzeerd');
}

function resumeGame() {
  gamePaused = false;
  console.log('Game hervat');
}

function pauseGame1() {
  gamePaused = true;
  console.log('Game gepauzeerd');
}

// bepaalt grootte van raster en blokjes
function positionGrid() {
  const canvas = document.getElementById("gameCanvas");
  const grid = document.querySelector(".grid");

  const canvasSize = canvas.clientWidth;   // of .clientHeight als je liever verticaal baseert
  const unit = canvasSize / 30;            // 1 blok = 1/30 van canvas
  const offset = unit * 10;                // 10 blokken marge voor scrollruimte
  const visibleSize = unit * 10;           // 10x10 raster

  grid.style.width = `${visibleSize}px`;
  grid.style.height = `${visibleSize}px`;
  grid.style.left = `${offset}px`;
  grid.style.top = `${offset}px`;
}

window.addEventListener("resize", positionGrid);
window.addEventListener("load", positionGrid);

// niet gebruikt

function lightenColor(color, percent) {
  let num = parseInt(color.slice(1), 16),
      amt = Math.round(2.55 * percent * 100),
      R = (num >> 16) + amt,
      G = (num >> 8 & 0x00FF) + amt,
      B = (num & 0x0000FF) + amt;
  return "#" + (
    0x1000000 +
    (R<255?R<1?0:R:255)*0x10000 +
    (G<255?G<1?0:G:255)*0x100 +
    (B<255?B<1?0:B:255)
  ).toString(16).slice(1);
}
function darkenColor(color, percent) {
  return lightenColor(color, -percent);
}


// pauzeknop en aantal pauzes updaten (zou ik dus willen verwijderen)

function updatePauseDisplay() {
  const pauseCell = document.getElementById('pauseCell');
  pauseCell.title = `Pauze`;

  // Leeg de cel eerst
  pauseCell.innerHTML = '';

  // Maak de knop
  const button = document.createElement('button');
  button.id = 'pauseButton';
  button.style.all = 'unset';
  button.style.display = 'flex';
  button.style.alignItems = 'center';
  button.style.justifyContent = 'center';
  button.style.cursor = 'pointer';
  button.style.height = '100%';
  button.style.width = '100%';

  // Container voor twee afbeeldingen
  const innerDiv = document.createElement('div');
  innerDiv.style.display = 'flex';
  innerDiv.style.width = '100%';
  innerDiv.style.alignItems = 'center';

  // Selecteer juiste afbeeldingen per status
  const img1 = document.createElement('img');



  const img2 = document.createElement('img');

  if (isPaused) {
    img1.src = 'images/fig46.png'; // afbeelding 1 bij pauze
    img2.src = 'images/fig47.png'; // afbeelding 2 bij pauze
  } else {
    img1.src = 'images/fig48.png'; // afbeelding 1 bij spelen
    img2.src = 'imagess/fig49.png'; // afbeelding 2 bij spelen
  }


if (isPaused) {
  img1.src = 'images/fig46.png';
} else {
  img1.src = 'images/fig48.png';
}

img1.alt = 'PauseState1';
img1.style.width = '50%';
img1.style.objectFit = 'contain';
img1.style.filter = pauseUsesLeft === 0 ? 'grayscale(100%)' : 'none';

// Tekst vervangen img2
const textDivWrapper = document.createElement('div');
textDivWrapper.style.width = '50%';
textDivWrapper.style.display = 'flex';
textDivWrapper.style.alignItems = 'center';
textDivWrapper.style.justifyContent = 'center';

const textDiv = document.createElement('div');
textDiv.style.textAlign = 'center';
textDiv.style.fontFamily = "'Baloo Bhaina 2', sans-serif";
textDiv.style.fontWeight = 'bold';
textDiv.style.fontSize = '0.7rem';
textDiv.style.color = '#f4c644';
textDiv.style.lineHeight = '1.1';
textDiv.style.paddingTop = '5px';
textDiv.style.textTransform = 'uppercase';

textDiv.innerHTML = isPaused ? 'RESUME' : 'NEED A<br>BREAK ?';

textDivWrapper.appendChild(textDiv);

// Voeg toe
innerDiv.appendChild(img1);
innerDiv.appendChild(textDivWrapper);





  button.appendChild(innerDiv);
  pauseCell.appendChild(button);

  // Eventlistener opnieuw koppelen
  button.onclick = () => {
    if (!isPaused) {
      if (pauseUsesLeft <= 0) return;
      pauseUsesLeft--;
      pauseGame();
      isPaused = true;
      openPauseModal();
    } else {
      resumeGame();
      isPaused = false;
    }
    updatePauseDisplay();
  };
}





// tonen van het volgende blokje in cel 9

function updateNextBlockDisplay(color, length = 1, isDiva = false) {
  const previewContainer = document.getElementById("nextBlockPreview");
  previewContainer.innerHTML = ''; // Leegmaken

  for (let i = 0; i < length; i++) {
    const blockPreview = document.createElement("div");
    blockPreview.style.width = "12px";
    blockPreview.style.height = "12px";
    blockPreview.style.backgroundColor = color;
    blockPreview.style.borderRadius = "3px"; // Afgerond
    //blockPreview.style.boxShadow = "0 0 4px rgba(255, 255, 255, 0.7)";
    blockPreview.style.margin = "1px";
    blockPreview.style.position = "relative";

    if (isDiva) {
      const numberOverlay = document.createElement("div");
      //numberOverlay.textContent = "9";
      numberOverlay.textContent = challenge5Active ? "29" : "9";
      numberOverlay.style.position = "absolute";
      numberOverlay.style.top = "50%";
      numberOverlay.style.left = "50%";
      numberOverlay.style.transform = "translate(-50%, -60%)";

      // Kleur van de tekst bepalen op basis van achtergrondkleur
      const rgb = getRGB(color);
      const brightness = (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;
      //numberOverlay.style.color = brightness < 128 ? "white" : "black";
      //numberOverlay.style.color = brightness < 128 ? "#F9F4EA" : "#2B2B2B";
      numberOverlay.style.color = brightness < 128 ? "#F9F4EA" : "#2B2B2B";

      numberOverlay.style.fontSize = "13px";
      numberOverlay.style.fontWeight = "bold";
      numberOverlay.style.fontFamily = "'Baloo Bhaina 2', sans-serif";
      blockPreview.appendChild(numberOverlay);
    }

    previewContainer.appendChild(blockPreview);
  }
}

// Hulpfunctie om hex- of rgb-kleur om te zetten naar RGB-object
function getRGB(color) {
  const ctx = document.createElement("canvas").getContext("2d");
  ctx.fillStyle = color;
  const computed = ctx.fillStyle;
  document.body.appendChild(ctx.canvas);
  ctx.canvas.style.display = 'none';

  ctx.fillRect(0, 0, 1, 1);
  const [r, g, b] = ctx.getImageData(0, 0, 1, 1).data;
  ctx.canvas.remove();
  return { r, g, b };
}



// het tonen van de beelden in midden onder cel bij het verwijderen van 5 blokjes - per kleur - blijft 5 sec
function temporarilyChangeResetImage(color) {
  const newImage = resetImages[color];
  if (!newImage) return;
  resetButtonElements.forEach(img => img.src = newImage);
  setTimeout(() => {
    resetButtonElements.forEach(img => img.src = originalResetImage);
  }, 5000);
}

// het tonen van het hartje in midden onder cel - blijft 5 sec

// het tonen van het hartje in midden onder cel - blijft 5 sec


function showHeartImageTemporarily() {
    if (challengeActive) return;
  resetButtonElements.forEach(img => {
    img.src = "images/fig50.png?cb=" + Math.random(); // Cache-bypass
  });
  setTimeout(() => {
    resetButtonElements.forEach(img => img.src = originalResetImage);
  }, 5000);
}



// het tonen van het dive in midden onder cel - blijft 5 sec
function showDivaImageTemporarily() {
  resetButtonElements.forEach(img => {
  img.src = "images/fig51.png?cb=" + Math.random(); // Cache-bypass
});
  setTimeout(() => {
    resetButtonElements.forEach(img => img.src = originalResetImage);
  }, 5000); 
}




// aantal levens tonen
function updateLivesDisplay() {
  document.getElementById("livesText").textContent = lives;
}

// aantal levels tonen
function updateLevelDisplay() {
  document.getElementById("levelValue").textContent = level;
  const extra = document.getElementById("levelDisplayExtra");
  if (extra) extra.textContent = level;
}


function updateMulticolorDisplay() {
  document.getElementById("multicolorCount").textContent = multicolorCount;
}

function updateSkipDisplay() {
 // document.getElementById("skipCount").textContent = skipUsesLeft;
document.getElementById("renewCounter").textContent = renewTokenCount;

}

// balkje dat tot 10 loopt

//function updateRenewDisplay() {
//  const fraction = blockSpawnCount / 10;
//  renewBar.style.width = `${fraction * 100}%`;
//  renewCounter.textContent = `${renewTokenCount}`;
//}

function updateRenewDisplay() {
  const percentage = (blockSpawnCount / 10) * 100;
  const renewBar = document.getElementById("renewProgressBar");
  const renewCounter = document.getElementById("renewCounter");

  if (renewBar) {
    renewBar.style.width = `${percentage}%`;
  }

  if (renewCounter) {
    renewCounter.textContent = `${renewTokenCount}`;
  }
}

// score en level tonen

function updateScoreDisplay() {
  const scoreValue = document.getElementById("scoreValue");
  if (scoreValue) {
    scoreValue.textContent = `${score}`;
  }

  const levelValue = document.getElementById("levelValue");
  if (levelValue) {
    levelValue.textContent = level;
  }
}


// lengte van het blok
    function randomBlockLength() {
      return Math.floor(Math.random() * 3) + 1;
    }

// de 9 cellen beginnen met een tekstgrootte van 32 en worden kleiner gemaakt tot ze passen

function resizeTextToFit(element) {
    let fontSize = 32; // Begin met grootte 32px
    element.style.fontSize = fontSize + "px";

    while (element.scrollWidth > element.clientWidth && fontSize > 5) {
        fontSize--;
        element.style.fontSize = fontSize + "px";
    }
}

// Pas het toe op alle .info elementen
document.querySelectorAll('.info').forEach(resizeTextToFit);

// volgende blok aanmaken

function generateNextBlock() {
  if (forcedNextBlock) {
    const block = { ...forcedNextBlock };
    forcedNextBlock = null;
    return block;
  }

  // hartjes in chal 1 maken
  if (challengeActive && challengeHeartOverrideCounter > 0) {
  challengeHeartOverrideCounter--;

  const color = colors[Math.floor(Math.random() * colors.length)];

  return {
    color: color, 
    length: 1,
    isSpecial: true,
    isMulticolor: false,
    isDiva: false,
    divaCountdown: null
  };
}

  let length = level <= 3 ? 1 : Math.floor(Math.random() * 3) + 1;

  let color;

// bij lage level maar 1 kleur
  if (level <= 2) {
  if (!level1FixedColor) {
    level1FixedColor = colors[Math.floor(Math.random() * colors.length)];
  }
  color = level1FixedColor;
} else {
  color = colors[Math.floor(Math.random() * colors.length)];
}

  const allowSpecials = level >= 5;

  const isSpecial = allowSpecials && level >= 5 && Math.random() < 1 / 25; // frequentie hartjes
  let isMulticolor = false;

// Challenge 2: forceer elke 3e blok een multicolor

let forceChallenge2Multicolor = challenge2Active && challenge2BlockCounter % 3 === 2;
if (forceChallenge2Multicolor) {
  isMulticolor = true;
  length = 1; // â† Zorg dat het blok 1 lang is
} else {
  isMulticolor = allowSpecials && level >= 7 && (nextBlockIsMulticolor || Math.random() < multicolorSpawnChance);
}

const isDiva = allowSpecials && level >= 6 && Math.random() < (challenge5Active ? challenge5DivaChance : defaultDivaChance);

//const isDiva = allowSpecials && level >= 6 && Math.random() < 1 / 10; // frequentie diva
  //const divaCountdown = isDiva ? 10 : null;
const divaCountdown = isDiva ? (challenge5Active ? 29 : 10) : null;


  nextBlockIsMulticolor = false;
  nextBlockColor = null;

  return {
    color,
    length,
    isSpecial,
    isMulticolor,
    isDiva,
    divaCountdown
  };
}




// het aftellen van de diva + het bekijken of ze met een groep van 5 magverdwijnen EN rekening houden met challenges om die verdwijningen mee te tellen

function updateDivaCountdowns() {
  for (let r = 0; r < gridRows; r++) {
    for (let c = 0; c < gridCols; c++) {
      const block = field[r][c];
      if (block && block.isDiva) {
        if (block.divaCountdown > 1) {
          block.divaCountdown--;
        } else if (block.divaCountdown === 1) {
          // Zet diva om naar normaal blok
          block.isDiva = false;
          block.divaCountdown = null;
        }
      }
    }
  }
}


// na het genereren wordt er nu  create block

function createBlock(direction = "down") {
 
  updateChallengeStatusCell();
  updateChallenge2StatusCell();
  updateChallenge3StatusCell();
  updateChallenge4StatusCell();
  updateChallenge5StatusCell();
  updateChallenge6StatusCell();
  updateChallenge7StatusCell();
  updateLevelDisplay();
  updateLevelAndBpmDisplay();

  const block = forcedNextBlock || nextBlock;
if (forcedNextBlock) forcedNextBlock = null;
  nextBlock = generateNextBlock();

  // diva direct laten zien in beeld onderaan
  if (block.isDiva) showDivaImageTemporarily();

updateNextBlockDisplay(nextBlock.color, nextBlock.length, nextBlock.isDiva);

  const startX = Math.floor(gridCols / 2 - Math.floor(block.length / 2));
  const y = direction === "down" ? -extraRowsAbove : gridRows + extraRowsBelow;

  blockCounter++;



  // Bovenaan, net zoals je deed:

const wrapper = document.getElementById("saveWrapper");

if (!saveUnlocked) {
  saveBlockCountdown--;

  if (saveBlockCountdown > 0) {
    // Toon aftelversie
    wrapper.innerHTML = `
      <img src="images/fig52.png" style="width: 33.33%; object-fit: contain;">
        <div style="width: 33.33%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.45rem; color: #f4c644; line-height: 1.1; padding-top: 3px; text-transform: uppercase;">
    CAN<br>SAVE<br>IN ...
  </div>
      <span id="saveBlockCounter" style="width: 33.33%; text-align: center; color: #f4c644; font-weight: bold; font-size: 1rem; font-family: 'Baloo Bhaina 2', sans-serif;">${saveBlockCountdown}</span>
    `;
  } else {
    // Klaar om te bewaren â€” hele wrapper klikbaar
    saveUnlocked = true;
    wrapper.innerHTML = `
      <img src="images/fig53.png" style="width: 33.33%; object-fit: contain;">

        <div style="width: 33.33%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.6rem; color: #f4c644; line-height: 1.1; padding-top: 5px; text-transform: uppercase;">
    SAVE ?
  </div>
      <img src="images/fig53.png" style="width: 33.33%; object-fit: contain;">
    `;

    wrapper.style.cursor = "pointer"; // geef visuele hint

    wrapper.onclick = function handleSaveClick() {
      const overlay = document.getElementById("saveConfirmOverlay");
      if (overlay) overlay.style.display = "flex";
      pauseGame1();

      const yesBtn = document.getElementById("saveYesBtn");
      const noBtn = document.getElementById("saveNoBtn");

      if (yesBtn) {
        yesBtn.onclick = () => {
          saveTestScore();
          overlay.style.display = "none";
          resumeGame();

          // Reset teller en terug naar aftelbeeld
          saveUnlocked = false;
          saveBlockCountdown = 99;
          wrapper.style.cursor = "default";
          wrapper.onclick = null;
          wrapper.innerHTML = `
            <img src="images/fig52.png" style="width: 33.33%; object-fit: contain;">
            <div style="width: 33.33%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.45rem; color: #f4c644; line-height: 1.1; padding-top: 3px; text-transform: uppercase;">
    CAN<br>SAVE<br>IN ...
  </div>
            <span id="saveBlockCounter" style="width: 33.33%; text-align: center; color: #f4c644; font-weight: bold; font-size: 1rem; font-family: 'Baloo Bhaina 2', sans-serif;">${saveBlockCountdown}</span>
          `;
        };
      }

      if (noBtn) {
        noBtn.onclick = () => {
          overlay.style.display = "none";
          resumeGame();

          // toon opnieuw klikbare 3 afbeeldingen
          wrapper.innerHTML = `
            <img src="images/fig53.png" style="width: 33.33%; object-fit: contain;">
           
        <div style="width: 33.33%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.60rem; color: #f4c644; line-height: 1.1; padding-top: 5px; text-transform: uppercase;">
    SAVE ?
  </div>
            <img src="images/fig53.png" style="width: 33.33%; object-fit: contain;">
          `;
          wrapper.onclick = handleSaveClick;
          wrapper.style.cursor = "pointer";
        };
      }
    };
  }
} else {
  const counter = document.getElementById("saveBlockCounter");
  if (counter) counter.textContent = saveBlockCountdown;
}







  if (challengeActive) {
    challengeBlockCounter++;
  }

  if (challenge2Active) {
  challenge2BlockCounter++;
}

if (challenge3Active) {
    challenge3Count++;
    updateChallenge3StatusCell();
  }

  if (challenge6Active && !challenge6Success) {
  challenge6BlockCounter++;
  updateChallenge6StatusCell();
  if (challenge6BlockCounter >= 100 && challenge6SixGroupCount < 10) {
    endChallenge6(false);
  }
}

if (challenge7Active && !challenge7Success) {
  challenge7BlockCount++;
  fallSpeed -= challenge7SpeedStep;
  clearInterval(fallInterval);
fallInterval = setInterval(gameLoop, fallSpeed);
  updateChallenge7StatusCell();

  if (challenge7BlockCount >= challenge7BlockLimit && challenge7GroupCount < challenge7TargetGroups) {
    endChallenge7(false);
  }
}



  if (challenge5Active) {
  challenge5BlockCounter++;
  updateChallenge5StatusCell();
  // hier w chal 5 al afgesloten want je moet gewoon overleven
  if (challenge5BlockCounter >= challenge5RequiredBlocks && !challenge5Done) {
    challenge5Done = true;
    challenge5Active = false;
    challenge5Success = true;
    challenge5RewardGiven = true;
    //score += 250;
    multicolorCount += 3;

// EXTRA: SUCCES IN PRACTICE-MODUS â€“ CHALLENGE 5
if (practiceModech51) {
  practiceChallenge5Wins51++;
  localStorage.setItem("practiceChallenge5Wins51", practiceChallenge5Wins51);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech52) {
  practiceChallenge5Wins52++;
  localStorage.setItem("practiceChallenge5Wins52", practiceChallenge5Wins52);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech53) {
  practiceChallenge5Wins53++;
  localStorage.setItem("practiceChallenge5Wins53", practiceChallenge5Wins53);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech54) {
  practiceChallenge5Wins54++;
  localStorage.setItem("practiceChallenge5Wins54", practiceChallenge5Wins54);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech55) {
  practiceChallenge5Wins55++;
  localStorage.setItem("practiceChallenge5Wins55", practiceChallenge5Wins55);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech56) {
  practiceChallenge5Wins56++;
  localStorage.setItem("practiceChallenge5Wins56", practiceChallenge5Wins56);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech57) {
  practiceChallenge5Wins57++;
  localStorage.setItem("practiceChallenge5Wins57", practiceChallenge5Wins57);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech58) {
  practiceChallenge5Wins58++;
  localStorage.setItem("practiceChallenge5Wins58", practiceChallenge5Wins58);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech59) {
  practiceChallenge5Wins59++;
  localStorage.setItem("practiceChallenge5Wins59", practiceChallenge5Wins59);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}


    showCelebrationOverlay("images/fig44.png"); // nog aan te passen
    updateChallenge5StatusCell();


    
  }
}


// skip block teller
  blockSpawnCount++;
  blockSpawnCountfree++;
  checkFreePicMilestone()
  if (blockSpawnCount >= 10) {
    blockSpawnCount = 0;
    renewTokenCount++;
  }
  updateRenewDisplay();

// de info over blokje om door te geven aan create block
  return {
    x: startX,
    y: y,
    color: block.color,
    length: block.length,
    direction: direction,
    isSpecial: block.isSpecial,
    isMulticolor: block.isMulticolor,
    isDiva: block.isDiva,
    divaCountdown: block.divaCountdown
  };

// wordt blijkbaar niet uitgevoerd omdat na return komt - maar is toch dubbel op

  if (challenge5Active && !challenge5Done) {
  challenge5BlockCounter++;
  updateChallenge5StatusCell();
  if (challenge5BlockCounter >= challenge5RequiredBlocks) {
    challenge5Done = true;
    challenge5Active = false;
    challenge5Success = true;
    challenge5RewardGiven = true;
    //score += 250;
    multicolorCount += 3;

// EXTRA: SUCCES IN PRACTICE-MODUS â€“ CHALLENGE 5
if (practiceModech51) {
  practiceChallenge5Wins51++;
  localStorage.setItem("practiceChallenge5Wins51", practiceChallenge5Wins51);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech52) {
  practiceChallenge5Wins52++;
  localStorage.setItem("practiceChallenge5Wins52", practiceChallenge5Wins52);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech53) {
  practiceChallenge5Wins53++;
  localStorage.setItem("practiceChallenge5Wins53", practiceChallenge5Wins53);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech54) {
  practiceChallenge5Wins54++;
  localStorage.setItem("practiceChallenge5Wins54", practiceChallenge5Wins54);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech55) {
  practiceChallenge5Wins55++;
  localStorage.setItem("practiceChallenge5Wins55", practiceChallenge5Wins55);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech56) {
  practiceChallenge5Wins56++;
  localStorage.setItem("practiceChallenge5Wins56", practiceChallenge5Wins56);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech57) {
  practiceChallenge5Wins57++;
  localStorage.setItem("practiceChallenge5Wins57", practiceChallenge5Wins57);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech58) {
  practiceChallenge5Wins58++;
  localStorage.setItem("practiceChallenge5Wins58", practiceChallenge5Wins58);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech59) {
  practiceChallenge5Wins59++;
  localStorage.setItem("practiceChallenge5Wins59", practiceChallenge5Wins59);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}


    updateScoreDisplay();
    showCelebrationOverlay("images/fig44.png");
  }
  updateChallenge5StatusCell(); // â† deze toevoegen
}

}


function createBlockH(direction = "right") {
 
  updateChallengeStatusCell();
  updateChallenge2StatusCell();
  updateChallenge3StatusCell();
  updateChallenge4StatusCell();
  updateChallenge5StatusCell();
  updateChallenge6StatusCell();
  updateChallenge7StatusCell();
  updateLevelDisplay();
  updateLevelAndBpmDisplay();

  const block = forcedNextBlock || nextBlock;
if (forcedNextBlock) forcedNextBlock = null;
  nextBlock = generateNextBlock();
 updateNextBlockDisplay(nextBlock.color, nextBlock.length, nextBlock.isDiva);
  if (block.isDiva) showDivaImageTemporarily();

  const startY = Math.floor(gridRows / 2 - Math.floor(block.length / 2));
  const x = direction === "right" ? -extraColsLeft : gridCols + extraColsRight;

  blockCounter++;


// Bovenaan, net zoals je deed:
const wrapper = document.getElementById("saveWrapper");

if (!saveUnlocked) {
  saveBlockCountdown--;

  if (saveBlockCountdown > 0) {
    // Toon aftelversie
    wrapper.innerHTML = `
      <img src="images/fig52.png" style="width: 33.33%; object-fit: contain;">
       <div style="width: 33.33%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.45rem; color: #f4c644; line-height: 1.1; padding-top: 3px; text-transform: uppercase;">
    CAN<br>SAVE<br>IN ...
  </div>
      <span id="saveBlockCounter" style="width: 33.33%; text-align: center; color: #f4c644; font-weight: bold; font-size: 1rem; font-family: 'Baloo Bhaina 2', sans-serif;">${saveBlockCountdown}</span>
    `;
  } else {
    // Klaar om te bewaren â€” hele wrapper klikbaar
    saveUnlocked = true;
    wrapper.innerHTML = `
      <img src="images/fig53.png" style="width: 33.33%; object-fit: contain;">
      <div style="width: 33.33%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.60rem; color: #f4c644; line-height: 1.1; padding-top: 5px; text-transform: uppercase;">
    SAVE ?
  </div>
      <img src="images/fig53.png" style="width: 33.33%; object-fit: contain;">
    `;

    wrapper.style.cursor = "pointer"; // geef visuele hint

    wrapper.onclick = function handleSaveClick() {
      const overlay = document.getElementById("saveConfirmOverlay");
      if (overlay) overlay.style.display = "flex";
      pauseGame1();

      const yesBtn = document.getElementById("saveYesBtn");
      const noBtn = document.getElementById("saveNoBtn");

      if (yesBtn) {
        yesBtn.onclick = () => {
          saveTestScore();
          overlay.style.display = "none";
          resumeGame();

          // Reset teller en terug naar aftelbeeld
          saveUnlocked = false;
          saveBlockCountdown = 99;
          wrapper.style.cursor = "default";
          wrapper.onclick = null;
          wrapper.innerHTML = `
            <img src="images/fig52.png" style="width: 33.33%; object-fit: contain;">
             <div style="width: 33.33%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.45rem; color: #f4c644; line-height: 1.1; padding-top: 3px; text-transform: uppercase;">
    CAN<br>SAVE<br>IN ...
  </div>
            <span id="saveBlockCounter" style="width: 33.33%; text-align: center; color: #f4c644; font-weight: bold; font-size: 1rem; font-family: 'Baloo Bhaina 2', sans-serif;">${saveBlockCountdown}</span>
          `;
        };
      }

      if (noBtn) {
        noBtn.onclick = () => {
          overlay.style.display = "none";
          resumeGame();

          // toon opnieuw klikbare 3 afbeeldingen
          wrapper.innerHTML = `
            <img src="images/fig53.png" style="width: 33.33%; object-fit: contain;">
            <div style="width: 33.33%; text-align: center; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; font-size: 0.60rem; color: #f4c644; line-height: 1.1; padding-top: 5px; text-transform: uppercase;">
    SAVE ?
  </div>
            <img src="images/fig53.png" style="width: 33.33%; object-fit: contain;">
          `;
          wrapper.onclick = handleSaveClick;
          wrapper.style.cursor = "pointer";
        };
      }
    };
  }
} else {
  const counter = document.getElementById("saveBlockCounter");
  if (counter) counter.textContent = saveBlockCountdown;
}




  if (challengeActive) {
    challengeBlockCounter++;
  }

  if (challenge2Active) {
  challenge2BlockCounter++;
}

if (challenge3Active) {
    challenge3Count++;
    updateChallenge3StatusCell();
  }

if (challenge6Active && !challenge6Success) {
  challenge6BlockCounter++;
  updateChallenge6StatusCell();
  if (challenge6BlockCounter >= 100 && challenge6SixGroupCount < 10) {
    endChallenge6(false);
  }
}

if (challenge7Active && !challenge7Success) {
  challenge7BlockCount++;
  fallSpeed -= challenge7SpeedStep;
  clearInterval(fallInterval);
fallInterval = setInterval(gameLoop, fallSpeed);
  updateChallenge7StatusCell();

  if (challenge7BlockCount >= challenge7BlockLimit && challenge7GroupCount < challenge7TargetGroups) {
    endChallenge7(false);
  }
}


  if (challenge5Active) {
  challenge5BlockCounter++;
  updateChallenge5StatusCell();
  if (challenge5BlockCounter >= challenge5RequiredBlocks && !challenge5Done) {
    challenge5Done = true;
    challenge5Active = false;
    challenge5Success = true;
    challenge5RewardGiven = true;
    //score += 250;
    multicolorCount += 3;

// EXTRA: SUCCES IN PRACTICE-MODUS â€“ CHALLENGE 5
if (practiceModech51) {
  practiceChallenge5Wins51++;
  localStorage.setItem("practiceChallenge5Wins51", practiceChallenge5Wins51);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech52) {
  practiceChallenge5Wins52++;
  localStorage.setItem("practiceChallenge5Wins52", practiceChallenge5Wins52);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech53) {
  practiceChallenge5Wins53++;
  localStorage.setItem("practiceChallenge5Wins53", practiceChallenge5Wins53);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech54) {
  practiceChallenge5Wins54++;
  localStorage.setItem("practiceChallenge5Wins54", practiceChallenge5Wins54);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech55) {
  practiceChallenge5Wins55++;
  localStorage.setItem("practiceChallenge5Wins55", practiceChallenge5Wins55);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech56) {
  practiceChallenge5Wins56++;
  localStorage.setItem("practiceChallenge5Wins56", practiceChallenge5Wins56);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech57) {
  practiceChallenge5Wins57++;
  localStorage.setItem("practiceChallenge5Wins57", practiceChallenge5Wins57);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech58) {
  practiceChallenge5Wins58++;
  localStorage.setItem("practiceChallenge5Wins58", practiceChallenge5Wins58);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech59) {
  practiceChallenge5Wins59++;
  localStorage.setItem("practiceChallenge5Wins59", practiceChallenge5Wins59);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}


    showCelebrationOverlay("images/fig44.png");
    updateChallenge5StatusCell();
  }
}

 


  blockSpawnCount++;
  blockSpawnCountfree++;
  if (blockSpawnCount >= 10) {
    blockSpawnCount = 0;
    renewTokenCount++;
  }
  updateRenewDisplay();

  return {
    x: x,
    y: startY,
    color: block.color,
    length: block.length,
    direction: direction,
    isSpecial: block.isSpecial,
    isMulticolor: block.isMulticolor,
    isDiva: block.isDiva,
    divaCountdown: block.divaCountdown
  };

  // wordt blijkbaar niet uitgevoerd omdat na return komt - maar is toch dubbel op
  if (challenge5Active && !challenge5Done) {
  challenge5BlockCounter++;
  updateChallenge5StatusCell();
  if (challenge5BlockCounter >= challenge5RequiredBlocks) {
    challenge5Done = true;
    challenge5Active = false;
    challenge5Success = true;
    challenge5RewardGiven = true;
    //score += 250;
    multicolorCount += 3;

// EXTRA: SUCCES IN PRACTICE-MODUS â€“ CHALLENGE 5
if (practiceModech51) {
  practiceChallenge5Wins51++;
  localStorage.setItem("practiceChallenge5Wins51", practiceChallenge5Wins51);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech52) {
  practiceChallenge5Wins52++;
  localStorage.setItem("practiceChallenge5Wins52", practiceChallenge5Wins52);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech53) {
  practiceChallenge5Wins53++;
  localStorage.setItem("practiceChallenge5Wins53", practiceChallenge5Wins53);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech54) {
  practiceChallenge5Wins54++;
  localStorage.setItem("practiceChallenge5Wins54", practiceChallenge5Wins54);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech55) {
  practiceChallenge5Wins55++;
  localStorage.setItem("practiceChallenge5Wins55", practiceChallenge5Wins55);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech56) {
  practiceChallenge5Wins56++;
  localStorage.setItem("practiceChallenge5Wins56", practiceChallenge5Wins56);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech57) {
  practiceChallenge5Wins57++;
  localStorage.setItem("practiceChallenge5Wins57", practiceChallenge5Wins57);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech58) {
  practiceChallenge5Wins58++;
  localStorage.setItem("practiceChallenge5Wins58", practiceChallenge5Wins58);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech59) {
  practiceChallenge5Wins59++;
  localStorage.setItem("practiceChallenge5Wins59", practiceChallenge5Wins59);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}


    updateScoreDisplay();
    showCelebrationOverlay("images/fig44.png");
  }
  updateChallenge5StatusCell(); // â† deze toevoegen
}

}


// dit gebeurt er bij de opstart van het spel

    let directionToggle = true;
    
    nextBlock = generateNextBlock();
updateNextBlockDisplay(nextBlock.color, nextBlock.length, nextBlock.isDiva);

//const stored = localStorage.getItem("testScore");
//if (stored !== null) {
//  score = parseInt(stored);
//  updateScoreDisplay();
//}

const stored = localStorage.getItem("testScore");
const continueButton = document.getElementById("continueButton");
let hasSavedGame = false;
if (stored !== null) {
  score = parseInt(stored);
  updateScoreDisplay();
  hasSavedGame = true;
}

updateChallengeStatusCell();
updateChallenge2StatusCell();
updateChallenge3StatusCell();
updateChallenge4StatusCell();
updateChallenge5StatusCell();
updateChallenge6StatusCell();
updateChallenge7StatusCell();
updateLevelDisplay();
updateLevelAndBpmDisplay();

let fallingBlock = createBlock("down");


// movegrid: bewegen van het raster




function moveGrid(dir) {
  const newOffset = gridOffsetX + dir;
  
  if (!useVertical) {
    return; // vertical is de andere functie
  }

  if (newOffset < -maxOffset || newOffset > maxOffset) return;

  let canMove = true;

  const newBlockX = fallingBlock.x - dir;
  const blockEnd = newBlockX + fallingBlock.length;


if (fallingBlock.y <0 && newBlockX+1 > 0 && blockEnd-1 < gridCols){
gridOffsetX = newOffset;
fallingBlock.x = newBlockX;
//updateDisplay();
}


if (fallingBlock.y >gridRows && newBlockX+1 > 0 && blockEnd-1 < gridCols){
gridOffsetX = newOffset;
fallingBlock.x = newBlockX;
//updateDisplay();
}

if (fallingBlock.y >=0 && newBlockX+1 > 0 && blockEnd-1 < gridCols){
    const row = Math.floor(fallingBlock.y); // <-- Belangrijk: afronden
    for (let i = 0; i < fallingBlock.length; i++) {
    const col = newBlockX + i;
    const row = fallingBlock.y;

    if (field[row][col] !== null) {
      canMove = false;
      break; // Stop met controleren als er een blokje in de weg zit
      return;
    }
  }

  if (canMove) {
    gridOffsetX = newOffset;
    fallingBlock.x = newBlockX;
//updateDisplay();
}
}
}


function moveGridH(dir) {
  const newOffset = gridOffsetY - dir;
  
  if (useVertical) {
    return; // dan de andere movegrid gebruiken
  }

  if (newOffset < -maxOffsetY || newOffset > maxOffsetY) return; 
  let canMove = true;

  const newBlockY = fallingBlock.y - dir;
  const blockEnd = newBlockY + fallingBlock.length;


//if (fallingBlock.x <0 && newBlockY+1 > 0 && blockEnd-1 < gridRows){
 if (fallingBlock.x >gridCols && newBlockY+1 > 0 && blockEnd-1 < gridRows){
gridOffsetY = newOffset;
fallingBlock.y = newBlockY;
//updateDisplayH();
}

//if (fallingBlock.x >gridCols && newBlockY+1 > 0 && blockEnd-1 < gridRows){
    if (fallingBlock.x <0 && newBlockY+1 > 0 && blockEnd-1 < gridRows){    

  // if (fallingBlock.x <0){
gridOffsetY = newOffset;
fallingBlock.y = newBlockY;
//updateDisplayH();
}

if (fallingBlock.x >=0 && newBlockY+1 > 0 && blockEnd-1 < gridRows){
    const col = Math.floor(fallingBlock.x); // <-- Deze lijn toevoegen hier!
    for (let i = 0; i < fallingBlock.length; i++) {
    const row = newBlockY + i;
  //  const row = fallingBlock.x;

    if (field[row][col] !== null) {
      canMove = false;
      break; // Stop met controleren als er een blokje in de weg zit
      return;
    }
  }

  if (canMove) {
    gridOffsetY = newOffset;
    fallingBlock.y = newBlockY;
//updateDisplayH();
}
}
}



// worden nergens aangeroepen dus zouden weg mogen
function updateDisplay() {
  // Je kunt een HTML element gebruiken om de status weer te geven
  document.getElementById('gridOffsetX').textContent = 'Grid Offset X: ' + gridOffsetX;
  document.getElementById('fallingBlockX').textContent = 'Falling Block X: ' + fallingBlock.x;
  document.getElementById('fallingBlockY').textContent = 'Falling Block Y: ' + fallingBlock.y;
  document.getElementById('fallingBlockLength').textContent = 'Falling Block Length: ' + fallingBlock.length;
  document.getElementById('canMove').textContent = 'Can Move: ' + (canMove ? 'Yes' : 'No');
}
function updateDisplayH() {
  // Je kunt een HTML element gebruiken om de status weer te geven
  document.getElementById('gridOffsetY').textContent = 'Grid Offset Y: ' + gridOffsetY;
  document.getElementById('fallingBlockY').textContent = 'Falling Block Y: ' + fallingBlock.y;
  document.getElementById('fallingBlockX').textContent = 'Falling Block X: ' + fallingBlock.x;
  document.getElementById('fallingBlockLength').textContent = 'Falling Block Length: ' + fallingBlock.length;
  document.getElementById('canMove').textContent = 'Can Move: ' + (canMove ? 'Yes' : 'No');
}
 

//update - bepaalt wat er gebeurt met een vallend blokje
// bepalen wat te doen als het nog verder kan vallen en niet meer verder kan vallen

    function update() {
   if (lives <= 0) {
  //showGameOverScreen();
  return;
}

// naar beneden en dus stijgende y
      if (fallingBlock.direction === "down") {
        fallingBlock.y++;
        if (fallingBlock.y >= gridRows || blockWouldCollide(fallingBlock)) {
          if (fallingBlock.y <= 0) { // verlies van leven als niet binnen veld geraakt
            
            lives--;

            if (lives <= 0) {
  showGameOverScreen();
  return;
}

            updateLivesDisplay();
            
            if (challenge3Active && !challenge3Failed) { // als leven verloren dan is chal 3 verloren
            challenge3Failed = true;
            challenge3Active = false;
            challenge3RewardGiven = true;

//if (practiceModech31) {
//  if (challenge3Success) {
//    practiceChallenge3Wins31++;  // âœ… teller verhogen
//    localStorage.setItem("practiceChallenge3Wins31", practiceChallenge3Wins31);
//    updatePracticeCellTeller(); // âœ… visueel updaten
//    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
//    return;
//  } else if (challenge3Failed) {
//    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
//    return;
//  }
//}

//[
//  { mode: practiceModech31, key: "practiceChallenge3Wins31", varName: "practiceChallenge3Wins31" },
//  { mode: practiceModech35, key: "practiceChallenge3Wins35", varName: "practiceChallenge3Wins35" },
//  { mode: practiceModech39, key: "practiceChallenge3Wins39", varName: "practiceChallenge3Wins39" }
//].forEach(entry => {
//  if (entry.mode) {
//    if (challenge3Success) {
//      window[entry.varName]++;
//      localStorage.setItem(entry.key, window[entry.varName]);
//      updatePracticeCellTeller();
//      pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
//    } else if (challenge3Failed) {
//      pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
//    }
//    return;
//  }
//});
if (practiceModech31) {
  if (challenge3Success) {
    practiceChallenge3Wins31++;
    localStorage.setItem("practiceChallenge3Wins31", practiceChallenge3Wins31);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech32) {
  if (challenge3Success) {
    practiceChallenge3Wins32++;
    localStorage.setItem("practiceChallenge3Wins32", practiceChallenge3Wins32);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech33) {
  if (challenge3Success) {
    practiceChallenge3Wins33++;
    localStorage.setItem("practiceChallenge3Wins33", practiceChallenge3Wins33);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech34) {
  if (challenge3Success) {
    practiceChallenge3Wins34++;
    localStorage.setItem("practiceChallenge3Wins34", practiceChallenge3Wins34);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech35) {
  if (challenge3Success) {
    practiceChallenge3Wins35++;
    localStorage.setItem("practiceChallenge3Wins35", practiceChallenge3Wins35);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech36) {
  if (challenge3Success) {
    practiceChallenge3Wins36++;
    localStorage.setItem("practiceChallenge3Wins36", practiceChallenge3Wins36);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech37) {
  if (challenge3Success) {
    practiceChallenge3Wins37++;
    localStorage.setItem("practiceChallenge3Wins37", practiceChallenge3Wins37);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech38) {
  if (challenge3Success) {
    practiceChallenge3Wins38++;
    localStorage.setItem("practiceChallenge3Wins38", practiceChallenge3Wins38);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech39) {
  if (challenge3Success) {
    practiceChallenge3Wins39++;
    localStorage.setItem("practiceChallenge3Wins39", practiceChallenge3Wins39);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}




            showCelebrationOverlay("images/fig45.png"); // gefaald afbeelding cahl 3
            updateChallenge3StatusCell();
            }
            
            updateLivesDisplay();



          } else { 
            
            if (fallingBlock.isFreePicture) {
  const fx = fallingBlock.x;
  const fy = fallingBlock.y;
  const blocksToRemove = [];

  for (let dx = -1; dx <= 1; dx++) {
    for (let dy = -1; dy <= 1; dy++) {
      const nx = fx + dx;
      const ny = fy + dy;
      if (
        nx >= 0 && nx < gridCols &&
        ny >= 0 && ny < gridRows &&
        !(dx === 0 && dy === 0) &&
        field[ny][nx]
      ) {
        blocksToRemove.push([ny, nx]);
      }
    }
  }

  // Voeg elk blokje correct toe aan disappearingBlocks
  for (const [r, c] of blocksToRemove) {
    const block = field[r][c];


if (block.isSpecial) {
  heartFreed = true;
  if (challengeActive) {
    challengeHeartCount++;
    // Geen leven toevoegen tijdens challenge 1
  } else {
    lives++;
  }
}

 //   if (block.isMulticolor) {
 //     multicolorCount++;
 //     updateMulticolorDisplay();
 //     if (challenge2Active) challenge2MultiCount++;
 //   }

if (block.isMulticolor) {
  if (challenge2Active) {
    challenge2MultiCount++;
  } else {
    multicolorCount++;
    updateMulticolorDisplay();
  }
}

    disappearingBlocks.push({ r, c, scale: 1, opacity: 1 });
  }

  // Score = aantalÂ²
  const n = blocksToRemove.length;
  score += n * n;
  updateScoreDisplay();
  updateHighStats();

  fallingBlock = null;
  drawGrid();
  return;
}


            
            for (let i = 0; i < fallingBlock.length; i++) {
              const col = fallingBlock.x + i;
              if (col >= 0 && col < gridCols) {
                //hier landt het blokje en info w in field gestoken
                if (fallingBlock.isSpecial) showHeartImageTemporarily();
                field[fallingBlock.y - 1][col] = {
                    color: fallingBlock.color,
                    isSpecial: fallingBlock.isSpecial,
                    isMulticolor: fallingBlock.isMulticolor,
                    isDiva: fallingBlock.isDiva,
                    divaCountdown: fallingBlock.divaCountdown
                    };
              }
            }
            
            // celebration omdat level 3 geslaagd is
            if (challenge3Active && !challenge3Failed) {
            if (challenge3Count >= challenge3Limit) {
            challenge3Success = true;
            challenge3Active = false;
            challenge3RewardGiven = true;

if (practiceModech31) {
  if (challenge3Success) {
    practiceChallenge3Wins31++;
    localStorage.setItem("practiceChallenge3Wins31", practiceChallenge3Wins31);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech32) {
  if (challenge3Success) {
    practiceChallenge3Wins32++;
    localStorage.setItem("practiceChallenge3Wins32", practiceChallenge3Wins32);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech33) {
  if (challenge3Success) {
    practiceChallenge3Wins33++;
    localStorage.setItem("practiceChallenge3Wins33", practiceChallenge3Wins33);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech34) {
  if (challenge3Success) {
    practiceChallenge3Wins34++;
    localStorage.setItem("practiceChallenge3Wins34", practiceChallenge3Wins34);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech35) {
  if (challenge3Success) {
    practiceChallenge3Wins35++;
    localStorage.setItem("practiceChallenge3Wins35", practiceChallenge3Wins35);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech36) {
  if (challenge3Success) {
    practiceChallenge3Wins36++;
    localStorage.setItem("practiceChallenge3Wins36", practiceChallenge3Wins36);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech37) {
  if (challenge3Success) {
    practiceChallenge3Wins37++;
    localStorage.setItem("practiceChallenge3Wins37", practiceChallenge3Wins37);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech38) {
  if (challenge3Success) {
    practiceChallenge3Wins38++;
    localStorage.setItem("practiceChallenge3Wins38", practiceChallenge3Wins38);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech39) {
  if (challenge3Success) {
    practiceChallenge3Wins39++;
    localStorage.setItem("practiceChallenge3Wins39", practiceChallenge3Wins39);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}



            showCelebrationOverlay("images/fig44.png");
            lives += 3;
            
            //score += 250;
            updateScoreDisplay();
            updateLivesDisplay();
            updateChallenge3StatusCell();
  }
}



            score += fallingBlock.length;
            updateScoreDisplay();
            updateHighStats();
            
            updateDivaCountdowns();
            checkMatches();
// challange 4 nakijken
  if (challenge4Active && !challenge4Success) {
  const fieldBlockCount = field.flat().filter(cell => cell !== null).length;

  if (fieldBlockCount >= 50) {
    challenge4FullFieldMoments++;
  }

  if (challenge4FullFieldMoments >= 10) {
    challenge4Active = false;
    challenge4Success = true;
    challenge4RewardGiven = true;
    //score += 250;
    multicolorCount += 3;
    updateScoreDisplay();
    multicolorDisplay.textContent = multicolorCount;
    

// EXTRA: SUCCES IN PRACTICE-MODUS
if (practiceModech41) {
  practiceChallenge4Wins41++;
  localStorage.setItem("practiceChallenge4Wins41", practiceChallenge4Wins41);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech42) {
  practiceChallenge4Wins42++;
  localStorage.setItem("practiceChallenge4Wins42", practiceChallenge4Wins42);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech43) {
  practiceChallenge4Wins43++;
  localStorage.setItem("practiceChallenge4Wins43", practiceChallenge4Wins43);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech44) {
  practiceChallenge4Wins44++;
  localStorage.setItem("practiceChallenge4Wins44", practiceChallenge4Wins44);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech45) {
  practiceChallenge4Wins45++;
  localStorage.setItem("practiceChallenge4Wins45", practiceChallenge4Wins45);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech46) {
  practiceChallenge4Wins46++;
  localStorage.setItem("practiceChallenge4Wins46", practiceChallenge4Wins46);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech47) {
  practiceChallenge4Wins47++;
  localStorage.setItem("practiceChallenge4Wins47", practiceChallenge4Wins47);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech48) {
  practiceChallenge4Wins48++;
  localStorage.setItem("practiceChallenge4Wins48", practiceChallenge4Wins48);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech49) {
  practiceChallenge4Wins49++;
  localStorage.setItem("practiceChallenge4Wins49", practiceChallenge4Wins49);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
showCelebrationOverlay("images/fig44.png");





  }

  challenge4Count++;
  updateChallenge4StatusCell();

  if (challenge4Count >= challenge4Limit && !challenge4Success) {
    challenge4Active = false;
    challenge4RewardGiven = true;
    showCelebrationOverlay("images/fig45.png");
    updateChallenge4StatusCell();

if (
  practiceModech41 || practiceModech42 || practiceModech43 || practiceModech44 ||
  practiceModech45 || practiceModech46 || practiceModech47 || practiceModech48 ||
  practiceModech49
) {
  pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
  return;
}



  }
}
}

// volgende richting voorbereiden
directionToggle = !directionToggle;
useVertical = false;
updateControls()

updateChallengeStatusCell();
updateChallenge2StatusCell();
updateChallenge3StatusCell();
updateChallenge4StatusCell();
updateChallenge5StatusCell();
updateChallenge6StatusCell();
updateChallenge7StatusCell();
updateLevelDisplay();
updateLevelAndBpmDisplay();

fallingBlock = createBlockH(directionToggle ? "right" : "left");
        }


// naar boven vallend - zelfde code als hierboven maar andere richting
      } else {
        const nextY = fallingBlock.y - 1;
        if (nextY < 0 || blockWouldCollide({ ...fallingBlock, y: nextY })) {
          if (fallingBlock.y-1 >= gridRows - 1) { // min 1 ***** ok
            lives--;

 if (lives <= 0) {
  showGameOverScreen();
  return;
}

            updateLivesDisplay();
if (challenge3Active && !challenge3Failed) {
  challenge3Failed = true;
  challenge3Active = false;
  challenge3RewardGiven = true;

if (practiceModech31) {
  if (challenge3Success) {
    practiceChallenge3Wins31++;
    localStorage.setItem("practiceChallenge3Wins31", practiceChallenge3Wins31);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech32) {
  if (challenge3Success) {
    practiceChallenge3Wins32++;
    localStorage.setItem("practiceChallenge3Wins32", practiceChallenge3Wins32);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech33) {
  if (challenge3Success) {
    practiceChallenge3Wins33++;
    localStorage.setItem("practiceChallenge3Wins33", practiceChallenge3Wins33);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech34) {
  if (challenge3Success) {
    practiceChallenge3Wins34++;
    localStorage.setItem("practiceChallenge3Wins34", practiceChallenge3Wins34);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech35) {
  if (challenge3Success) {
    practiceChallenge3Wins35++;
    localStorage.setItem("practiceChallenge3Wins35", practiceChallenge3Wins35);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech36) {
  if (challenge3Success) {
    practiceChallenge3Wins36++;
    localStorage.setItem("practiceChallenge3Wins36", practiceChallenge3Wins36);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech37) {
  if (challenge3Success) {
    practiceChallenge3Wins37++;
    localStorage.setItem("practiceChallenge3Wins37", practiceChallenge3Wins37);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech38) {
  if (challenge3Success) {
    practiceChallenge3Wins38++;
    localStorage.setItem("practiceChallenge3Wins38", practiceChallenge3Wins38);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech39) {
  if (challenge3Success) {
    practiceChallenge3Wins39++;
    localStorage.setItem("practiceChallenge3Wins39", practiceChallenge3Wins39);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}


  showCelebrationOverlay("images/fig45.png"); // gefaald afbeelding
  updateChallenge3StatusCell();
}
            updateLivesDisplay();
          } else {
            for (let i = 0; i < fallingBlock.length; i++) {
              const col = fallingBlock.x + i;
              if (col >= 0 && col < gridCols) {
                //if (fallingBlock.isDiva) showDivaImageTemporarily();
                if (fallingBlock.isSpecial) showHeartImageTemporarily();
                field[fallingBlock.y][col] = {
                    color: fallingBlock.color,
                    isSpecial: fallingBlock.isSpecial,
                    isMulticolor: fallingBlock.isMulticolor,
                    isDiva: fallingBlock.isDiva,
                    divaCountdown: fallingBlock.divaCountdown
                    };
              }
            }

  if (challenge3Active && !challenge3Failed) {
  if (challenge3Count >= challenge3Limit) {
    challenge3Success = true;
    challenge3Active = false;
    challenge3RewardGiven = true;

if (practiceModech31) {
  if (challenge3Success) {
    practiceChallenge3Wins31++;
    localStorage.setItem("practiceChallenge3Wins31", practiceChallenge3Wins31);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech32) {
  if (challenge3Success) {
    practiceChallenge3Wins32++;
    localStorage.setItem("practiceChallenge3Wins32", practiceChallenge3Wins32);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech33) {
  if (challenge3Success) {
    practiceChallenge3Wins33++;
    localStorage.setItem("practiceChallenge3Wins33", practiceChallenge3Wins33);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech34) {
  if (challenge3Success) {
    practiceChallenge3Wins34++;
    localStorage.setItem("practiceChallenge3Wins34", practiceChallenge3Wins34);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech35) {
  if (challenge3Success) {
    practiceChallenge3Wins35++;
    localStorage.setItem("practiceChallenge3Wins35", practiceChallenge3Wins35);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech36) {
  if (challenge3Success) {
    practiceChallenge3Wins36++;
    localStorage.setItem("practiceChallenge3Wins36", practiceChallenge3Wins36);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech37) {
  if (challenge3Success) {
    practiceChallenge3Wins37++;
    localStorage.setItem("practiceChallenge3Wins37", practiceChallenge3Wins37);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech38) {
  if (challenge3Success) {
    practiceChallenge3Wins38++;
    localStorage.setItem("practiceChallenge3Wins38", practiceChallenge3Wins38);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech39) {
  if (challenge3Success) {
    practiceChallenge3Wins39++;
    localStorage.setItem("practiceChallenge3Wins39", practiceChallenge3Wins39);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}




    showCelebrationOverlay("images/fig44.png");
    lives += 3;
    //score += 250;
    updateScoreDisplay();
    updateLivesDisplay();
    updateChallenge3StatusCell();
  }
}



            score += fallingBlock.length;
            updateScoreDisplay();
            updateHighStats();
           
            updateDivaCountdowns();
             checkMatches();

  if (challenge4Active && !challenge4Success) {
  const fieldBlockCount = field.flat().filter(cell => cell !== null).length;

  if (fieldBlockCount >= 50) {
    challenge4FullFieldMoments++;
  }

  if (challenge4FullFieldMoments >= 10) {
    challenge4Active = false;
    challenge4Success = true;
    challenge4RewardGiven = true;
    //score += 250;
    multicolorCount += 3;
    updateScoreDisplay();
    multicolorDisplay.textContent = multicolorCount;
    

// EXTRA: SUCCES IN PRACTICE-MODUS
if (practiceModech41) {
  practiceChallenge4Wins41++;
  localStorage.setItem("practiceChallenge4Wins41", practiceChallenge4Wins41);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech42) {
  practiceChallenge4Wins42++;
  localStorage.setItem("practiceChallenge4Wins42", practiceChallenge4Wins42);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech43) {
  practiceChallenge4Wins43++;
  localStorage.setItem("practiceChallenge4Wins43", practiceChallenge4Wins43);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech44) {
  practiceChallenge4Wins44++;
  localStorage.setItem("practiceChallenge4Wins44", practiceChallenge4Wins44);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech45) {
  practiceChallenge4Wins45++;
  localStorage.setItem("practiceChallenge4Wins45", practiceChallenge4Wins45);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech46) {
  practiceChallenge4Wins46++;
  localStorage.setItem("practiceChallenge4Wins46", practiceChallenge4Wins46);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech47) {
  practiceChallenge4Wins47++;
  localStorage.setItem("practiceChallenge4Wins47", practiceChallenge4Wins47);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech48) {
  practiceChallenge4Wins48++;
  localStorage.setItem("practiceChallenge4Wins48", practiceChallenge4Wins48);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech49) {
  practiceChallenge4Wins49++;
  localStorage.setItem("practiceChallenge4Wins49", practiceChallenge4Wins49);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
showCelebrationOverlay("images/fig44.png");

  }

  challenge4Count++;
  updateChallenge4StatusCell();

  if (challenge4Count >= challenge4Limit && !challenge4Success) {
    challenge4Active = false;
    challenge4RewardGiven = true;
    showCelebrationOverlay("images/fig45.png");
    updateChallenge4StatusCell();

if (
  practiceModech41 || practiceModech42 || practiceModech43 || practiceModech44 ||
  practiceModech45 || practiceModech46 || practiceModech47 || practiceModech48 ||
  practiceModech49
) {
  pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
  return;
}



  }
}
}

directionToggle = !directionToggle;
useVertical = false;
updateControls()

updateChallengeStatusCell();
updateChallenge2StatusCell();
updateChallenge3StatusCell();
updateChallenge4StatusCell();
updateChallenge5StatusCell();
updateChallenge6StatusCell();
updateChallenge7StatusCell();
updateLevelDisplay();
updateLevelAndBpmDisplay();

fallingBlock = createBlockH(directionToggle ? "left" : "right");         
        } else {
          fallingBlock.y = nextY;
        }
      }
      checkLevelProgression();
      updateChallenge2StatusCell();
    }

// zelfde als update maar de andere richting

function updateH() {
  if (lives <= 0) {
  //showGameOverScreen();
  return;
}

  if (fallingBlock.direction === "right") {
    // Naar rechts = stijgende x
    fallingBlock.x++;
    if (fallingBlock.x >= gridCols || blockWouldCollideH(fallingBlock)) {
      if (fallingBlock.x <= 0) { // plus 1
        lives--;

 if (lives <= 0) {
  showGameOverScreen();
  return;
}

updateLivesDisplay();
if (challenge3Active && !challenge3Failed) {
  challenge3Failed = true;
  challenge3Active = false;
  challenge3RewardGiven = true;

if (practiceModech31) {
  if (challenge3Success) {
    practiceChallenge3Wins31++;
    localStorage.setItem("practiceChallenge3Wins31", practiceChallenge3Wins31);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech32) {
  if (challenge3Success) {
    practiceChallenge3Wins32++;
    localStorage.setItem("practiceChallenge3Wins32", practiceChallenge3Wins32);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech33) {
  if (challenge3Success) {
    practiceChallenge3Wins33++;
    localStorage.setItem("practiceChallenge3Wins33", practiceChallenge3Wins33);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech34) {
  if (challenge3Success) {
    practiceChallenge3Wins34++;
    localStorage.setItem("practiceChallenge3Wins34", practiceChallenge3Wins34);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech35) {
  if (challenge3Success) {
    practiceChallenge3Wins35++;
    localStorage.setItem("practiceChallenge3Wins35", practiceChallenge3Wins35);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech36) {
  if (challenge3Success) {
    practiceChallenge3Wins36++;
    localStorage.setItem("practiceChallenge3Wins36", practiceChallenge3Wins36);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech37) {
  if (challenge3Success) {
    practiceChallenge3Wins37++;
    localStorage.setItem("practiceChallenge3Wins37", practiceChallenge3Wins37);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech38) {
  if (challenge3Success) {
    practiceChallenge3Wins38++;
    localStorage.setItem("practiceChallenge3Wins38", practiceChallenge3Wins38);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech39) {
  if (challenge3Success) {
    practiceChallenge3Wins39++;
    localStorage.setItem("practiceChallenge3Wins39", practiceChallenge3Wins39);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}



  showCelebrationOverlay("images/fig45.png"); // gefaald afbeelding
  updateChallenge3StatusCell();
}
        updateLivesDisplay();
      } else {

if (fallingBlock.isFreePicture) {
  const fx = fallingBlock.x;
  const fy = fallingBlock.y;
  const blocksToRemove = [];

  for (let dx = -1; dx <= 1; dx++) {
    for (let dy = -1; dy <= 1; dy++) {
      const nx = fx + dx;
      const ny = fy + dy;
      if (
        nx >= 0 && nx < gridCols &&
        ny >= 0 && ny < gridRows &&
        !(dx === 0 && dy === 0) &&
        field[ny][nx]
      ) {
        blocksToRemove.push([ny, nx]);
      }
    }
  }

  // Voeg elk blokje correct toe aan disappearingBlocks
  for (const [r, c] of blocksToRemove) {
    const block = field[r][c];



if (block.isSpecial) {
  heartFreed = true;
  if (challengeActive) {
    challengeHeartCount++;
    // Geen leven toevoegen tijdens challenge 1
  } else {
    lives++;
  }
}

 //   if (block.isMulticolor) {
 //     multicolorCount++;
 //     updateMulticolorDisplay();
 //     if (challenge2Active) challenge2MultiCount++;
 //   }

if (block.isMulticolor) {
  if (challenge2Active) {
    challenge2MultiCount++;
  } else {
    multicolorCount++;
    updateMulticolorDisplay();
  }
}

    disappearingBlocks.push({ r, c, scale: 1, opacity: 1 });
  }

  // Score = aantalÂ²
  const n = blocksToRemove.length;
  score += n * n;
  updateHighStats();
  updateScoreDisplay();

  fallingBlock = null;
  drawGrid();
  return;
}



        for (let i = 0; i < fallingBlock.length; i++) {
          const row = fallingBlock.y + i;
          if (row >= 0 && row < gridRows) {
            //if (fallingBlock.isDiva) showDivaImageTemporarily();
            if (fallingBlock.isSpecial) showHeartImageTemporarily();
            field[row][fallingBlock.x - 1] = {
  
  color: fallingBlock.color,
  isSpecial: fallingBlock.isSpecial,
  isMulticolor: fallingBlock.isMulticolor,
  isDiva: fallingBlock.isDiva,
  divaCountdown: fallingBlock.divaCountdown

};
          }
        }

        if (challenge3Active && !challenge3Failed) {
  if (challenge3Count >= challenge3Limit) {
    challenge3Success = true;
    challenge3Active = false;
    challenge3RewardGiven = true;

if (practiceModech31) {
  if (challenge3Success) {
    practiceChallenge3Wins31++;
    localStorage.setItem("practiceChallenge3Wins31", practiceChallenge3Wins31);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech32) {
  if (challenge3Success) {
    practiceChallenge3Wins32++;
    localStorage.setItem("practiceChallenge3Wins32", practiceChallenge3Wins32);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech33) {
  if (challenge3Success) {
    practiceChallenge3Wins33++;
    localStorage.setItem("practiceChallenge3Wins33", practiceChallenge3Wins33);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech34) {
  if (challenge3Success) {
    practiceChallenge3Wins34++;
    localStorage.setItem("practiceChallenge3Wins34", practiceChallenge3Wins34);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech35) {
  if (challenge3Success) {
    practiceChallenge3Wins35++;
    localStorage.setItem("practiceChallenge3Wins35", practiceChallenge3Wins35);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech36) {
  if (challenge3Success) {
    practiceChallenge3Wins36++;
    localStorage.setItem("practiceChallenge3Wins36", practiceChallenge3Wins36);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech37) {
  if (challenge3Success) {
    practiceChallenge3Wins37++;
    localStorage.setItem("practiceChallenge3Wins37", practiceChallenge3Wins37);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech38) {
  if (challenge3Success) {
    practiceChallenge3Wins38++;
    localStorage.setItem("practiceChallenge3Wins38", practiceChallenge3Wins38);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech39) {
  if (challenge3Success) {
    practiceChallenge3Wins39++;
    localStorage.setItem("practiceChallenge3Wins39", practiceChallenge3Wins39);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}






    showCelebrationOverlay("images/fig44.png");
    lives += 3;
    //score += 250;
    updateScoreDisplay();
    updateLivesDisplay();
    updateChallenge3StatusCell();
  }
}



        score += fallingBlock.length;
        updateScoreDisplay();
        updateHighStats();
        
        updateDivaCountdowns();
         checkMatches();
        
         if (challenge4Active && !challenge4Success) {
  const fieldBlockCount = field.flat().filter(cell => cell !== null).length;

  if (fieldBlockCount >= 50) {
    challenge4FullFieldMoments++;
  }

  if (challenge4FullFieldMoments >= 10) {
    challenge4Active = false;
    challenge4Success = true;
    challenge4RewardGiven = true;
    //score += 250;
    multicolorCount += 3;
    updateScoreDisplay();
    multicolorDisplay.textContent = multicolorCount;
    

// EXTRA: SUCCES IN PRACTICE-MODUS
if (practiceModech41) {
  practiceChallenge4Wins41++;
  localStorage.setItem("practiceChallenge4Wins41", practiceChallenge4Wins41);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech42) {
  practiceChallenge4Wins42++;
  localStorage.setItem("practiceChallenge4Wins42", practiceChallenge4Wins42);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech43) {
  practiceChallenge4Wins43++;
  localStorage.setItem("practiceChallenge4Wins43", practiceChallenge4Wins43);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech44) {
  practiceChallenge4Wins44++;
  localStorage.setItem("practiceChallenge4Wins44", practiceChallenge4Wins44);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech45) {
  practiceChallenge4Wins45++;
  localStorage.setItem("practiceChallenge4Wins45", practiceChallenge4Wins45);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech46) {
  practiceChallenge4Wins46++;
  localStorage.setItem("practiceChallenge4Wins46", practiceChallenge4Wins46);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech47) {
  practiceChallenge4Wins47++;
  localStorage.setItem("practiceChallenge4Wins47", practiceChallenge4Wins47);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech48) {
  practiceChallenge4Wins48++;
  localStorage.setItem("practiceChallenge4Wins48", practiceChallenge4Wins48);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech49) {
  practiceChallenge4Wins49++;
  localStorage.setItem("practiceChallenge4Wins49", practiceChallenge4Wins49);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}

showCelebrationOverlay("images/fig44.png");

  }

  challenge4Count++;
  updateChallenge4StatusCell();

  if (challenge4Count >= challenge4Limit && !challenge4Success) {
    challenge4Active = false;
    challenge4RewardGiven = true;
    showCelebrationOverlay("images/fig45.png");
    updateChallenge4StatusCell();

if (
  practiceModech41 || practiceModech42 || practiceModech43 || practiceModech44 ||
  practiceModech45 || practiceModech46 || practiceModech47 || practiceModech48 ||
  practiceModech49
) {
  pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
  return;
}



  }
}


      }
      directionToggle = !directionToggle;
      //fallingBlock = createBlockH(directionToggle ? "right" : "left");
      useVertical = true;
      updateControls()

updateChallengeStatusCell();
updateChallenge2StatusCell();
updateChallenge3StatusCell();
updateChallenge4StatusCell();
updateChallenge5StatusCell();
updateChallenge6StatusCell();
updateChallenge7StatusCell();
updateLevelDisplay();
updateLevelAndBpmDisplay();

      fallingBlock = createBlock(directionToggle ? "down" : "up");
    }

  } else {
    // Naar links = dalende x
    const nextX = fallingBlock.x - 1;
    if (nextX < 0 || blockWouldCollideH({ ...fallingBlock, x: nextX })) {
      if (fallingBlock.x >= gridCols) { // min 1 bij falling - terug weg bij gridcols
        lives--;

 if (lives <= 0) {
  showGameOverScreen();
  return;
}

updateLivesDisplay();
if (challenge3Active && !challenge3Failed) {
  challenge3Failed = true;
  challenge3Active = false;
  challenge23RewardGiven = true;

if (practiceModech31) {
  if (challenge3Success) {
    practiceChallenge3Wins31++;
    localStorage.setItem("practiceChallenge3Wins31", practiceChallenge3Wins31);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech32) {
  if (challenge3Success) {
    practiceChallenge3Wins32++;
    localStorage.setItem("practiceChallenge3Wins32", practiceChallenge3Wins32);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech33) {
  if (challenge3Success) {
    practiceChallenge3Wins33++;
    localStorage.setItem("practiceChallenge3Wins33", practiceChallenge3Wins33);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech34) {
  if (challenge3Success) {
    practiceChallenge3Wins34++;
    localStorage.setItem("practiceChallenge3Wins34", practiceChallenge3Wins34);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech35) {
  if (challenge3Success) {
    practiceChallenge3Wins35++;
    localStorage.setItem("practiceChallenge3Wins35", practiceChallenge3Wins35);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech36) {
  if (challenge3Success) {
    practiceChallenge3Wins36++;
    localStorage.setItem("practiceChallenge3Wins36", practiceChallenge3Wins36);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech37) {
  if (challenge3Success) {
    practiceChallenge3Wins37++;
    localStorage.setItem("practiceChallenge3Wins37", practiceChallenge3Wins37);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech38) {
  if (challenge3Success) {
    practiceChallenge3Wins38++;
    localStorage.setItem("practiceChallenge3Wins38", practiceChallenge3Wins38);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech39) {
  if (challenge3Success) {
    practiceChallenge3Wins39++;
    localStorage.setItem("practiceChallenge3Wins39", practiceChallenge3Wins39);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}






  showCelebrationOverlay("images/fig45.png"); // gefaald afbeelding
  updateChallenge3StatusCell();
}
        updateLivesDisplay();
      } else {
        for (let i = 0; i < fallingBlock.length; i++) {
          const row = fallingBlock.y + i;
          if (row >= 0 && row < gridRows) {
            //if (fallingBlock.isDiva) showDivaImageTemporarily();  // âœ… bij rechts
            if (fallingBlock.isSpecial) showHeartImageTemporarily();
            field[row][fallingBlock.x] = {
               

  color: fallingBlock.color,
  isSpecial: fallingBlock.isSpecial,
  isMulticolor: fallingBlock.isMulticolor,
  isDiva: fallingBlock.isDiva,
  divaCountdown: fallingBlock.divaCountdown

};
          }
        }
        if (challenge3Active && !challenge3Failed) {
  if (challenge3Count >= challenge3Limit) {
    challenge3Success = true;
    challenge3Active = false;
    challenge3RewardGiven = true;

if (practiceModech31) {
  if (challenge3Success) {
    practiceChallenge3Wins31++;
    localStorage.setItem("practiceChallenge3Wins31", practiceChallenge3Wins31);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech32) {
  if (challenge3Success) {
    practiceChallenge3Wins32++;
    localStorage.setItem("practiceChallenge3Wins32", practiceChallenge3Wins32);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech33) {
  if (challenge3Success) {
    practiceChallenge3Wins33++;
    localStorage.setItem("practiceChallenge3Wins33", practiceChallenge3Wins33);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech34) {
  if (challenge3Success) {
    practiceChallenge3Wins34++;
    localStorage.setItem("practiceChallenge3Wins34", practiceChallenge3Wins34);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech35) {
  if (challenge3Success) {
    practiceChallenge3Wins35++;
    localStorage.setItem("practiceChallenge3Wins35", practiceChallenge3Wins35);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech36) {
  if (challenge3Success) {
    practiceChallenge3Wins36++;
    localStorage.setItem("practiceChallenge3Wins36", practiceChallenge3Wins36);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech37) {
  if (challenge3Success) {
    practiceChallenge3Wins37++;
    localStorage.setItem("practiceChallenge3Wins37", practiceChallenge3Wins37);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech38) {
  if (challenge3Success) {
    practiceChallenge3Wins38++;
    localStorage.setItem("practiceChallenge3Wins38", practiceChallenge3Wins38);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}

if (practiceModech39) {
  if (challenge3Success) {
    practiceChallenge3Wins39++;
    localStorage.setItem("practiceChallenge3Wins39", practiceChallenge3Wins39);
    updatePracticeCellTeller();
    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
    return;
  } else if (challenge3Failed) {
    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
    return;
  }
}





    showCelebrationOverlay("images/fig44.png");
    lives += 3;
    //score += 250;
    updateScoreDisplay();
    updateLivesDisplay();
    updateChallenge3StatusCell();
  }
}



        score += fallingBlock.length;
        updateScoreDisplay();
        updateHighStats();
        
        updateDivaCountdowns();
        checkMatches();
        
        if (challenge4Active && !challenge4Success) {
  const fieldBlockCount = field.flat().filter(cell => cell !== null).length;

  if (fieldBlockCount >= 50) {
    challenge4FullFieldMoments++;
  }

  if (challenge4FullFieldMoments >= 10) {
    challenge4Active = false;
    challenge4Success = true;
    challenge4RewardGiven = true;
    //score += 250;
    multicolorCount += 3;
    updateScoreDisplay();
    multicolorDisplay.textContent = multicolorCount;
   

// EXTRA: SUCCES IN PRACTICE-MODUS
if (practiceModech41) {
  practiceChallenge4Wins41++;
  localStorage.setItem("practiceChallenge4Wins41", practiceChallenge4Wins41);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech42) {
  practiceChallenge4Wins42++;
  localStorage.setItem("practiceChallenge4Wins42", practiceChallenge4Wins42);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech43) {
  practiceChallenge4Wins43++;
  localStorage.setItem("practiceChallenge4Wins43", practiceChallenge4Wins43);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech44) {
  practiceChallenge4Wins44++;
  localStorage.setItem("practiceChallenge4Wins44", practiceChallenge4Wins44);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech45) {
  practiceChallenge4Wins45++;
  localStorage.setItem("practiceChallenge4Wins45", practiceChallenge4Wins45);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech46) {
  practiceChallenge4Wins46++;
  localStorage.setItem("practiceChallenge4Wins46", practiceChallenge4Wins46);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech47) {
  practiceChallenge4Wins47++;
  localStorage.setItem("practiceChallenge4Wins47", practiceChallenge4Wins47);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech48) {
  practiceChallenge4Wins48++;
  localStorage.setItem("practiceChallenge4Wins48", practiceChallenge4Wins48);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech49) {
  practiceChallenge4Wins49++;
  localStorage.setItem("practiceChallenge4Wins49", practiceChallenge4Wins49);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
 showCelebrationOverlay("images/fig44.png");

  }

  challenge4Count++;
  updateChallenge4StatusCell();

  if (challenge4Count >= challenge4Limit && !challenge4Success) {
    challenge4Active = false;
    challenge4RewardGiven = true;
    showCelebrationOverlay("images/fig45.png");
    updateChallenge4StatusCell();

if (
  practiceModech41 || practiceModech42 || practiceModech43 || practiceModech44 ||
  practiceModech45 || practiceModech46 || practiceModech47 || practiceModech48 ||
  practiceModech49
) {
  pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
  return;
}


  }
}


      }
      directionToggle = !directionToggle;
      //fallingBlock = createBlockH(directionToggle ? "right" : "left");
      useVertical = true;
      updateControls()
updateChallengeStatusCell();
updateChallenge2StatusCell();
updateChallenge3StatusCell();
updateChallenge4StatusCell();
updateChallenge5StatusCell();
updateChallenge6StatusCell();
updateChallenge7StatusCell();
updateLevelDisplay();
updateLevelAndBpmDisplay();
      fallingBlock = createBlock(directionToggle ? "up" : "down");
    } else {
      fallingBlock.x = nextX;
    }
  }
  checkLevelProgression();
  updateChallenge2StatusCell();
}

//blockcollide - check of blok al tegen ander is gekomen

    function blockWouldCollide(block) {
      const yCheck = block.y;
      if (yCheck < 0 || yCheck >= gridRows) return false;
      for (let i = 0; i < block.length; i++) {
        const col = block.x + i;
        if (col < 0 || col >= gridCols || field[yCheck][col] !== null) return true;
      }
      return false;
    }

    function blockWouldCollideH(block) {
  const xCheck = block.x;
  if (xCheck < 0 || xCheck >= gridCols) return false;
  for (let i = 0; i < block.length; i++) {
  const row = block.y + i;
  if (row < 0 || row >= gridRows || field[row][xCheck]!== null) return true;
}
  return false;
}
///////////////////////////////////////////////////////////////////////////// 

// wordt niet gebruikt !!! - het is showcelebrationoverlay die w gebruikt overal

function showCelebration(lastCell) {
  // Voeg een pop-effect toe voor de geselecteerde blokken
  tutorialInProgress = false;
  const [r, c] = lastCell; // Haal de rij en kolom op uit lastCell

  const cell = document.getElementById(`cell-${r}-${c}`);
  if (cell) {
    cell.classList.add("pop");
    setTimeout(() => cell.classList.remove("pop"), 2000); // effect verdwijnt na 2 sec
  }

  // Voeg het plaatje toe in de juiste positie binnen het raster
  const img = document.createElement("img");
  img.src = "images/fig54.png";  // De afbeelding die je wilt tonen
  img.alt = "Celebration Image";  // Alt-tekst voor de afbeelding
  img.className = "celebration-image";  // Je kunt een klasse gebruiken voor styling als dat nodig is

  // Verkrijg de positie van het laatste blokje
  const x = (c + 10 + gridOffsetX) * blockSize;
  const y = (r - gridOffsetY) * blockSize;

  // Positioneer de afbeelding op basis van de cel
  img.style.left = `${x + window.scrollX}px`;  // X-coÃ¶rdinaat van de cel
  img.style.top = `${y + window.scrollY}px`;  // Y-coÃ¶rdinaat van de cel

  // Stel de grootte van de afbeelding in om overeen te komen met 10x10 blokjes
  img.style.width = `${10 * blockSize}px`;  // 10 blokjes breed
  img.style.height = `${10 * blockSize}px`; // 10 blokjes hoog

  // Voeg de afbeelding toe aan de pagina
  document.body.appendChild(img);

  // Verwijder de afbeelding na 2 seconden
  setTimeout(() => {
    img.remove();
  }, 2000); // Verdwijnt na 2 seconden
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function isOneBeforeChallengeStart(level) {
  return (
    level === challenge2Level - 1 ||
    level === challenge3Level - 1 ||
    level === challenge4Level - 1 ||
    level === challenge5StartLevel - 1 ||
    level === challenge6Level - 1 ||
    level === challenge7Level - 1
  );
}

// nakijken of er 5 van zelfde kleur aan elkaar plakken

function checkMatches() {
  let toRemove = [];
  const visited = Array.from({ length: gridRows }, () => Array(gridCols).fill(false));

  function dfs(r, c, color, group) {
    if (
      r < 0 || r >= gridRows ||
      c < 0 || c >= gridCols ||
      visited[r][c] ||
      !field[r][c] ||
      field[r][c].isDiva
    ) return;

    const block = field[r][c];

    const isMatch = block.color === color;

    if (!isMatch) return;

    visited[r][c] = true;
    group.push([r, c]);

    dfs(r + 1, c, color, group);
    dfs(r - 1, c, color, group);
    dfs(r, c + 1, color, group);
    dfs(r, c - 1, color, group);
  }


// Witte blokjes: verwijder alles wat eraan grenst, ongeacht kleur
for (let r = 0; r < gridRows; r++) {
  for (let c = 0; c < gridCols; c++) {
    const block = field[r][c];
    if (!block || block.color !== "#FFFFFF") continue;

    const directions = [
      [0, -1], [1, 0], [0, 1], [-1, 0], // boven, rechts, onder, links
      [-1, -1], [1, -1], [1, 1], [-1, 1] // diagonaal
    ];

    for (let [dx, dy] of directions) {
      const nr = r + dy;
      const nc = c + dx;
      if (
        nr >= 0 && nr < gridRows &&
        nc >= 0 && nc < gridCols &&
        field[nr][nc]
      ) {
        toRemove.push([nr, nc]);
      }
    }

    // ook de witte zelf verwijderen
    toRemove.push([r, c]);
  }
}



  for (let r = 0; r < gridRows; r++) {
    for (let c = 0; c < gridCols; c++) {
      if (visited[r][c] || !field[r][c] || field[r][c].isDiva) continue;

      const block = field[r][c];

      // âŒ Sla witte blokjes over als startpunt - mag allicht weg want gebruik ik niet meer
      if (block.color === "#FFFFFF") continue;

      const group = [];
      dfs(r, c, block.color, group);

      if (group.length >= 5) {
        toRemove.push(...group);

        // bij eerste verdwijning in level 2 ga je naar level 3
        if (level === 2 && !level2ImageShown) {
        showLevel2CelebrationImage();
        level2ImageShown = true;
         }

         // beeld onderaan
        temporarilyChangeResetImage(block.color);
        score += group.length * group.length;
        updateScoreDisplay();
        updateHighStats();

if (challenge6Active && group.length >= 6) {
  challenge6SixGroupCount++;
  updateChallenge6StatusCell();
  if (challenge6SixGroupCount >= 10) {
    endChallenge6(true);
  }
}

if (challenge7Active && group.length >= 5) {
  challenge7GroupCount++;
  updateChallenge7StatusCell();
  if (challenge7GroupCount >= challenge7TargetGroups) {
    endChallenge7(true);
  }
}

        bigGroupCount++; // Tel dit als een "grote groep" om level te verhogen
        updateLevelProgressBar();

// aanpassen
if (bigGroupCount >= levelProgressThreshold) {
  if (
    level >= 10 &&
    (!isAnyChallengeActive() || !isOneBeforeChallengeStart(level))
  ) {
    level++;
    updateLevelAndBpmDisplay();
    pauseUsesLeft++;
    updatePauseDisplay();
    updateLevelDisplay();
  }
  bigGroupCount = 0;

  // dit zou een fout moeten geven - als bij level 4 een blokjes verdwijnen
 // if (level === 4) {
 //   showLevel4CelebrationImage();
  //  return;
  //}
}
        updateScoreDisplay();
      }
    }
  }

  for (let [r, c] of toRemove) {
    const block = field[r][c];
    if (!block) continue;
    if (block.isDiva && block.divaCountdown > 0) continue;
   

   if (block.isSpecial) {
  if (!preventHeartReward) {
    lives++;
    updateLivesDisplay();
    showHeartImageTemporarily();
  }
  heartFreed = true;
  if (challengeActive) {
    challengeHeartCount++;
  }
}

if (block.isMulticolor) {
  if (challenge2Active) {
    challenge2MultiCount++;
    challenge2PendingMulticolors++;
  } else {
    multicolorCount++;
    multicolorDisplay.textContent = multicolorCount;
  }
}


    disappearingBlocks.push({ r, c, scale: 1, opacity: 1 });
  }
}



// drawgrid

function drawGrid() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const totalRows = extraRowsAbove + gridRows + extraRowsBelow;

  const validColors = ["#4A90E2", "#7ED321", "#F8E71C", "#DEDEDE", "#9B51E0", "#50E3C2", "#FF6F61", "#FFFFFF"];

  // getgroupsize --> nodig om later juiste gezichtje te tekenen op blokje !!
  function getGroupSize(r, c, color) {
    const visited = Array.from({ length: gridRows }, () => Array(gridCols).fill(false));
    let group = [];

    function dfs(row, col) {

      if (
        row < 0 ||
        row >= gridRows ||
        col < 0 ||
        col >= gridCols ||
        visited[row][col] ||
        field[row][col] === null ||
        field[row][col].color !== color ||
  field[row][col].isDiva
      ) {
        return;
      }

      visited[row][col] = true;
      group.push([row, col]);

      dfs(row + 1, col);
      dfs(row - 1, col);
      dfs(row, col + 1);
      dfs(row, col - 1);
    }

    dfs(r, c);
    return group.length;
  }
// einde getgroupsize

  ctx.fillStyle = "#c9a878"; // Kies een bijpassende kleur zoals in je afbeelding
ctx.fillRect(
  (10 + gridOffsetX) * blockSize+20, // linkerkant van het 10x10 blok
  (extraRowsAbove - gridOffsetY) * blockSize+20, // bovenkant van het 10x10 blok
  gridCols * blockSize, // breedte van 10 blokken
  gridRows * blockSize  // hoogte van 10 blokken
);

  for (let r = 0; r < totalRows; r++) {
    for (let c = 0; c < gridCols; c++) {
      const x = (c + 10 + gridOffsetX) * blockSize+20;
      const y = (r - gridOffsetY) * blockSize+20;

      if (r >= extraRowsAbove && r < extraRowsAbove + gridRows) {
//        ctx.strokeStyle = "#FFE680";
        
    //ctx.strokeStyle = "#e88a2d";
      //  ctx.lineWidth = 0;
       // ctx.beginPath();
       // ctx.moveTo(x + 10, y);
       // ctx.arcTo(x + blockSize, y, x + blockSize, y + blockSize, 12);
       // ctx.arcTo(x + blockSize, y + blockSize, x, y + blockSize, 12);
       // ctx.arcTo(x, y + blockSize, x, y, 12);
       // ctx.arcTo(x, y, x + 10, y, 12);
       // ctx.closePath();
       // ctx.stroke();




        const fieldRow = r - extraRowsAbove;
        let color = field[fieldRow][c] ? field[fieldRow][c].color : null;

        if (color && validColors.includes(color)) {
          let disappearing = disappearingBlocks.find(b => b.r === fieldRow && b.c === c);
          let scale = 1;
          let opacity = 1;

          if (disappearing) {
            scale = disappearing.scale;
            opacity = disappearing.opacity;
            disappearing.scale += 0.6;

            if (disappearing.scale >= 3) {
              field[fieldRow][c] = null;
              disappearingBlocks = disappearingBlocks.filter(b => !(b.r === fieldRow && b.c === c));
              continue;
            }
          }

          ctx.save();
          ctx.globalAlpha = opacity;
          ctx.translate(x + blockSize / 2, y + blockSize / 2);
          ctx.rotate(disappearing ? disappearing.rotation : 0);
          ctx.scale(scale, scale);
          ctx.translate(-(x + blockSize / 2), -(y + blockSize / 2));

          ctx.beginPath();
          ctx.moveTo(x + 10, y);
          ctx.arcTo(x + blockSize, y, x + blockSize, y + blockSize, 12);
          ctx.arcTo(x + blockSize, y + blockSize, x, y + blockSize, 12);
          ctx.arcTo(x, y + blockSize, x, y, 12);
          ctx.arcTo(x, y, x + 10, y, 12);
          ctx.closePath();

          ctx.strokeStyle = "white";
          ctx.lineWidth = 0;
          ctx.stroke();

          ctx.fillStyle = color;
          ctx.fill();

          // 3D-effect: lichte glans bovenaan - schaduw
          const lightGradient = ctx.createLinearGradient(x, y, x, y + blockSize * 0.4);
          lightGradient.addColorStop(0, "rgba(255,255,255,0.05)");
          lightGradient.addColorStop(1, "rgba(255,255,255,0)");
          ctx.fillStyle = lightGradient;
          ctx.fill();

          // 3D-effect: donkere schaduw onderaan - schaduw
          const shadowGradient = ctx.createLinearGradient(x, y + blockSize * 0.6, x, y + blockSize);
          shadowGradient.addColorStop(0, "rgba(0,0,0,0)");
          shadowGradient.addColorStop(1, "rgba(0,0,0,0.05)");
          ctx.fillStyle = shadowGradient;
          ctx.fill();

          const groupSize = getGroupSize(fieldRow, c, color);
          const blockData = field[fieldRow][c];

  // specifieciteiten diva
  if (blockData.isDiva && blockData.divaCountdown) {
  const offsetY = blockSize * 0.08;

  ctx.font = `bold ${blockSize * 0.8}px 'Baloo Bhaina 2', sans-serif`;
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";

  ctx.lineWidth = 4;
  ctx.strokeStyle = "black";
  ctx.strokeText(blockData.divaCountdown, x + blockSize / 2, y + blockSize / 2 + offsetY);

  ctx.fillStyle = "white";
  ctx.fillText(blockData.divaCountdown, x + blockSize / 2, y + blockSize / 2 + offsetY);

  ctx.restore();  // â† RESTORE toevoegen vÃ³Ã³r je break
  continue;
}

let imageToUse = null;

//if (blockData.isSpecial) {
//  imageToUse = specialImage; // beeld van hartje
//} else if (blockData.isMulticolor) {
//  imageToUse = multicolorImage; // beeld van multicolor
//} else {
//  imageToUse = images[Math.min(groupSize - 1, 4)];
//}

const index = Math.min(groupSize - 1, 4);
const altColors = ["#9B51E0", "#4A90E2", "#FF6F61"];

if (blockData.isSpecial) {
  imageToUse = specialImage; // beeld van hartje
} else if (blockData.isMulticolor) {
  imageToUse = multicolorImage2; // beeld van multicolor
} else if (blockData.color === "#FFFFFF") {
  imageToUse = freePictureIcon2; // afbeelding voor wit blokje
} else if (altColors.includes(blockData.color)) {
  imageToUse = altImages[index];
} else {
  imageToUse = images[index];
}

if (imageToUse) {
  const imgSize = blockSize * 0.9;
  ctx.drawImage(
    imageToUse,
    x + (blockSize - imgSize) / 2,
    y + (blockSize - imgSize) / 2,
    imgSize,
    imgSize
  );
}




          ctx.restore();
        }
      } else {
        ctx.fillStyle = "rgba(0, 0, 0, 0)";
        ctx.fillRect(x, y, blockSize, blockSize);
      }
    }
  }

  //const gridX = (10 + gridOffsetX) * blockSize;
  //const gridY = (extraRowsAbove - gridOffsetY) * blockSize; // <-- aangepaste lij
  
  const gridX = (20 + (10+gridOffsetX) * blockSize);
const gridY = (20 + (extraRowsAbove - gridOffsetY) * blockSize);
  
const gridWidth = gridCols * blockSize;
const gridHeight = gridRows * blockSize;

//const borderColor = '#FFE680'; // Gele lijnen
//const fillColor = '#FFE680';   // Oranje vulling
const borderColor = '#e88a2d'; // Gele lijnen
const fillColor = '#e88a2d';   // Oranje vulling


const outerPadding = 5;
const innerPadding = 20;

ctx.save();

// ğŸ”¸ Teken de gevulde ring tussen de twee randen
ctx.beginPath();

// Buitenste pad
ctx.moveTo(gridX - outerPadding, gridY - outerPadding);
ctx.arcTo(gridX + gridWidth + outerPadding, gridY - outerPadding, gridX + gridWidth + outerPadding, gridY + gridHeight + outerPadding, 0);
ctx.arcTo(gridX + gridWidth + outerPadding, gridY + gridHeight + outerPadding, gridX - outerPadding, gridY + gridHeight + outerPadding, 0);
ctx.arcTo(gridX - outerPadding, gridY + gridHeight + outerPadding, gridX - outerPadding, gridY - outerPadding, 0);
ctx.arcTo(gridX - outerPadding, gridY - outerPadding, gridX - outerPadding + 1, gridY - outerPadding, 0); // laatste bocht
ctx.closePath();

// Binnenste pad
ctx.moveTo(gridX - innerPadding, gridY - innerPadding);
ctx.arcTo(gridX + gridWidth + innerPadding, gridY - innerPadding, gridX + gridWidth + innerPadding, gridY + gridHeight + innerPadding, 0);
ctx.arcTo(gridX + gridWidth + innerPadding, gridY + gridHeight + innerPadding, gridX - innerPadding, gridY + gridHeight + innerPadding, 0);
ctx.arcTo(gridX - innerPadding, gridY + gridHeight + innerPadding, gridX - innerPadding, gridY - innerPadding, 0);
ctx.arcTo(gridX - innerPadding, gridY - innerPadding, gridX - innerPadding, gridY - innerPadding, 0);
ctx.closePath();

// Vulling tussen binnen- en buitenrand
ctx.fillStyle = fillColor;
ctx.fill("evenodd");

// ğŸ”¸ Teken de twee randen erbovenop
// Buitenrand
// Buitenrand ZONDER bovenlijn
ctx.lineWidth = 0;
ctx.strokeStyle = borderColor;
ctx.beginPath();
ctx.moveTo(gridX + gridWidth + outerPadding, gridY - outerPadding); // begin rechtsboven
ctx.arcTo(gridX + gridWidth + outerPadding, gridY + gridHeight + outerPadding, gridX - outerPadding, gridY + gridHeight + outerPadding, 12); // rechts â†’ onder
ctx.arcTo(gridX - outerPadding, gridY + gridHeight + outerPadding, gridX - outerPadding, gridY - outerPadding, 12); // onder â†’ links
ctx.arcTo(gridX - outerPadding, gridY - outerPadding, gridX - outerPadding + 1, gridY - outerPadding, 12); // links â†’ net niet boven
ctx.stroke(); // GEEN closePath â†’ geen bovenlijn
// Binnenrand
ctx.lineWidth = 0;
ctx.beginPath();
ctx.moveTo(gridX - innerPadding, gridY - innerPadding);
ctx.arcTo(gridX + gridWidth + innerPadding, gridY - innerPadding, gridX + gridWidth + innerPadding, gridY + gridHeight + innerPadding, 12);
ctx.arcTo(gridX + gridWidth + innerPadding, gridY + gridHeight + innerPadding, gridX - innerPadding, gridY + gridHeight + innerPadding, 12);
ctx.arcTo(gridX - innerPadding, gridY + gridHeight + innerPadding, gridX - innerPadding, gridY - innerPadding, 12);
ctx.arcTo(gridX - innerPadding, gridY - innerPadding, gridX - innerPadding + 1, gridY - innerPadding, 12);
ctx.closePath();
ctx.stroke();

ctx.restore();

}


// tekenen van blokje terwijl het valt (dus zonder raster en nog niet geland)

function drawFallingBlock() {
  const { x, y, color, length } = fallingBlock;
  const visibleTop = -extraRowsAbove;
  const visibleBottom = gridRows + extraRowsBelow;

  if (y >= visibleTop && y < visibleBottom) {
    for (let i = 0; i < length; i++) {
      const drawX = useVertical
        ? (x + i + 10 + gridOffsetX) * blockSize+20
        : (x + 10 + gridOffsetX) * blockSize+20;
      const drawY = useVertical
        ? (y + extraRowsAbove - gridOffsetY) * blockSize+20
        : (y + i + extraRowsAbove - gridOffsetY) * blockSize+20;

      // hoofdvlak
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.moveTo(drawX + 10, drawY);
      ctx.arcTo(drawX + blockSize, drawY, drawX + blockSize, drawY + blockSize, 12);
      ctx.arcTo(drawX + blockSize, drawY + blockSize, drawX, drawY + blockSize, 12);
      ctx.arcTo(drawX, drawY + blockSize, drawX, drawY, 12);
      ctx.arcTo(drawX, drawY, drawX + blockSize, drawY, 12);
      ctx.closePath();
      ctx.fill();

      // lichte glans bovenaan
      const lightGradient = ctx.createLinearGradient(drawX, drawY, drawX, drawY + blockSize * 0.4);
      lightGradient.addColorStop(0, "rgba(255,255,255,0.05)");
      lightGradient.addColorStop(1, "rgba(255,255,255,0)");
      ctx.fillStyle = lightGradient;
      ctx.fill();

      // donkere schaduw onderaan
      const shadowGradient = ctx.createLinearGradient(drawX, drawY + blockSize * 0.6, drawX, drawY + blockSize);
      shadowGradient.addColorStop(0, "rgba(0,0,0,0)");
      shadowGradient.addColorStop(1, "rgba(0,0,0,0.05)");
      ctx.fillStyle = shadowGradient;
      ctx.fill();
      ctx.restore(); // <-- DIT HIER, VOOR je een afbeelding of tekst tekent
      // emoji of afbeelding

    // Vraagteken i.p.v. afbeelding bij vallende blokken
const offsetY = blockSize * 0.08;
ctx.font = `bold ${blockSize * 0.8}px 'Baloo Bhaina 2', sans-serif`;
ctx.textAlign = "center";
ctx.textBaseline = "middle";


 // const text = fallingBlock.isDiva ? "9" : "?";

let text = "?";
if (fallingBlock.isDiva) {
  text = challenge5Active ? "29" : "9";
} else if (fallingBlock.color === "#FFFFFF") {
  text = "";
}


if (fallingBlock.color === "#FFFFFF") {
  ctx.drawImage(freePictureIcon, drawX + blockSize * 0.1, drawY + blockSize * 0.1, blockSize * 0.8, blockSize * 0.8);
}

  ctx.lineWidth = 4;
  ctx.strokeStyle = "black";
  ctx.strokeText(text, drawX + blockSize / 2, drawY + blockSize / 2 + offsetY);

  ctx.fillStyle = "white";
  ctx.fillText(text, drawX + blockSize / 2, drawY + blockSize / 2 + offsetY);


      // optionele witte rand
      ctx.strokeStyle = "white";
      ctx.lineWidth = 2;
      ctx.stroke();
    }
  }
}


// de juiste knoppen oneraan selecteren bij wissel

 function updateControls() {
  const verticalControls = document.querySelector('.vertical-controls');
  const horizontalControls = document.querySelector('.horizontal-controls');

  if (useVertical) {
    verticalControls.style.display = 'none';
    horizontalControls.style.display = 'flex';
  } else {
    verticalControls.style.display = 'flex';
    horizontalControls.style.display = 'none';
  }
}


// deze functie wordt elke x tijd herhaalt

    function gameLoop() {
        if (gamePaused) {
        return; // Doe niks als het spel gepauzeerd is
        }
    // toon de juiste 2 pijlen
        if (useVertical) {
    document.addEventListener('DOMContentLoaded', updateControls);
    update();
    drawGrid();
    drawFallingBlock();
  } else {
    // toon de juiste 2 pijlen
    document.addEventListener('DOMContentLoaded', updateControls);
    updateH();
    drawGrid();
    drawFallingBlock();
  }

updateFallSpeedDisplay();
 updateHighStats();
// snelheid veranderen als alle levels gedaan
//aanpassen

if (
 challenge1Success  &&
  challenge2Success &&
  challenge3Success 
   &&
  challenge4Success &&
  challenge5Success 
  &&
  challenge6Success &&
  challenge7Success
) {



// Algemene reset
challengeActive = false;
challengeLocked = false;

// Challenge 1
challenge1Done = false;
challengeHeartCount = 0;
challengeHeartOverrideCounter = 0;
preventHeartReward = false;
challengeBlockCounter = 0;
challengeRewardGiven = false;
challenge1Success = false;

// Challenge 2
challenge2Active = false;
challenge2Done = false;
challenge2MultiCount = 0;
challenge2BlockCounter = 0;
challenge2RewardGiven = false;
challenge2SuccessImageShown = false;
challenge2PendingMulticolors = 0;
challenge2Success = false;

// Challenge 3
challenge3Active = false;
challenge3Started = false;
challenge3Done = false;
challenge3Failed = false;
challenge3Success = false;
challenge3Count = 0;
challenge3RewardGiven = false;

// Challenge 4
challenge4Active = false;
challenge4Done = false;
challenge4Count = 0;
challenge4FullFieldMoments = 0;
challenge4Success = false;
challenge4RewardGiven = false;

// Challenge 5
challenge5Active = false;
challenge5Done = false;
challenge5Success = false;
challenge5BlockCounter = 0;
challenge5StartImageShown = false;
challenge5SuccessImageShown = false;
challenge5Started = false;
challenge5RewardGiven = false;

// Challenge 6
challenge6Active = false;
challenge6Done = false;
challenge6Success = false;
challenge6BlockCounter = 0;
challenge6SixGroupCount = 0;
challenge6RewardGiven = false;

// Challenge 7
challenge7Active = false;
challenge7Done = false;
challenge7Success = false;
challenge7BlockCount = 0;
challenge7GroupCount = 0;
challenge7RewardGiven = false;



  // Snelheid 10% verhogen (dus fallSpeed verlagen met 10%) - aanpassen
  fallSpeed = Math.max(50, Math.floor(fallSpeed * 0.95));
  clearInterval(fallInterval);
  fallInterval = setInterval(gameLoop, fallSpeed);
  round++;
  updateLevelAndBpmDisplay()
  updateHighStats();
 fallSpeedBeforeChallenge7 = fallSpeed;
  updateFallSpeedDisplay();

  // Level terug naar 10
  level = 10;
  updateLevelDisplay();

    
  // Reset alle challenge-successvariabelen
  challenge1Success = false;
  challenge2Success = false;
  challenge3Success = false;
  challenge4Success = false;
  challenge5Success = false;
  challenge6Success = false;
  challenge7Success = false;

updateChallengeStatusCell();
updateChallenge2StatusCell();
updateChallenge3StatusCell();
updateChallenge4StatusCell();
updateChallenge5StatusCell();
updateChallenge6StatusCell();
updateChallenge7StatusCell();
updateLevelDisplay();
updateLevelAndBpmDisplay();

  // Optioneel: melding
  console.log("Alle challenges gehaald! Level = 10, snelheid verhoogd.");
}


}
//setInterval(gameLoop, 300);


    updateLivesDisplay();
    updateScoreDisplay();

nextBlockIsFreePicture = false;

document.getElementById("freePictureDisplay").addEventListener("click", () => {
   if (challengeActive) {
    showCelebrationOverlay("images/fig55.png", 1600); // waarschuwing voor Challenge 1
    return;
  }

  if (challenge2Active) {
    showCelebrationOverlay("images/fig55.png", 1600); // waarschuwing voor Challenge 2
    return;
  } 
 if (freePictureCount > 0 && !nextBlockIsFreePicture && !gamePaused) {
    freePictureCount--;
    updateFreePictureDisplay();

    nextBlockIsFreePicture = true;
    nextBlock = {
      color: "#FFFFFF",
      length: 1,
      isSpecial: false,
      isMulticolor: false,
      isFreePicture: true,
      isDiva: false,
      divaCountdown: null
    };
    nextBlockIsFreePicture = false;
  updateNextBlockDisplay(nextBlock.color, nextBlock.length, nextBlock.isDiva);
      // ğŸ†• uitleg tonen
    showCelebrationOverlay("images/fig56.png", 1600); 
  }
});

// is om multicolor in te zetten maar zou logischer zijn om dat anders te coderen
document.getElementById("multicolorDisplay").addEventListener("click", () => {
  
    if (challengeActive) {
    showCelebrationOverlay("images/fig57.png", 1600); // waarschuwing voor Challenge 1
    return;
  }

  if (challenge2Active) {
    showCelebrationOverlay("images/fig57.png", 1600); // waarschuwing voor Challenge 2
    return;
  }

  if (multicolorCount > 0 && !nextBlockIsMulticolor && !gamePaused) {
    multicolorCount--;
    multicolorDisplay.textContent = multicolorCount;

    showColorChoice((selectedColor) => {
      nextBlock = {
        color: selectedColor,
        length: 1,
        isSpecial: false,
        isMulticolor: true,
        isDiva: false,
        divaCountdown: null
      };
      updateNextBlockDisplay(nextBlock.color, nextBlock.length, nextBlock.isDiva);
    });
  }
});




// getoond na level 2 (niet chall 2)

function showLevel2CelebrationImage() {
  const tutorialOverlay = document.getElementById("tutorialOverlay");
  const tutorialImage = document.getElementById("tutorialImage");
  const tutorialNextButton = document.getElementById("tutorialNextButton");
// kleuren gaan beginnen
  tutorialImage.src = "images/fig58.png";
  tutorialOverlay.style.display = "flex";
  tutorialNextButton.style.display = "block";
  gamePaused = true;

  const handleClose = () => {
    tutorialOverlay.style.display = "none";
    gamePaused = false;
    level = 3;
    updateScoreDisplay();
    level2ImageShown = true;

    tutorialNextButton.removeEventListener("click", handleClose);
  };

  tutorialNextButton.removeEventListener("click", tutorialNextButton._customListener);
  tutorialNextButton._customListener = handleClose;
  tutorialNextButton.addEventListener("click", handleClose);
}

// layer van inzetten van multicolor

function showColorChoice(callback) {
  gamePaused = true;

    // âœ… Zorg dat andere overlays niet zichtbaar zijn
    document.getElementById("levelMatrixOverlay").style.display = "none";
 
 //   document.getElementById("challengeGridOverlay").style.display = "none";

  const modal = document.getElementById("colorChoiceModal");
  const options = document.getElementById("colorOptions");
  options.innerHTML = "";

  colors.forEach(color => {
    const btn = document.createElement("button");
    btn.style.backgroundColor = color;
    btn.style.border = "2px solid white";
    btn.style.width = "40px";
    btn.style.height = "40px";
    btn.style.borderRadius = "8px";
    btn.onclick = () => {
      modal.style.display = "none";
      callback(color);
      gamePaused = false;
    };
    options.appendChild(btn);
  });

  const texts = [
  "Your next block needs a music genre and matching colour. What will it be?",
];

//  "Your next block needs a vibe. Which colour is she serving?",
//  "Sheâ€™s ready to slay. Choose her colour, stylist!",
//  "Your next diva is bare. Dress her in a colour, darling.",
//  "Block incoming... but sheâ€™s got no outfit! What colour?",
//  "Sheâ€™s standing there, nude and confused. Help her pick a colour.",
//  "Time for a colour emergency. Give her something to werk with!",
//  "No colour? No confidence. Fix her up!",
//  "She refuses to fall without the right look. Choose a colour.",
//  "Sheâ€™s blank, baby. Throw some shade on her.",
//  "Sheâ€™s not coming down until sheâ€™s cute. Whatâ€™s her colour?"

document.getElementById("colorChoiceText").textContent =
  texts[Math.floor(Math.random() * texts.length)];

const colorText = document.getElementById("colorChoiceText");
colorText.style.color = "#FFE680";
colorText.style.backgroundColor = "#2F261F";
colorText.style.padding = "20px";
colorText.style.borderRadius = "16px";
colorText.style.fontFamily = "'Baloo Bhaina 2', sans-serif";
colorText.style.fontSize = "1.3rem";
colorText.style.fontWeight = "700";
colorText.style.lineHeight = "1.6";
colorText.style.textAlign = "center";
colorText.style.boxShadow = "0 0 10px rgba(0,0,0,0.4)";
colorText.style.marginBottom = "20px";

  modal.style.display = "block";



}

// hoe snel bokje beweegt

//setInterval(gameLoop, fallSpeed);
//setInterval(gameLoop, 400);



    document.addEventListener("DOMContentLoaded", () => {
  const howToPartyCell = document.getElementById("howToPartyCell");
  const tutorialOverlay = document.getElementById("tutorialOverlay");
  const tutorialImage = document.getElementById("tutorialImage");
  const tutorialNextButton = document.getElementById("tutorialNextButton");

  
 

  howToPartyCell.addEventListener("click", () => {
  if (tutorialInProgress) return;
  tutorialStep = 0;
  tutorialInProgress = true;
  tutorialImage.src = tutorialImages[tutorialStep];
  tutorialOverlay.style.display = "flex";
  gamePaused = true;
});

  let tutorialInProgress = false;

  tutorialNextButton.removeEventListener("click", tutorialNextButton._customListener);
tutorialNextButton._customListener = () => {
  tutorialStep++;

  if (tutorialStep >= tutorialImages.length) {
    tutorialOverlay.style.display = "none";

    if (introImageOnly) {
      // geen actie nodig
    } else if (startedFromIntro) {
      document.getElementById('startOverlay').style.display = 'flex';
      startedFromIntro = false;
    } else {
      gamePaused = false;
    }

    tutorialInProgress = false;
    return;
  }

  tutorialImage.src = tutorialImages[tutorialStep];
};
tutorialNextButton.addEventListener("click", tutorialNextButton._customListener);
});



let startedFromIntro = false;
let introImageOnly = false;



function startTutorialFromIntro() {
  startedFromIntro = true;
  tutorialStep = 0;
  document.getElementById("tutorialImage").src = tutorialImages[tutorialStep];
  document.getElementById("tutorialOverlay").style.display = "flex";
  document.getElementById("startOverlay").style.display = "none";
  gamePaused = true;
}


// als je tutorial start bij beginscherm
// function startTutorialFromIntro() {
//  localStorage.removeItem("testScore");
//  score = 0;
//  updateScoreDisplay();
//  startedFromIntro = true;
//  introImageOnly = false;
//  tutorialStep = 0;
//  tutorialInProgress = true;
//  document.getElementById("tutorialImage").src = tutorialImages[tutorialStep];
//  document.getElementById("tutorialOverlay").style.display = "flex";
//  document.getElementById("startOverlay").style.display = "none";
//  gamePaused = true;
//}


let levelImageShown = false; // voorkomt dubbele weergave


// in welke level zitten we en wat dan tonen (zowel voorlevels als challenges) - wordt aangeroepen in cruciale functue update

function checkLevelProgression() {

  if (level === 1 && blockCounter >= 6 && !levelImageShown) {
    //showLevelTransitionImage();
    //https://iili.io/FUBnOoN.md.png

    showCelebrationOverlay("images/fig59.png");
    levelImageShown = true;
    blockCounter = 0;
    level = 2;
    return;
  }

  if (level === 3 && blockCounter >= 20 && !level3ImageShown) {
  showLevel3CelebrationImage();
  return;
}

if (level === 4 && blockCounter >= 15 && !level4ImageShown) {
  level = 5;
  level4ImageShown = true;
  blockCounter = 0;

  showCelebrationOverlay("images/fig60.png");

  forcedNextBlock = {
    color: "#FF6F61",
    length: 1,
    isSpecial: true,
    isMulticolor: false,
    isDiva: false,
    divaCountdown: null
  };

  updateScoreDisplay();
  return;
}

if (level === 5 && heartFreed && !level6Triggered) {
  level = 6;
  level6Triggered = true;
  blockCounter = 0;
  showCelebrationOverlay("images/fig61.png"); // afbeelding voor overgang naar 6
  forcedNextBlock = {
    color: "#50E3C2",
    length: 1,
    isSpecial: false,
    isMulticolor: false,
    isDiva: true,
    divaCountdown: 10
  };
  updateScoreDisplay();
  return;
}

  // Na 20 blokken in level 6 â†’ level 7 - multicolor
  if (level === 6 && !level7Triggered && blockCounter >= 20) {
    level = 7;
    level7Triggered = true;
    blockCounter = 0;
    showCelebrationOverlay("images/fig62.png");

    forcedNextBlock = {
  color: colors[Math.floor(Math.random() * colors.length)], // gewone kleur
  length: 1,
  isSpecial: false,
  isMulticolor: true, // dit triggert het multicolor-teller-mechanisme
  isDiva: false,
  divaCountdown: null
};

    updateScoreDisplay();
    return;
  }


  // Na 20 blokken in level 7 â†’ level 8 - toon multicolor naar 8
  if (level === 7 && !level8Triggered && blockCounter >= 20) {
    level = 8;
    level8Triggered = true;
    blockCounter = 0;
    showCelebrationOverlay("images/fig63.png");

    updateScoreDisplay();
    return;
  }

  if (level === 8 && blockCounter >= 10 && !level9Triggered) {
  level = 9;
  level9Triggered = true;
  blockCounter = 0;
  showCelebrationOverlay("images/fig64.png"); // vervang door je eigen afbeelding indien gewenst
  updateScoreDisplay();
  return;
}

if (level === 9 && blockCounter >= 10 && !level10Triggered) {
  level = 10;
  level10Triggered = true;
  blockCounter = 0;
  showCelebrationOverlay("images/fig65.png"); // gebruik hier je gewenste afbeelding
  updateScoreDisplay();
  return;
}

// starten van de challenges

// Challenge 1
if (level === challengeLevel && !challengeRewardGiven) {
  if (isAnyChallengeActive()) { // dit zou niet meer gebeuren want ik stop alle sop 19,24,...
    challengeLevel++;
  } else {
    challengeActive = true;
    level++;
    updateLevelAndBpmDisplay()
    updateLevelDisplay();
    challengeHeartCount = 0;
    challengeBlockCounter = 0;
    challengeHeartOverrideCounter = 30;
    preventHeartReward = true;
    challengeRewardGiven = false;
    updateChallengeStatusCell();
    showCelebrationOverlay("images/fig66.png");
    updateScoreDisplay();
    challengeLevel = originalChallengeLevel;
  }
}

// Challenge 2
if (level === challenge2Level && !challenge2RewardGiven) {
  if (isAnyChallengeActive()) {
    challenge2Level++;
  } else {
    challenge2Active = true;
    challenge2MultiCount = 0;
    challenge2BlockCounter = 0;
    challenge2RewardGiven = false;
    level++;
    updateLevelAndBpmDisplay()
    updateLevelDisplay();
    updateChallenge2StatusCell();
    showCelebrationOverlay("images/fig67.png");
    updateScoreDisplay();
    challenge2Level = originalChallenge2Level;
  }
}

// Challenge 3
if (level === challenge3Level && !challenge3Started) {
  if (isAnyChallengeActive()) {
    challenge3Level++;
  } else {
    challenge3Active = true;
    challenge3Started = true;
    challenge3Failed = false;
    challenge3Success = false;
    challenge3RewardGiven = false;
    challenge3Count = 0;
    level++;
    updateLevelAndBpmDisplay()
    updateLevelDisplay();
    showCelebrationOverlay("images/fig68.png");
    updateChallenge3StatusCell();
    challenge3Level = originalChallenge3Level;
  }
}

// Challenge 4
if (level === challenge4Level && !challenge4RewardGiven) {
  if (isAnyChallengeActive()) {
    challenge4Level++;
  } else {
    challenge4Active = true;
    challenge4Count = 0;
    challenge4FullFieldMoments = 0;
    level++;
    updateLevelAndBpmDisplay()
    updateLevelDisplay();
    showCelebrationOverlay("images/fig69.png");
    updateChallenge4StatusCell();
    challenge4Level = originalChallenge4Level;
  }
}

// Challenge 5
if (level === challenge5StartLevel && !challenge5Started) {
  if (isAnyChallengeActive()) {
    challenge5StartLevel++;
  } else {
    challenge5Started = true;
    challenge5Active = true;
    challenge5Done = false;
    challenge5Success = false;
    challenge5BlockCounter = 0;
    challenge5RewardGiven = false;
    level++;
    updateLevelAndBpmDisplay()
    updateLevelDisplay();
    showCelebrationOverlay("images/fig70.png");
    updateChallenge5StatusCell();
    updateChallengeStatusCell();

    for (let r = 0; r < field.length; r++) {
      for (let c = 0; c < field[0].length; c++) {
        const block = field[r][c];
        if (block) {
          block.isDiva = true;
          block.divaCountdown = 29;
        }
      }
    }

    challenge5StartLevel = originalChallenge5StartLevel;
  }
}

// Challenge 6
if (level === challenge6Level && !challenge6Done && !challenge6RewardGiven) {
  if (isAnyChallengeActive()) {
    challenge6Level++;
  } else {
    challenge6Active = true;
    challenge6BlockCounter = 0;
    challenge6SixGroupCount = 0;
    challenge6RewardGiven = false;
    level++;
    updateLevelAndBpmDisplay()
    updateLevelDisplay();
    updateChallenge6StatusCell();
    showCelebrationOverlay("images/fig71.png");
    challenge6Level = originalChallenge6Level;
  }
}

// Challenge 7
if (level === challenge7Level && !challenge7Done && !challenge7RewardGiven) {
  if (isAnyChallengeActive()) {
    challenge7Level++;
  } else {
    challenge7Active = true;
    challenge7BlockCount = 0;
    challenge7GroupCount = 0;
    challenge7RewardGiven = false;
    fallSpeedBeforeChallenge7 = fallSpeed;
    //fallSpeed = challenge7StartSpeed;
    
    clearInterval(fallInterval);
    fallInterval = setInterval(gameLoop, fallSpeed);
    level++;
    updateLevelAndBpmDisplay()
    updateLevelDisplay();
    updateChallenge7StatusCell();
    showCelebrationOverlay("images/fig72.png");
    challenge7Level = originalChallenge7Level;
  }
}


// xxx



if (challenge2Active && !challenge2RewardGiven) {
    if (challenge2MultiCount >= challenge2MultiTarget && challenge2BlockCounter <= challenge2BlockLimit) {
  // SUCCES: voeg pending multicolors toe aan totaal
  //multicolorCount += challenge2PendingMulticolors;
  multicolorCount += 3;
  multicolorDisplay.textContent = multicolorCount;

  challenge2RewardGiven = true;
  challenge2Active = false;
  challenge2PendingMulticolors = 0;
  challenge2Success = true;

  updateChallenge2StatusCell();
  showCelebrationOverlay("images/fig44.png");

// EXTRA: SUCCES IN PRACTICE-MODUS
if (practiceModech21) {
  practiceChallenge2Wins21++;
  localStorage.setItem("practiceChallenge2Wins21", practiceChallenge2Wins21);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech22) {
  practiceChallenge2Wins22++;
  localStorage.setItem("practiceChallenge2Wins22", practiceChallenge2Wins22);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech23) {
  practiceChallenge2Wins23++;
  localStorage.setItem("practiceChallenge2Wins23", practiceChallenge2Wins23);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech24) {
  practiceChallenge2Wins24++;
  localStorage.setItem("practiceChallenge2Wins24", practiceChallenge2Wins24);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech25) {
  practiceChallenge2Wins25++;
  localStorage.setItem("practiceChallenge2Wins25", practiceChallenge2Wins25);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech26) {
  practiceChallenge2Wins26++;
  localStorage.setItem("practiceChallenge2Wins26", practiceChallenge2Wins26);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech27) {
  practiceChallenge2Wins27++;
  localStorage.setItem("practiceChallenge2Wins27", practiceChallenge2Wins27);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech28) {
  practiceChallenge2Wins28++;
  localStorage.setItem("practiceChallenge2Wins28", practiceChallenge2Wins28);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}
if (practiceModech29) {
  practiceChallenge2Wins29++;
  localStorage.setItem("practiceChallenge2Wins29", practiceChallenge2Wins29);
  updatePracticeCellTeller();
  pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
  return;
}


  return;
}

  if (challenge2BlockCounter > challenge2BlockLimit) {
    // FAIL: multicolors kwijt
    challenge2Active = false;
    challenge2RewardGiven = true;
 //   multicolorCount = 0;
    multicolorDisplay.textContent = multicolorCount;
    updateChallenge2StatusCell();
    showCelebrationOverlay("images/fig45.png"); // vervang indien gewenst

// EXTRA: FAIL IN PRACTICE-MODUS
if (
  practiceModech21 || practiceModech22 || practiceModech23 || practiceModech24 ||
  practiceModech25 || practiceModech26 || practiceModech27 || practiceModech28 ||
  practiceModech29
) {
  pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
  return;
}


  }
}


// challenge 1 lukt of niet

if (challengeActive && !challengeRewardGiven) {
  if (challengeHeartCount >= challengeHeartTarget && challengeBlockCounter <= challengeBlockLimit) {
    // SUCCES
    lives += 3;
    updateLivesDisplay();
    challengeRewardGiven = true;
    challengeActive = false;
    preventHeartReward = false;
    challenge1Success = true;
    updateChallengeStatusCell();
    showCelebrationOverlay("images/fig44.png");
    updateScoreDisplay();

    // EXTRA: SUCCES IN PRACTICE-MODUS
    if (practiceModech11) {
      practiceChallenge1Wins11++;
      localStorage.setItem("practiceChallenge1Wins11", practiceChallenge1Wins11);
      updatePracticeCellTeller();
      pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
      return;
    }
    if (practiceModech12) {
      practiceChallenge1Wins12++;
      localStorage.setItem("practiceChallenge1Wins12", practiceChallenge1Wins12);
      updatePracticeCellTeller();
      pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
      return;
    }
    if (practiceModech13) {
      practiceChallenge1Wins13++;
      localStorage.setItem("practiceChallenge1Wins13", practiceChallenge1Wins13);
      updatePracticeCellTeller();
      pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
      return;
    }
    if (practiceModech14) {
      practiceChallenge1Wins14++;
      localStorage.setItem("practiceChallenge1Wins14", practiceChallenge1Wins14);
      updatePracticeCellTeller();
      pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
      return;
    }
    if (practiceModech15) {
      practiceChallenge1Wins15++;
      localStorage.setItem("practiceChallenge1Wins15", practiceChallenge1Wins15);
      updatePracticeCellTeller();
      pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
      return;
    }
    if (practiceModech16) {
      practiceChallenge1Wins16++;
      localStorage.setItem("practiceChallenge1Wins16", practiceChallenge1Wins16);
      updatePracticeCellTeller();
      pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
      return;
    }
    if (practiceModech17) {
      practiceChallenge1Wins17++;
      localStorage.setItem("practiceChallenge1Wins17", practiceChallenge1Wins17);
      updatePracticeCellTeller();
      pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
      return;
    }
    if (practiceModech18) {
      practiceChallenge1Wins18++;
      localStorage.setItem("practiceChallenge1Wins18", practiceChallenge1Wins18);
      updatePracticeCellTeller();
      pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
      return;
    }
    if (practiceModech19) {
      practiceChallenge1Wins19++;
      localStorage.setItem("practiceChallenge1Wins19", practiceChallenge1Wins19);
      updatePracticeCellTeller();
      pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
      return;
    }
  }

  if (challengeBlockCounter > challengeBlockLimit) {
    // FAIL
    challengeActive = false;
    challengeRewardGiven = true;
    updateChallengeStatusCell();
    preventHeartReward = false;
    showCelebrationOverlay("images/fig45.png");

    // EXTRA: FAIL IN PRACTICE-MODUS
    if (
      practiceModech11 || practiceModech12 || practiceModech13 || practiceModech14 ||
      practiceModech15 || practiceModech16 || practiceModech17 || practiceModech18 ||
      practiceModech19
    ) {
      pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
      return;
    }
  }
}




//if (challengeActive && !challengeRewardGiven) {
//    if (challengeHeartCount >= challengeHeartTarget && challengeBlockCounter <= challengeBlockLimit) {
//  lives += 3;
//  updateLivesDisplay();
//  //score += 250;
//  challengeRewardGiven = true;
//  challengeActive = false;
//  preventHeartReward = false;
//  challenge1Success = true;
//  updateChallengeStatusCell();
//  showCelebrationOverlay("images/fig44.png");
//  updateScoreDisplay();
//}
//
 //  if (challengeBlockCounter > challengeBlockLimit) {
 //   challengeActive = false;
 //   challengeRewardGiven = true;
 //   updateChallengeStatusCell();
 //   preventHeartReward = false;
 //   showCelebrationOverlay("images/fig45.png"); // afbeelding bij mislukte challenge
 // }
// }


//if (practiceModech39) {
//  if (challenge3Success) {
//    practiceChallenge3Wins39++;
//    localStorage.setItem("practiceChallenge3Wins39", practiceChallenge3Wins39);
//    updatePracticeCellTeller();
//    pauseGameAndShowMessage("Great job â€” youâ€™ve completed this practice mission! But the real training floor is bigger than that... Each mission comes with multiple difficulty levels â€” faster beats, more blocks on the floor, and fewer special moves to rely on. Ready to test your groove at the next level?");
//    return;
//  } else if (challenge3Failed) {
//    pauseGameAndShowMessage("Didnâ€™t land the mission this time â€” but hey, this is just practice! Rewind, replay, retry as much as you like.");
//    return;
//  }
//}


}

// het tonen van pop ups bij chal en behaalde levels

function showCelebrationOverlay(imageUrl) {
  const tutorialOverlay = document.getElementById("tutorialOverlay");
  const tutorialImage = document.getElementById("tutorialImage");
  const tutorialNextButton = document.getElementById("tutorialNextButton");

  // ğŸ‘‡ Verberg het party mission/challenge-keuzescherm indien actief
  const levelMatrixOverlay = document.getElementById("levelMatrixOverlay");
  if (levelMatrixOverlay && levelMatrixOverlay.style.display === "flex") {
    levelMatrixOverlay.style.display = "none";
  }

  if (tutorialOverlay.style.display === "flex") return; // voorkomt dubbele overlays

  tutorialStep = -1;
  tutorialImage.onload = () => {
    tutorialOverlay.style.display = "flex";
  };
  tutorialImage.src = imageUrl;
  tutorialNextButton.style.display = "block";
  gamePaused = true;

  const close = () => {
    tutorialOverlay.style.display = "none";
    gamePaused = false;
    tutorialNextButton.removeEventListener("click", close);
  };

  tutorialNextButton.removeEventListener("click", tutorialNextButton._customListener);
  tutorialNextButton._customListener = close;
  tutorialNextButton.addEventListener("click", close);
}


// specifiek tonen image van level 3
function showLevel3CelebrationImage() {
  const tutorialOverlay = document.getElementById("tutorialOverlay");
  const tutorialImage = document.getElementById("tutorialImage");
  const tutorialNextButton = document.getElementById("tutorialNextButton");
// pairs en trios
  tutorialImage.src = "images/fig73.png";
  tutorialOverlay.style.display = "flex";
  tutorialNextButton.style.display = "block";
  gamePaused = true;

  const handleNext = () => {
  tutorialOverlay.style.display = "none";
  gamePaused = false;
  level = 4;
  pauseUsesLeft++;
  
  levelImageShown = true;
  level3ImageShown = true;
  blockCounter = 0;
  updatePauseDisplay();
  updateScoreDisplay();
  tutorialNextButton.removeEventListener("click", handleNext);
};

  tutorialNextButton.removeEventListener("click", tutorialNextButton._customListener);
  tutorialNextButton._customListener = handleNext;
  tutorialNextButton.addEventListener("click", handleNext);
}


function showLevelTransitionImage() {
  const tutorialOverlay = document.getElementById("tutorialOverlay");
  const tutorialImage = document.getElementById("tutorialImage");
  const tutorialNextButton = document.getElementById("tutorialNextButton");

  tutorialNextButton.style.display = "none"; // verberg knop tijdelijk
  tutorialOverlay.style.display = "flex";
  gamePaused = true;

  tutorialImage.style.display = "none"; // verberg de afbeelding tijdelijk

  tutorialImage.onload = () => {
    tutorialImage.style.display = "block"; // toon pas als afbeelding geladen is
    tutorialNextButton.style.display = "block";
  };

  tutorialImage.src = "images/fig74.png";

  const handleLevelAdvance = () => {
    tutorialOverlay.style.display = "none";
    gamePaused = false;
    level = 2;
    updateScoreDisplay();

    tutorialNextButton.removeEventListener("click", handleLevelAdvance);
  };

  tutorialNextButton.removeEventListener("click", tutorialNextButton._customListener);
  tutorialNextButton._customListener = handleLevelAdvance;
  tutorialNextButton.addEventListener("click", handleLevelAdvance);
}

// beeld bij level 1
//function showLevelTransitionImage() {
//  const tutorialOverlay = document.getElementById("tutorialOverlay");
//  const tutorialImage = document.getElementById("tutorialImage");
//  const tutorialNextButton = document.getElementById("tutorialNextButton");
//
//  tutorialImage.src = "https://iili.io/FOgPcWg.md.png";
//  tutorialOverlay.style.display = "flex";
//  tutorialNextButton.style.display = "block";
//  gamePaused = true;
//
//  const handleLevelAdvance = () => {
//    tutorialOverlay.style.display = "none";
//    gamePaused = false;
//    level = 2;
//    updateScoreDisplay();
//
//    tutorialNextButton.removeEventListener("click", handleLevelAdvance);
//  };
//
//  tutorialNextButton.removeEventListener("click", tutorialNextButton._customListener);
//  tutorialNextButton._customListener = handleLevelAdvance;
//  tutorialNextButton.addEventListener("click", handleLevelAdvance);
//}

function startNormalGame() {
  localStorage.removeItem("testScore");
  score = 0;
  updateScoreDisplay();

  const tutorialOverlay = document.getElementById("tutorialOverlay");
  const tutorialImage = document.getElementById("tutorialImage");
  const tutorialNextButton = document.getElementById("tutorialNextButton");

  if (!tutorialOverlay || !tutorialImage || !tutorialNextButton) {
    return;
  }

// welcome to block party
  document.getElementById("startOverlay").style.display = "none";
  tutorialImage.src = "images/fig75.png";
  tutorialOverlay.style.display = "flex";
  tutorialNextButton.style.display = "block";
  gamePaused = true;
  introImageOnly = true;

  const handleNext = () => {
    tutorialOverlay.style.display = "none";
    gamePaused = false;
    introImageOnly = false;
    pauseUsesLeft = 1000;
    tutorialNextButton.removeEventListener("click", handleNext);

    // ğŸ‘‡ spel pas hier echt starten
    level = 1;
    score = 0;
    lives = 5;
    renewTokenCount = 5;
    multicolorCount = 5;
    skipUsesLeft = 0;
    saveBlockCountdown = 1;
    saveUnlocked = false;
    pauseUsesLeft = 1000;
    blockSpawnCount = 0;
    blockSpawnCountfree = 0;
    bigGroupCount = 0;
    forcedNextBlock = null;
    isPaused = false;
    gamePaused = false;
    freePictureCount = 5;
    blockCounter = 0;
    gridOffsetX = 0;
    gridOffsetY = 0;

levelImageShown = false;
level2ImageShown =false;
level3ImageShown=false;
level4ImageShown=false;
level5ImageShown=false;
level6imageshown=false;
level7ImageShown=false;
level8ImageShown=false;

// Algemene reset
challengeActive = false;
challengeLocked = false;

// Challenge 1
challenge1Done = false;
challengeHeartCount = 0;
challengeHeartOverrideCounter = 0;
preventHeartReward = false;
challengeBlockCounter = 0;
challengeRewardGiven = false;

// Challenge 2
challenge2Active = false;
challenge2Done = false;
challenge2MultiCount = 0;
challenge2BlockCounter = 0;
challenge2RewardGiven = false;
challenge2SuccessImageShown = false;
challenge2PendingMulticolors = 0;

// Challenge 3
challenge3Active = false;
challenge3Started = false;
challenge3Done = false;
challenge3Failed = false;
challenge3Success = false;
challenge3Count = 0;

// Challenge 4
challenge4Active = false;
challenge4Done = false;
challenge4Count = 0;
challenge4FullFieldMoments = 0;
challenge4Success = false;
challenge4RewardGiven = false;

// Challenge 5
challenge5Active = false;
challenge5Done = false;
challenge5Success = false;
challenge5BlockCounter = 0;
challenge5StartImageShown = false;
challenge5SuccessImageShown = false;
challenge5Started = false;

// Challenge 6
challenge6Active = false;
challenge6Done = false;
challenge6Success = false;
challenge6BlockCounter = 0;
challenge6SixGroupCount = 0;
challenge6RewardGiven = false;

// Challenge 7
challenge7Active = false;
challenge7Done = false;
challenge7Success = false;
challenge7BlockCount = 0;
challenge7GroupCount = 0;
challenge7RewardGiven = false;

    field = Array.from({ length: gridRows }, () => Array(gridCols).fill(null));

    updateScoreDisplay();
    updateLivesDisplay();
    updateMulticolorDisplay();
    updatePauseDisplay();
    updateRenewDisplay();
    updateLevelDisplay();
    updateFreePictureDisplay();

    nextBlock = generateNextBlock();
    updateNextBlockDisplay(nextBlock.color, nextBlock.length, nextBlock.isDiva);
    
    updateChallengeStatusCell();
updateChallenge2StatusCell();
updateChallenge3StatusCell();
updateChallenge4StatusCell();
updateChallenge5StatusCell();
updateChallenge6StatusCell();
updateChallenge7StatusCell();
updateLevelDisplay();
updateLevelAndBpmDisplay();
    
    fallingBlock = createBlock("down");

    drawGrid();
    drawFallingBlock();

    fallSpeed = 400;
    clearInterval(fallInterval);
    fallInterval = setInterval(gameLoop, fallSpeed);
  };

  // â›” eerst oude listener weghalen als die er was
  tutorialNextButton.removeEventListener("click", tutorialNextButton._customListener);
  tutorialNextButton._customListener = handleNext;
  tutorialNextButton.addEventListener("click", handleNext);
}


// allereerste slide van tutorial
function showStartImageBeforeGame() {
  localStorage.removeItem("testScore");
  score = 0;
  updateScoreDisplay();
  
  const tutorialOverlay = document.getElementById("tutorialOverlay");
  const tutorialImage = document.getElementById("tutorialImage");
  const tutorialNextButton = document.getElementById("tutorialNextButton");

  if (!tutorialOverlay || !tutorialImage || !tutorialNextButton) {
        return;
  }

  document.getElementById("startOverlay").style.display = "none";
  tutorialImage.src = "images/fig76.png";
  tutorialOverlay.style.display = "flex";
  tutorialNextButton.style.display = "block";
  gamePaused = true;
  introImageOnly = true;

  const handleNext = () => {
        tutorialOverlay.style.display = "none";
    gamePaused = false;
    introImageOnly = false;
    pauseUsesLeft = 1000;
    // verwijderd: document.getElementById("startOverlay").style.display = "none";
    document.getElementById("startOverlay").style.display = "none";
    tutorialNextButton.removeEventListener("click", handleNext);
  };

  tutorialNextButton.removeEventListener("click", tutorialNextButton._customListener);
  tutorialNextButton._customListener = handleNext;
  tutorialNextButton.addEventListener("click", handleNext);
  }

;

  // Verwijder vorige listeners en koppel nieuwe
  tutorialNextButton.removeEventListener("click", tutorialNextButton._customListener);

levelDisplay.addEventListener("click", () => {
  document.getElementById("levelMatrixOverlay").style.display = "flex";
  updateChallengeStatusCell();
  gamePaused = true;
});

function closeLevelMatrixOverlay() {
  document.getElementById("levelMatrixOverlay").style.display = "none";
  gamePaused = false;
}


// om de cel van de 1ste challenge te updaten

function updateChallengeStatusCell() {

updateChallengeInfoText()



  const cell = document.getElementById("challengeStatusCell");


  if (!cell) return;

  // Verwijder achtergrondafbeelding
  cell.style.backgroundImage = "none";

  const isInactive = level < challengeLevel;

  // Container met horizontale verdeling
  const container = document.createElement("div");
  container.style.display = "flex";
  container.style.flexDirection = "row";
  container.style.justifyContent = "space-between";
  container.style.alignItems = "center";
  container.style.height = "100%";
  container.style.width = "100%";

  // Linkerkant: afbeelding

// Linkerkant: tekst + afbeelding (elk 50%)
const left = document.createElement("div");
left.style.width = "70%";
left.style.display = "flex";
left.style.flexDirection = "row";
left.style.alignItems = "center";

// Tekst links van de afbeelding
const leftText = document.createElement("div");
leftText.textContent = "Brace yourself â€“ 30 heart blocks are coming in a row! Make them all vanish within 100 blocks. No multicolor, skip or free picture tricks allowed. Beat it and earn 3 extra lives!"; // â† dynamisch als je wil
leftText.style.width = "80%";
leftText.style.color = isInactive ? "#888" : "#FFE680";
leftText.style.fontWeight = "bold";

leftText.style.textAlign = "center";
leftText.style.padding = "4px";

leftText.style.fontSize = "0.75rem"; // kleiner dan 0.9rem
leftText.style.lineHeight = "1.1";   // compacter
leftText.style.overflowWrap = "break-word"; // tekst mag breken
leftText.style.wordBreak = "break-word";    // extra veiligheid
leftText.style.hyphens = "auto";            // eventueel afbreken op lettergrepen

// Afbeelding rechts
const img = document.createElement("img");
img.src = "images/fig77.png";
img.alt = "Challenge-afbeelding";
img.style.width = "20%";
img.style.maxHeight = "120px";
img.style.objectFit = "contain";
img.style.display = "block";
img.style.filter = isInactive ? "grayscale(100%)" : "none";

left.appendChild(leftText);
left.appendChild(img);




  // Rechterkant: tekstinfo
  const right = document.createElement("div");
  right.style.width = "30%";
  right.style.display = "flex";
  right.style.flexDirection = "column";
  right.style.justifyContent = "center";
  right.style.alignItems = "flex-start"; // â† links uitlijnen
  right.style.fontSize = "0.9rem";
  right.style.paddingLeft = "5px";

  if (challenge1Success) {
    right.innerHTML = `<div>âœ… Go again for 1000 points?</div>`;
   
  } else if (challengeRewardGiven) {
    right.innerHTML = `<div>âŒ Go again for 1000 points?</div>`;
    
  } else {
//    const textColor = isInactive ? "#888" : "#FFE680";
    right.innerHTML = `
      <div>â¤ï¸ <span id="challengeHeartCount">${challengeHeartCount}</span> / ${challengeHeartTarget}</div>
      <div>â³ <span id="challengeBlockCounter">${challengeBlockCounter}</span> / ${challengeBlockLimit}</div>
    `;
  }

  container.appendChild(left);
  container.appendChild(right);

  cell.innerHTML = "";
  cell.appendChild(container);
  cell.onclick = restartChallenge1;

if (isInactive) {
  cell.classList.add("inactive");
  cell.style.backgroundColor = "";     // grijs via CSS
  cell.style.borderColor = "";         // standaard CSS blijft
} else {
  cell.classList.remove("inactive");

  if (challenge1Success) {
    cell.style.backgroundColor = "rgba(0, 255, 0, 0.1)";   // lichtgroen
    cell.style.borderColor = "#00cc00";                    // donkergroen randje
  } else if (challengeRewardGiven) {
    cell.style.backgroundColor = "rgba(255, 0, 0, 0.1)";   // lichtrood
    cell.style.borderColor = "#cc0000";                    // donkerrood randje
  } else if (challengeActive) {
    cell.style.backgroundColor = "rgba(0, 170, 255, 0.1)"; // lichtblauw
    cell.style.borderColor = "#00aaff";                   // helderblauw randje
  } else {
    cell.style.backgroundColor = "";      // standaard
    cell.style.borderColor = "#e88a2d";   // standaard oranje rand
  }
}

}

function isAnyChallengeActive() {
  return (
    challengeActive || // Challenge 1
    challenge2Active ||
    challenge3Active ||
    challenge4Active ||
    challenge5Active ||
    challenge6Active ||
    challenge7Active
  );
}

function restartChallenge1() {
  if (level < challengeLevel) return;

if (isAnyChallengeActive()) {
  showCelebrationOverlay("images/fig78.png");
  return;
}


  if (score < 1000) {
    // Niet genoeg punten â†’ toon foutafbeelding
    showCelebrationOverlay("images/fig79.png");
    return;
  }

  // Genoeg punten â†’ trek af en herstart challenge
  score -= 1000;
  updateScoreDisplay();

  challengeActive = true;
  challengeRewardGiven = false;
  challengeHeartCount = 0;
  challengeBlockCounter = 0;
  challengeHeartOverrideCounter = 30;
  preventHeartReward = true;
  passedChallenge1c = false;
  challenge1Success = false;

  updateChallengeStatusCell();
  showCelebrationOverlay("images/fig80.png");
}

function updateChallenge3StatusCell() {
updateChallengeInfoText()
// CHALLENGE 3


//console.log("resetImage = ", document.getElementById("resetImage"));
//console.log("resetImage1 = ", document.getElementById("resetImage1"));

  const cell = document.getElementById("challenge3StatusCell");
  if (!cell) return;

  cell.style.backgroundImage = "none";


  const isInactive = level < challenge3Level;

  const container = document.createElement("div");
  container.style.display = "flex";
  container.style.flexDirection = "row";
  container.style.justifyContent = "space-between";
  container.style.alignItems = "center";
  container.style.height = "100%";
  container.style.width = "100%";

  // Linkerkant (afbeelding)
 const left = document.createElement("div");
left.style.width = "70%";
left.style.display = "flex";
left.style.flexDirection = "row";
left.style.alignItems = "center";

// Tekst (links)
const leftText = document.createElement("div");
leftText.textContent = "Stay sharp â€“ survive the next 100 blocks without losing a single life! Pull it off and score 3 bonus lives!"; // â† dynamisch als je wil
leftText.style.width = "80%";
leftText.style.color = isInactive ? "#888" : "#FFE680";
leftText.style.fontWeight = "bold";

leftText.style.textAlign = "center";
leftText.style.padding = "4px";

leftText.style.fontSize = "0.75rem"; // kleiner dan 0.9rem
leftText.style.lineHeight = "1.1";   // compacter
leftText.style.overflowWrap = "break-word"; // tekst mag breken
leftText.style.wordBreak = "break-word";    // extra veiligheid
leftText.style.hyphens = "auto";            // eventueel afbreken op lettergrepen

// Afbeelding (rechts)
const img = document.createElement("img");
img.src = "images/fig86.png";
img.alt = "Challenge 3";
img.style.width = "20%";
img.style.maxHeight = "60px";
img.style.objectFit = "contain";
img.style.display = "block";
img.style.filter = isInactive ? "grayscale(100%)" : "none";

left.appendChild(leftText);
left.appendChild(img);


  // Rechterkant (tekstinfo)
  const right = document.createElement("div");
  right.style.width = "30%";
  right.style.display = "flex";
  right.style.flexDirection = "column";
  right.style.justifyContent = "center";
  right.style.alignItems = "flex-start";
  right.style.fontSize = "0.9rem";
  right.style.paddingLeft = "5px";

  if (challenge3Success) {
    right.innerHTML = `<div>âœ… Go again for 1000 points?</div>`;
  } else if (challenge3RewardGiven) {
    right.innerHTML = `<div>âŒ Go again for 1000 points?</div>`;
  } else {
const textColor = isInactive ? "#888" : "#FFE680";
    right.innerHTML = `
      <div>ğŸ§â€â™‚ï¸ <span id="challenge3Count">${challenge3Count}</span> / ${challenge3Limit}</div>
    `;
  }

  container.appendChild(left);
  container.appendChild(right);

  cell.innerHTML = "";
  cell.appendChild(container);
  cell.onclick = restartChallenge3;



if (isInactive) {
  cell.classList.add("inactive");
  cell.style.backgroundColor = "";     // grijs via CSS
  cell.style.borderColor = "";         // standaard CSS blijft
} else {
  cell.classList.remove("inactive");

  if (challenge3Success) {
    cell.style.backgroundColor = "rgba(0, 255, 0, 0.1)";   // lichtgroen
    cell.style.borderColor = "#00cc00";                    // donkergroen randje
  } else if (challenge3RewardGiven) {
    cell.style.backgroundColor = "rgba(255, 0, 0, 0.1)";   // lichtrood
    cell.style.borderColor = "#cc0000";                    // donkerrood randje
  } else if (challenge3Active) {
    cell.style.backgroundColor = "rgba(0, 170, 255, 0.1)"; // lichtblauw
    cell.style.borderColor = "#00aaff";                   // helderblauw randje
  } else {
    cell.style.backgroundColor = "";      // standaard
    cell.style.borderColor = "#e88a2d";   // standaard oranje rand
  }
}

  
}


function restartChallenge3() {
  if (level < challenge3Level) return; // Alleen activeren als het level bereikt is

if (isAnyChallengeActive()) {
  showCelebrationOverlay("images/fig78.png");
  return;
}

  if (score < 1000) {
    // Niet genoeg punten â†’ toon foutafbeelding
    showCelebrationOverlay("images/fig79.png");
    return;
  }

  // Genoeg punten â†’ trek 1000 af en herstart challenge
  score -= 1000;
  updateScoreDisplay();

  challenge3Active = true;
  challenge3Started = true;
  challenge3Failed = false;
  challenge3Success = false;
  challenge3RewardGiven = false;
  challenge3Count = 0;
  passedChallenge3c = false;

  updateChallenge3StatusCell();
  showCelebrationOverlay("images/fig81.png");
}

function updateChallenge4StatusCell() {
  
updateChallengeInfoText()

  const cell = document.getElementById("challenge4StatusCell");
  if (!cell) return;

  cell.style.backgroundImage = "none";

  const isInactive = level < challenge4Level;
  const blocksOnField = field.flat().filter(cell => cell !== null).length;

  const container = document.createElement("div");
  container.style.display = "flex";
  container.style.flexDirection = "row";
  container.style.justifyContent = "space-between";
  container.style.alignItems = "center";
  container.style.height = "100%";
  container.style.width = "100%";

  // Linkerkant (afbeelding)
const left = document.createElement("div");
left.style.width = "70%";
left.style.display = "flex";
left.style.flexDirection = "row";
left.style.alignItems = "center";

// Tekst (links)
const leftText = document.createElement("div");
leftText.textContent = "Time to party â€“ hit 50+ blocks on the dance floor at least 10 times in the next 100 moves! Do it right and earn 3 multicolors!"; // â† dynamisch als je wil
leftText.style.width = "80%";
leftText.style.color = isInactive ? "#888" : "#FFE680";
leftText.style.fontWeight = "bold";

leftText.style.textAlign = "center";
leftText.style.padding = "4px";

leftText.style.fontSize = "0.75rem"; // kleiner dan 0.9rem
leftText.style.lineHeight = "1.1";   // compacter
leftText.style.overflowWrap = "break-word"; // tekst mag breken
leftText.style.wordBreak = "break-word";    // extra veiligheid
leftText.style.hyphens = "auto";            // eventueel afbreken op lettergrepen


// Afbeelding (rechts)
const img = document.createElement("img");
img.src = "images/fig82.png";
img.alt = "Challenge 4";
img.style.width = "20%";
img.style.maxHeight = "80px";
img.style.objectFit = "contain";
img.style.display = "block";
img.style.filter = isInactive ? "grayscale(100%)" : "none";

left.appendChild(leftText);
left.appendChild(img);


  // Rechterkant (tekst)
  const right = document.createElement("div");
  right.style.width = "30%";
  right.style.display = "flex";
  right.style.flexDirection = "column";
  right.style.justifyContent = "center";
  right.style.alignItems = "flex-start";
  right.style.fontSize = "0.85rem";
  right.style.paddingLeft = "5px";

  if (challenge4Success) {
    right.innerHTML = `<div>âœ… Go again for 1000 points?</div>`;
  } else if (challenge4RewardGiven) {
    right.innerHTML = `<div>âŒ Go again for 1000 points?</div>`;
  } else {
const textColor = isInactive ? "#888" : "#FFE680";
    right.innerHTML = `
      <div>â³ ${challenge4Count} / ${challenge4Limit}</div>
      <div>ğŸ“ˆ ${challenge4FullFieldMoments} / 10</div>
      <div>ğŸ§± ${blocksOnField}</div>
    `;
  }

  container.appendChild(left);
  container.appendChild(right);

  cell.innerHTML = "";
  cell.appendChild(container);
  cell.onclick = restartChallenge4;


if (isInactive) {
  cell.classList.add("inactive");
  cell.style.backgroundColor = "";     // grijs via CSS
  cell.style.borderColor = "";         // standaard CSS blijft
} else {
  cell.classList.remove("inactive");

  if (challenge4Success) {
    cell.style.backgroundColor = "rgba(0, 255, 0, 0.1)";   // lichtgroen
    cell.style.borderColor = "#00cc00";                    // donkergroen randje
  } else if (challenge4RewardGiven) {
    cell.style.backgroundColor = "rgba(255, 0, 0, 0.1)";   // lichtrood
    cell.style.borderColor = "#cc0000";                    // donkerrood randje
  } else if (challenge4Active) {
    cell.style.backgroundColor = "rgba(0, 170, 255, 0.1)"; // lichtblauw
    cell.style.borderColor = "#00aaff";                   // helderblauw randje
  } else {
    cell.style.backgroundColor = "";      // standaard
    cell.style.borderColor = "#e88a2d";   // standaard oranje rand
  }
}


}


function restartChallenge4() {
  if (level < challenge4Level) return;

if (isAnyChallengeActive()) {
  showCelebrationOverlay("images/fig78.png");
  return;
}

  if (score < 1000) {
    // Niet genoeg punten â†’ toon foutafbeelding
    showCelebrationOverlay("images/fig79.png");
    return;
  }

  // Genoeg punten â†’ trek 1000 af en herstart challenge
  score -= 1000;
  updateScoreDisplay();

  challenge4Active = true;
  challenge4RewardGiven = false;
  challenge4Success = false;
  challenge4Count = 0;
  challenge4FullFieldMoments = 0;
  passedChallenge4c = false;

  updateChallenge4StatusCell();
  showCelebrationOverlay("images/fig83.png");
}

function updateChallenge5StatusCell() {
    updateChallengeInfoText()
  const cell = document.getElementById("challenge5StatusCell");
  if (!cell) return;

  cell.style.backgroundImage = "none";
  const isInactive = level < challenge5StartLevel;

  const container = document.createElement("div");
  container.style.display = "flex";
  container.style.flexDirection = "row";
  container.style.justifyContent = "space-between";
  container.style.alignItems = "center";
  container.style.height = "100%";
  container.style.width = "100%";

  // Linkerzijde: afbeelding
const left = document.createElement("div");
left.style.width = "70%";
left.style.display = "flex";
left.style.flexDirection = "row";
left.style.alignItems = "center";

// Tekst (links)
const leftText = document.createElement("div");
leftText.textContent = "Survive the diva storm â€“ all blocks turn into long-countdown divas! More are coming, and they take their sweet time. Outlast them and score 3 multicolors!"; // â† dynamisch als je wil
leftText.style.width = "80%";
leftText.style.color = isInactive ? "#888" : "#FFE680";
leftText.style.fontWeight = "bold";

leftText.style.textAlign = "center";
leftText.style.padding = "4px";

leftText.style.fontSize = "0.75rem"; // kleiner dan 0.9rem
leftText.style.lineHeight = "1.1";   // compacter
leftText.style.overflowWrap = "break-word"; // tekst mag breken
leftText.style.wordBreak = "break-word";    // extra veiligheid
leftText.style.hyphens = "auto";            // eventueel afbreken op lettergrepen


// Afbeelding (rechts)
const img = document.createElement("img");
img.src = "images/fig87.png";
img.alt = "Challenge 5 afbeelding";
img.style.width = "20%";
img.style.maxHeight = "60px";
img.style.objectFit = "contain";
img.style.display = "block";
img.style.filter = isInactive ? "grayscale(100%)" : "none";

left.appendChild(leftText);
left.appendChild(img);


  // Rechterzijde: status-info
  const right = document.createElement("div");
  right.style.width = "30%";
  right.style.display = "flex";
  right.style.flexDirection = "column";
  right.style.justifyContent = "center";
  right.style.alignItems = "flex-start";
  right.style.fontSize = "0.9rem";
  right.style.paddingLeft = "5px";

  if (challenge5Success) {
    right.innerHTML = `<div>âœ… Go again for 1000 points?</div>`;
  } else if (challenge5RewardGiven) {
    right.innerHTML = `<div>âŒ Go again for 1000 points?</div>`;
  } else {
    const textColor = isInactive ? "#888" : "#FFE680";
    right.innerHTML = `<div style="color: ${textColor};">ğŸ§â€â™‚ï¸ <span id="challenge5Count">${challenge5BlockCounter}</span> / ${challenge5RequiredBlocks}</div>`;
  }

  container.appendChild(left);
  container.appendChild(right);

  cell.innerHTML = "";
  cell.appendChild(container);
  cell.onclick = restartChallenge5;


if (isInactive) {
  cell.classList.add("inactive");
  cell.style.backgroundColor = "";     // grijs via CSS
  cell.style.borderColor = "";         // standaard CSS blijft
} else {
  cell.classList.remove("inactive");

  if (challenge5Success) {
    cell.style.backgroundColor = "rgba(0, 255, 0, 0.1)";   // lichtgroen
    cell.style.borderColor = "#00cc00";                    // donkergroen randje
  } else if (challenge5RewardGiven) {
    cell.style.backgroundColor = "rgba(255, 0, 0, 0.1)";   // lichtrood
    cell.style.borderColor = "#cc0000";                    // donkerrood randje
  } else if (challenge5Active) {
    cell.style.backgroundColor = "rgba(0, 170, 255, 0.1)"; // lichtblauw
    cell.style.borderColor = "#00aaff";                   // helderblauw randje
  } else {
    cell.style.backgroundColor = "";      // standaard
    cell.style.borderColor = "#e88a2d";   // standaard oranje rand
  }
}


}

function restartChallenge5() {
  if (level < challenge5StartLevel) return;

if (isAnyChallengeActive()) {
  showCelebrationOverlay("images/fig78.png");
  return;
}

  if (score < 1000) {
    // Niet genoeg punten â†’ toon foutafbeelding
    showCelebrationOverlay("images/fig79.png");
    return;
  }

  // Genoeg punten â†’ trek 1000 af en herstart challenge
  score -= 1000;
  updateScoreDisplay();

  challenge5Active = true;
  challenge5Done = false;
  challenge5Success = false;
  challenge5BlockCounter = 0;
  passedChallenge5c = false;
  challenge5RewardGiven = false;

  // Toon startafbeelding
  showCelebrationOverlay("images/fig84.png");

  // Zet bestaande blokjes in diva's met countdown 29
  for (let r = 0; r < field.length; r++) {
    for (let c = 0; c < field[0].length; c++) {
      const block = field[r][c];
      if (block) {
        block.isDiva = true;
        block.divaCountdown = 29;
      }
    }
  }

  updateChallenge5StatusCell();
  updateChallengeStatusCell();
}


function updateChallenge6StatusCell() {
    updateChallengeInfoText()
  const cell = document.getElementById("challenge6StatusCell");
  if (!cell) return;

  cell.style.backgroundImage = "none";

  const isInactive = level < challenge6Level;

  // Hoofdcontainer horizontaal
  const container = document.createElement("div");
  container.style.display = "flex";
  container.style.flexDirection = "row";
  container.style.justifyContent = "space-between";
  container.style.alignItems = "center";
  container.style.height = "100%";
  container.style.width = "100%";
  container.style.gap = "10px";

  // Afbeelding links (70%)
 const left = document.createElement("div");
left.style.width = "70%";
left.style.display = "flex";
left.style.flexDirection = "row";
left.style.alignItems = "center";

// Tekst (links)
const leftText = document.createElement("div");
leftText.textContent = "Think bigger â€“ clear 10 groups of 6 matching blocks (5 wonâ€™t cut it)! Do it and snap up 3 free pictures!"; // â† dynamisch als je wil
leftText.style.width = "80%";
leftText.style.color = isInactive ? "#888" : "#FFE680";
leftText.style.fontWeight = "bold";

leftText.style.textAlign = "center";
leftText.style.padding = "4px";

leftText.style.fontSize = "0.75rem"; // kleiner dan 0.9rem
leftText.style.lineHeight = "1.1";   // compacter
leftText.style.overflowWrap = "break-word"; // tekst mag breken
leftText.style.wordBreak = "break-word";    // extra veiligheid
leftText.style.hyphens = "auto";            // eventueel afbreken op lettergrepen


// Afbeelding (rechts)
const img = document.createElement("img");
img.src = "images/fig88.png";
img.alt = "Challenge 6 afbeelding";
img.style.width = "20%";
img.style.maxHeight = "60px";
img.style.objectFit = "contain";
img.style.display = "block";
img.style.filter = isInactive ? "grayscale(100%)" : "none";

left.appendChild(leftText);
left.appendChild(img);


  // Info rechts (30%)
  const right = document.createElement("div");
  right.style.width = "30%";
  right.style.display = "flex";
  right.style.flexDirection = "column";
  right.style.justifyContent = "center";
  right.style.alignItems = "flex-start";
  right.style.fontSize = "0.9rem";
  right.style.paddingLeft = "5px";

  if (challenge6Success) {
    right.innerHTML = `<div>âœ… Go again for 1000 points?</div>`;
  } else if (challenge6RewardGiven) {
    right.innerHTML = `<div>âŒ Go again for 1000 points?</div>`;
  } else {
    const textColor = isInactive ? "#888" : "#FFE680";
    right.innerHTML = `
      <div style="color: ${textColor};">ğŸ¯ <span id="challenge6SixGroupCount">${challenge6SixGroupCount}</span> / 10</div>
      <div style="color: ${textColor};">â³ <span id="challenge6BlockCounter">${challenge6BlockCounter}</span> / 100</div>
    `;
  }

  container.appendChild(left);
  container.appendChild(right);

  cell.innerHTML = "";
  cell.appendChild(container);
  cell.onclick = restartChallenge6;

if (isInactive) {
  cell.classList.add("inactive");
  cell.style.backgroundColor = "";     // grijs via CSS
  cell.style.borderColor = "";         // standaard CSS blijft
} else {
  cell.classList.remove("inactive");

  if (challenge6Success) {
    cell.style.backgroundColor = "rgba(0, 255, 0, 0.1)";   // lichtgroen
    cell.style.borderColor = "#00cc00";                    // donkergroen randje
  } else if (challenge6RewardGiven) {
    cell.style.backgroundColor = "rgba(255, 0, 0, 0.1)";   // lichtrood
    cell.style.borderColor = "#cc0000";                    // donkerrood randje
  } else if (challenge6Active) {
    cell.style.backgroundColor = "rgba(0, 170, 255, 0.1)"; // lichtblauw
    cell.style.borderColor = "#00aaff";                   // helderblauw randje
  } else {
    cell.style.backgroundColor = "";      // standaard
    cell.style.borderColor = "#e88a2d";   // standaard oranje rand
  }
}

}

function updateChallenge7StatusCell() {
    updateChallengeInfoText()
  const cell = document.getElementById("challenge7StatusCell");
  if (!cell) return;

  cell.style.backgroundImage = "none";

  const isInactive = level < challenge7Level;

  // Hoofdcontainer (horizontaal)
  const container = document.createElement("div");
  container.style.display = "flex";
  container.style.flexDirection = "row";
  container.style.justifyContent = "space-between";
  container.style.alignItems = "center";
  container.style.height = "100%";
  container.style.gap = "10px";

  // Linkerkant: AFBEELDING (70%)
const left = document.createElement("div");
left.style.width = "70%";
left.style.display = "flex";
left.style.flexDirection = "row";
left.style.alignItems = "center";

// Tekst (links)
const leftText = document.createElement("div");
leftText.textContent = "Speed mode on â€“ 10 groups of 5 blocks must vanish within 100 drops! But beware: each block hits the dancefloor faster and faster..."; // â† dynamisch als je wil
leftText.style.width = "80%";
leftText.style.color = isInactive ? "#888" : "#FFE680";
leftText.style.fontWeight = "bold";

leftText.style.textAlign = "center";
leftText.style.padding = "4px";

leftText.style.fontSize = "0.75rem"; // kleiner dan 0.9rem
leftText.style.lineHeight = "1.1";   // compacter
leftText.style.overflowWrap = "break-word"; // tekst mag breken
leftText.style.wordBreak = "break-word";    // extra veiligheid
leftText.style.hyphens = "auto";            // eventueel afbreken op lettergrepen


// Afbeelding (rechts)
const img = document.createElement("img");
img.src = "images/fig85.png";
img.alt = "Challenge 7 afbeelding";
img.style.width = "20%";
img.style.maxHeight = "60px";
img.style.objectFit = "contain";
img.style.display = "block";
img.style.filter = isInactive ? "grayscale(100%)" : "none";

left.appendChild(leftText);
left.appendChild(img);


  // Rechterkant: INFO (30%)
  const right = document.createElement("div");
  right.style.width = "30%";
  right.style.display = "flex";
  right.style.flexDirection = "column";
  right.style.justifyContent = "center";
  right.style.alignItems = "flex-start"; // â† tekst links uitlijnen
  right.style.fontSize = "0.9rem";

  if (challenge7Success) {
    right.innerHTML = `<div>âœ… Go again for 1000 points?</div>`;
  } else if (challenge7RewardGiven) {
    right.innerHTML = `<div>âŒ Go again for 1000 points?</div>`;
  } else {
    const textColor = isInactive ? "#888" : "#FFE680";
    right.innerHTML = `
      <div style="color: ${textColor};">ğŸ¯ <span id="challenge7GroupCount">${challenge7GroupCount}</span> / ${challenge7TargetGroups}</div>
      <div style="color: ${textColor};">â³ <span id="challenge7BlockCount">${challenge7BlockCount}</span> / ${challenge7BlockLimit}</div>
      <div style="font-size: 0.8rem;">âš¡ ${Math.round(60000 / fallSpeed)} BPM</div>
    `;
  }

  container.appendChild(left);
  container.appendChild(right);

  cell.innerHTML = "";
  cell.appendChild(container);
  cell.onclick = restartChallenge7;



if (isInactive) {
  cell.classList.add("inactive");
  cell.style.backgroundColor = "";     // grijs via CSS
  cell.style.borderColor = "";         // standaard CSS blijft
} else {
  cell.classList.remove("inactive");

  if (challenge7Success) {
    cell.style.backgroundColor = "rgba(0, 255, 0, 0.1)";   // lichtgroen
    cell.style.borderColor = "#00cc00";                    // donkergroen randje
  } else if (challenge7RewardGiven) {
    cell.style.backgroundColor = "rgba(255, 0, 0, 0.1)";   // lichtrood
    cell.style.borderColor = "#cc0000";                    // donkerrood randje
  } else if (challenge7Active) {
    cell.style.backgroundColor = "rgba(0, 170, 255, 0.1)"; // lichtblauw
    cell.style.borderColor = "#00aaff";                   // helderblauw randje
  } else {
    cell.style.backgroundColor = "";      // standaard
    cell.style.borderColor = "#e88a2d";   // standaard oranje rand
  }
}


}



function updateChallenge2StatusCell() {


updateChallengeInfoText()

  const cell = document.getElementById("challenge2StatusCell");
  if (!cell) return;

  cell.style.backgroundImage = "none";

  const isInactive = level <= challenge2Level;

  const container = document.createElement("div");
  container.style.display = "flex";
  container.style.flexDirection = "row";
  container.style.justifyContent = "space-between";
  container.style.alignItems = "center";
  container.style.height = "100%";
  container.style.width = "100%";

  // Linkerzijde (afbeelding)
const left = document.createElement("div");
left.style.width = "70%";
left.style.display = "flex";
left.style.flexDirection = "row";
left.style.alignItems = "center";

// Linkerzijde: tekst
const leftText = document.createElement("div");
leftText.textContent = "Are you ready cause every third block will be a multicolor during the mission! Make 30 of them leave the dancefloor within 100 blocks. No multicolor, skip or free picture tricks allowed. Beat it and earn 3 extra lives!"; // â† dynamisch als je wil
leftText.style.width = "80%";
leftText.style.color = isInactive ? "#888" : "#FFE680";
leftText.style.fontWeight = "bold";

leftText.style.textAlign = "center";
leftText.style.padding = "4px";

leftText.style.fontSize = "0.75rem"; // kleiner dan 0.9rem
leftText.style.lineHeight = "1.1";   // compacter
leftText.style.overflowWrap = "break-word"; // tekst mag breken
leftText.style.wordBreak = "break-word";    // extra veiligheid
leftText.style.hyphens = "auto";            // eventueel afbreken op lettergrepen

// Rechterzijde: afbeelding
const img = document.createElement("img");
img.src = "images/fig89.png";
img.alt = "Challenge 2 afbeelding";
img.style.width = "20%";
img.style.maxHeight = "60px";
img.style.objectFit = "contain";
img.style.display = "block";
img.style.filter = isInactive ? "grayscale(100%)" : "none";

left.appendChild(leftText);
left.appendChild(img);


  // Rechterzijde (tekst)
  const right = document.createElement("div");
  right.style.width = "30%";
  right.style.display = "flex";
  right.style.flexDirection = "column";
  right.style.justifyContent = "center";
  right.style.alignItems = "flex-start";
  right.style.fontSize = "0.9rem";
  right.style.paddingLeft = "5px";

  if (challenge2Success) {
    right.innerHTML = `<div>âœ… Go again for 1000 points?</div>`;
  } else if (challenge2RewardGiven) {
    right.innerHTML = `<div>âŒ Go again for 1000 points?</div>`;
  } else {
    let multiText = `${challenge2MultiCount}`;
    const textColor = isInactive ? "#888" : "#FFE680";
    right.innerHTML = `
      <div style="color: ${textColor};">ğŸŒˆ <span id="challenge2MultiCount">${multiText}</span> / ${challenge2MultiTarget}</div>
      <div style="color: ${textColor};">â³ <span id="challenge2BlockCounter">${challenge2BlockCounter}</span> / ${challenge2BlockLimit}</div>
    `;
  }

  container.appendChild(left);
  container.appendChild(right);

  cell.innerHTML = "";
  cell.appendChild(container);
  cell.onclick = restartChallenge2;




if (isInactive) {
  cell.classList.add("inactive");
  cell.style.backgroundColor = "";     // grijs via CSS
  cell.style.borderColor = "";         // standaard CSS blijft
} else {
  cell.classList.remove("inactive");

  if (challenge2Success) {
    cell.style.backgroundColor = "rgba(0, 255, 0, 0.1)";   // lichtgroen
    cell.style.borderColor = "#00cc00";                    // donkergroen randje
  } else if (challenge2RewardGiven) {
    cell.style.backgroundColor = "rgba(255, 0, 0, 0.1)";   // lichtrood
    cell.style.borderColor = "#cc0000";                    // donkerrood randje
  } else if (challenge2Active) {
    cell.style.backgroundColor = "rgba(0, 170, 255, 0.1)"; // lichtblauw
    cell.style.borderColor = "#00aaff";                   // helderblauw randje
  } else {
    cell.style.backgroundColor = "";      // standaard
    cell.style.borderColor = "#e88a2d";   // standaard oranje rand
  }
}

}


// volgens mij nergens gebruikt - het is de restartchallenge die overal w gebruikt
function startChallenge5() {
  challenge5Active = true;
  challenge5Done = false;
  challenge5BlockCounter = 0;
  challenge5ImageShown = true;
  showChallengeImage('images/challenge5_start.png'); // vervang met juiste pad

  for (let row = 0; row < numRows; row++) {
    for (let col = 0; col < numCols; col++) {
      if (grid[row][col] !== null && !grid[row][col].isDiva) {
        grid[row][col] = {
          color: grid[row][col].color,
          isDiva: true,
          divaCountdown: 9,
          isFalling: false,
          landed: true,
          x: col,
          y: row,
        };
      }
    }
  }
}


function restartChallenge6() {
  if (level < challenge6Level) return;

if (isAnyChallengeActive()) {
  showCelebrationOverlay("images/fig78.png");
  return;
}

  if (score < 1000) {
    // Niet genoeg punten â†’ toon foutafbeelding
    showCelebrationOverlay("images/fig79.png");
    return;
  }

  // Genoeg punten â†’ trek 1000 af en herstart challenge
  score -= 1000;
  updateScoreDisplay();

  challenge6Active = true;
  challenge6BlockCounter = 0;
  challenge6SixGroupCount = 0;
  challenge6RewardGiven = false;
  challenge6Done = false;
  challenge6Success = false;
  passedChallenge6c = false;

// Toon startafbeelding
  showCelebrationOverlay("images/fig90.png");

  updateChallenge6StatusCell();
}


function restartChallenge7() {
  if (level < challenge7Level) return;

if (isAnyChallengeActive()) {
  showCelebrationOverlay("images/fig78.png");
  return;
}

  if (score < 1000) {
    // Niet genoeg punten â†’ toon foutafbeelding
    showCelebrationOverlay("images/fig79.png");
    return;
  }

  // Genoeg punten â†’ trek 1000 af en herstart challenge
  score -= 1000;
  updateScoreDisplay();

  challenge7Active = true;
  challenge7BlockCount = 0;
  challenge7GroupCount = 0;
  challenge7RewardGiven = false;
  challenge7Done = false;
  challenge7Success = false;
  passedChallenge7c = false;

  // Herstel snelheid naar waarde vÃ³Ã³r eerdere challenge 7
  fallSpeed = fallSpeedBeforeChallenge7;
  clearInterval(fallInterval);
  fallInterval = setInterval(gameLoop, fallSpeed);

  // Toon startafbeelding
  showCelebrationOverlay("images/fig91.png");

  updateChallenge7StatusCell();
}



function restartChallenge2() {
  if (level < challenge2Level) return;

if (isAnyChallengeActive()) {
  showCelebrationOverlay("images/fig78.png");
  return;
}

  if (score < 1000) {
    // Niet genoeg punten â†’ toon foutafbeelding
    showCelebrationOverlay("images/fig79.png");
    return;
  }

  // Genoeg punten â†’ trek af en herstart challenge
  score -= 1000;
  updateScoreDisplay();

  challenge2Active = true;
  challenge2RewardGiven = false;
  challenge2MultiCount = 0;
  challenge2BlockCounter = 0;
  challenge2PendingMulticolors = 0;
  passedChallenge2c = false;

  updateChallenge2StatusCell();
  showCelebrationOverlay("images/fig92.png");
}


document.addEventListener('DOMContentLoaded', () => {
  updateChallengeStatusCell();
  updateChallenge2StatusCell();
  updateChallenge3StatusCell();
  updateChallenge4StatusCell();
  updateChallenge5StatusCell();
  updateChallenge6StatusCell();
  updateChallenge7StatusCell();
  updateLevelDisplay();
  updateLevelAndBpmDisplay();

});


document.getElementById("shopButton").addEventListener("click", () => {
  pauseGame1();
  document.getElementById("shopModal").style.display = "block";
});

function closeShopModal() {
  document.getElementById("shopModal").style.display = "none";
  resumeGame();
}


function buySkipBlock() {
  const img = document.getElementById("skipBlockImage");

  if (score >= 25) {
    score -= 25;
    renewTokenCount++;
    updateScoreDisplay();
    updateRenewDisplay();

    if (img) img.src = "images/fig93.png";

    // Eventueel: closeShopModal(); als je de shop wil sluiten na aankoop
  } else {
    if (img) img.src = "images/fig79.png";
  }

}



function buyFreePicture() {
  const img = document.getElementById("freePictureImage");

    if (score >= 500) {
    score -= 500;
    freePictureCount++;
    updateFreePictureDisplay();
    updateScoreDisplay();

    if (img) img.src = "images/fig93.png";

    // Eventueel: closeShopModal(); als je de shop wil sluiten na aankoop
  } else {
    if (img) img.src = "images/fig79.png";
  }

}

function buyMulticolor() {
  const img = document.getElementById("multicolorImage");
    if (score >= 250) {
    score -= 250;
    multicolorCount++;
    updateMulticolorDisplay();
    updateScoreDisplay();

    if (img) img.src = "images/fig93.png";

    // Eventueel: closeShopModal(); als je de shop wil sluiten na aankoop
  } else {
    if (img) img.src = "images/fig79.png";
  }
}




</script>
<script>

// bewaren van de gegeven
function saveTestScore() {

if (level >= challengeLevel) passedChallenge1 = true;
if (level >= challenge2Level) passedChallenge2 = true;
if (level >= challenge3Level) passedChallenge3 = true;
if (level >= challenge4Level) passedChallenge4 = true;
if (level >= challenge5StartLevel) passedChallenge5 = true;
if (level >= challenge6Level) passedChallenge6 = true;
if (level >= challenge7Level) passedChallenge7 = true;

  try {
    localStorage.setItem("testScore", score);
    localStorage.setItem("testLives", lives);
    localStorage.setItem("testLevel", level);
    localStorage.setItem("testMulticolor", multicolorCount);
    localStorage.setItem("testSkip", renewTokenCount);
    localStorage.setItem("freePictureCount", freePictureCount);
    localStorage.setItem("savedField", JSON.stringify(field));
    localStorage.setItem("gridOffsetX", gridOffsetX);
    localStorage.setItem("gridOffsetY", gridOffsetY);
    localStorage.setItem("testRound", round);


    localStorage.setItem("challengeRewardGiven", challengeRewardGiven);
localStorage.setItem("challenge2RewardGiven", challenge2RewardGiven);
localStorage.setItem("challenge3RewardGiven", challenge3RewardGiven);
localStorage.setItem("challenge4RewardGiven", challenge4RewardGiven);
localStorage.setItem("challenge5RewardGiven", challenge5RewardGiven);
localStorage.setItem("challenge6RewardGiven", challenge6RewardGiven);
localStorage.setItem("challenge7RewardGiven", challenge7RewardGiven);



localStorage.setItem("challengeHeartCount", challengeHeartCount);
localStorage.setItem("challengeBlockCounter", challengeBlockCounter);

localStorage.setItem("challenge1Success", challenge1Success);
localStorage.setItem("challenge2Success", challenge2Success);
localStorage.setItem("challenge3Success", challenge3Success);
localStorage.setItem("challenge4Success", challenge4Success);
localStorage.setItem("challenge5Success", challenge5Success);
localStorage.setItem("challenge6Success", challenge6Success);
localStorage.setItem("challenge7Success", challenge7Success);

localStorage.setItem("testFallSpeedBeforeChallenge7", fallSpeedBeforeChallenge7.toString());

//localStorage.setItem("practiceChallenge3Wins31", practiceChallenge3Wins31);

    localStorage.setItem("passedChallenge1", passedChallenge1);
    localStorage.setItem("passedChallenge2", passedChallenge2);
    localStorage.setItem("passedChallenge3", passedChallenge3);
    localStorage.setItem("passedChallenge4", passedChallenge4);
    localStorage.setItem("passedChallenge5", passedChallenge5);
    localStorage.setItem("passedChallenge6", passedChallenge6);
    localStorage.setItem("passedChallenge7", passedChallenge7);

    console.log("Score opgeslagen:", score);
    console.log("Skipdinges opgeslagen:", renewTokenCount);
    
  } catch (e) {
    console.error("Fout bij opslaan score:", e);
  }
}

document.addEventListener("DOMContentLoaded", () => {
  const stored = localStorage.getItem("testScore");
  if (stored !== null) {
}
});

</script>
<script>

// keuze continue bij het beginscherm - met ophalen van bewaarde geg

function continueWithScore() {

  const stored = localStorage.getItem("testScore");
  if (stored !== null) {
    score = parseInt(stored);
    updateScoreDisplay();

    const storedLives = localStorage.getItem("testLives");
    if (storedLives !== null) {
      lives = parseInt(storedLives);
      updateLivesDisplay();
    }


    const storedLevel = localStorage.getItem("testLevel");
    if (storedLevel !== null) {
      level = parseInt(storedLevel);
      updateLevelDisplay();
    }

    const storedMulti = localStorage.getItem("testMulticolor");
    if (storedMulti !== null) {
      multicolorCount = parseInt(storedMulti);
      updateMulticolorDisplay();
    }
    
const storedRound = localStorage.getItem("testRound");
if (storedRound !== null) {
  round = parseInt(storedRound);
  updateFallSpeedDisplay()
//  updateRoundDisplay();
}

    //const storedSkip = 6;
    const storedSkip = localStorage.getItem("testSkip");
    
    if (storedSkip !== null) {
      renewTokenCount = parseInt(storedSkip);
      console.log("testSkip in localStorage2 =", renewTokenCount);
      updateSkipDisplay();
    }

const savedField = localStorage.getItem("savedField");
if (savedField !== null) {
  try {
    field = JSON.parse(savedField);
   // drawGrid(); // of jouw hertekenfunctie
  } catch (e) {
    console.error("Fout bij laden veld:", e);
  }
}

const storedOffsetX = localStorage.getItem("gridOffsetX");
if (storedOffsetX !== null) gridOffsetX = parseInt(storedOffsetX);
console.log("gridOffset =", gridOffsetX)

const storedOffsetY = localStorage.getItem("gridOffsetY");
if (storedOffsetY !== null) gridOffsetY = parseInt(storedOffsetY);


const storedPC1 = localStorage.getItem("passedChallenge1");
if (storedPC1 !== null) passedChallenge1 = storedPC1 === "true";
passedChallenge1c = passedChallenge1;

const storedPC2 = localStorage.getItem("passedChallenge2");
if (storedPC2 !== null) passedChallenge2 = storedPC2 === "true";
passedChallenge2c = passedChallenge2;

const storedPC3 = localStorage.getItem("passedChallenge3");
if (storedPC3 !== null) passedChallenge3 = storedPC3 === "true";
passedChallenge3c = passedChallenge3;

const storedPC4 = localStorage.getItem("passedChallenge4");
if (storedPC4 !== null) passedChallenge4 = storedPC4 === "true";
passedChallenge4c = passedChallenge4;

const storedPC5 = localStorage.getItem("passedChallenge5");
if (storedPC5 !== null) passedChallenge5 = storedPC5 === "true";
passedChallenge5c = passedChallenge5;

const storedPC6 = localStorage.getItem("passedChallenge6");
if (storedPC6 !== null) passedChallenge6 = storedPC6 === "true";
passedChallenge6c = passedChallenge6;

const storedPC7 = localStorage.getItem("passedChallenge7");
if (storedPC7 !== null) passedChallenge7 = storedPC7 === "true";
passedChallenge7c = passedChallenge7;

const storedC1Success = localStorage.getItem("challenge1Success");
if (storedC1Success !== null) challenge1Success = storedC1Success === "true";

const storedC2Success = localStorage.getItem("challenge2Success");
if (storedC2Success !== null) challenge2Success = storedC2Success === "true";

const storedC3Success = localStorage.getItem("challenge3Success");
if (storedC3Success !== null) challenge3Success = storedC3Success === "true";

const storedC4Success = localStorage.getItem("challenge4Success");
if (storedC4Success !== null) challenge4Success = storedC4Success === "true";

const storedC5Success = localStorage.getItem("challenge5Success");
if (storedC5Success !== null) challenge5Success = storedC5Success === "true";

const storedC6Success = localStorage.getItem("challenge6Success");
if (storedC6Success !== null) challenge6Success = storedC6Success === "true";

const storedC7Success = localStorage.getItem("challenge7Success");
if (storedC7Success !== null) challenge7Success = storedC7Success === "true";


const storedCRG = localStorage.getItem("challengeRewardGiven");
if (storedCRG !== null) challengeRewardGiven = storedCRG === "true";

const storedC2RG = localStorage.getItem("challenge2RewardGiven");
if (storedC2RG !== null) challenge2RewardGiven = storedC2RG === "true";

const storedC3RG = localStorage.getItem("challenge3RewardGiven");
if (storedC3RG !== null) challenge3RewardGiven = storedC3RG === "true";

const storedC4RG = localStorage.getItem("challenge4RewardGiven");
if (storedC4RG !== null) challenge4RewardGiven = storedC4RG === "true";

const storedC5RG = localStorage.getItem("challenge5RewardGiven");
if (storedC5RG !== null) challenge5RewardGiven = storedC5RG === "true";

const storedC6RG = localStorage.getItem("challenge6RewardGiven");
if (storedC6RG !== null) challenge6RewardGiven = storedC6RG === "true";

const storedC7RG = localStorage.getItem("challenge7RewardGiven");
if (storedC7RG !== null) challenge7RewardGiven = storedC7RG === "true";

const storedSpeedBeforeCh7 = localStorage.getItem("testFallSpeedBeforeChallenge7");
if (storedSpeedBeforeCh7 !== null) {
  fallSpeedBeforeChallenge7 = parseInt(storedSpeedBeforeCh7);
}

const storedFreePictureCount = localStorage.getItem("freePictureCount");
if (storedFreePictureCount !== null) {
  freePictureCount = parseInt(storedFreePictureCount);
updateFreePictureDisplay();
}


//const storedpracticeWinsch31 = localStorage.getItem("practiceChallenge3Wins31");
//if (storedpracticeWinsch31 !== null) {
//  practiceChallenge3Wins31 = parseInt(storedpracticeWinsch31);
//  updatePracticeCellTeller(); // als je dit visueel wil tonen
//}

//const storedCHC = localStorage.getItem("challengeHeartCount");
//if (storedCHC !== null) challengeHeartCount = parseInt(storedCHC);

//const storedCBC = localStorage.getItem("challengeBlockCounter");
//if (storedCBC !== null) challengeBlockCounter = parseInt(storedCBC);



// Algemene reset
challengeActive = false;
challengeLocked = false;

// Challenge 1
challenge1Done = false;
challengeHeartCount = 0;
challengeHeartOverrideCounter = 0;
preventHeartReward = false;
challengeBlockCounter = 0;
//challengeRewardGiven = false;

// Challenge 2
challenge2Active = false;
challenge2Done = false;
challenge2MultiCount = 0;
challenge2BlockCounter = 0;
//challenge2RewardGiven = false;
challenge2SuccessImageShown = false;
challenge2PendingMulticolors = 0;

// Challenge 3
challenge3Active = false;
challenge3Started = false;
challenge3Done = false;
challenge3Failed = false;
//challenge3Success = false;
challenge3Count = 0;

// Challenge 4
challenge4Active = false;
challenge4Done = false;
challenge4Count = 0;
challenge4FullFieldMoments = 0;
//challenge4Success = false;
//challenge4RewardGiven = false;

// Challenge 5
challenge5Active = false;
challenge5Done = false;
//challenge5Success = false;
challenge5BlockCounter = 0;
challenge5StartImageShown = false;
challenge5SuccessImageShown = false;
challenge5Started = false;

// Challenge 6
challenge6Active = false;
challenge6Done = false;
//challenge6Success = false;
challenge6BlockCounter = 0;
challenge6SixGroupCount = 0;
//challenge6RewardGiven = false;

// Challenge 7
challenge7Active = false;
challenge7Done = false;
//challenge7Success = false;
challenge7BlockCount = 0;
challenge7GroupCount = 0;
//challenge7RewardGiven = false;

saveBlockCountdown = 99;

updateChallengeStatusCell();
updateChallenge2StatusCell();
updateChallenge3StatusCell();
updateChallenge4StatusCell();
updateChallenge5StatusCell();
updateChallenge6StatusCell();
updateChallenge7StatusCell();
updateLevelDisplay();
updateLevelAndBpmDisplay();

drawGrid();

  }

  document.getElementById('startOverlay').style.display = 'none';
//  startGame(1);

  gamePaused = false;
//  multicolorCount = 3;
  updateMulticolorDisplay();
  pauseUsesLeft = 1000;
  updatePauseDisplay();

  fallSpeed = fallSpeedBeforeChallenge7;
clearInterval(fallInterval);
fallInterval = setInterval(gameLoop, fallSpeed);

}



document.addEventListener("DOMContentLoaded", () => {
  const stored = localStorage.getItem("testScore");
  const continueBtn = document.getElementById("continueButton");
  if (stored !== null && continueBtn) {
    continueBtn.disabled = false;
    continueBtn.style.opacity = "1";
  }
});


document.addEventListener("DOMContentLoaded", () => {

practiceChallenge1Wins11 = parseInt(localStorage.getItem("practiceChallenge1Wins11")) || 0;
practiceChallenge1Wins12 = parseInt(localStorage.getItem("practiceChallenge1Wins12")) || 0;
practiceChallenge1Wins13 = parseInt(localStorage.getItem("practiceChallenge1Wins13")) || 0;
practiceChallenge1Wins14 = parseInt(localStorage.getItem("practiceChallenge1Wins14")) || 0;
practiceChallenge1Wins15 = parseInt(localStorage.getItem("practiceChallenge1Wins15")) || 0;
practiceChallenge1Wins16 = parseInt(localStorage.getItem("practiceChallenge1Wins16")) || 0;
practiceChallenge1Wins17 = parseInt(localStorage.getItem("practiceChallenge1Wins17")) || 0;
practiceChallenge1Wins18 = parseInt(localStorage.getItem("practiceChallenge1Wins18")) || 0;
practiceChallenge1Wins19 = parseInt(localStorage.getItem("practiceChallenge1Wins19")) || 0;

practiceChallenge2Wins21 = parseInt(localStorage.getItem("practiceChallenge2Wins21")) || 0;
practiceChallenge2Wins22 = parseInt(localStorage.getItem("practiceChallenge2Wins22")) || 0;
practiceChallenge2Wins23 = parseInt(localStorage.getItem("practiceChallenge2Wins23")) || 0;
practiceChallenge2Wins24 = parseInt(localStorage.getItem("practiceChallenge2Wins24")) || 0;
practiceChallenge2Wins25 = parseInt(localStorage.getItem("practiceChallenge2Wins25")) || 0;
practiceChallenge2Wins26 = parseInt(localStorage.getItem("practiceChallenge2Wins26")) || 0;
practiceChallenge2Wins27 = parseInt(localStorage.getItem("practiceChallenge2Wins27")) || 0;
practiceChallenge2Wins28 = parseInt(localStorage.getItem("practiceChallenge2Wins28")) || 0;
practiceChallenge2Wins29 = parseInt(localStorage.getItem("practiceChallenge2Wins29")) || 0;


practiceChallenge3Wins31 = parseInt(localStorage.getItem("practiceChallenge3Wins31")) || 0;
practiceChallenge3Wins32 = parseInt(localStorage.getItem("practiceChallenge3Wins32")) || 0;
practiceChallenge3Wins33 = parseInt(localStorage.getItem("practiceChallenge3Wins33")) || 0;
practiceChallenge3Wins34 = parseInt(localStorage.getItem("practiceChallenge3Wins34")) || 0;
practiceChallenge3Wins35 = parseInt(localStorage.getItem("practiceChallenge3Wins35")) || 0;
practiceChallenge3Wins36 = parseInt(localStorage.getItem("practiceChallenge3Wins36")) || 0;
practiceChallenge3Wins37 = parseInt(localStorage.getItem("practiceChallenge3Wins37")) || 0;
practiceChallenge3Wins38 = parseInt(localStorage.getItem("practiceChallenge3Wins38")) || 0;
practiceChallenge3Wins39 = parseInt(localStorage.getItem("practiceChallenge3Wins39")) || 0;

// CHALLENGE 4
practiceChallenge4Wins41 = parseInt(localStorage.getItem("practiceChallenge4Wins41")) || 0;
practiceChallenge4Wins42 = parseInt(localStorage.getItem("practiceChallenge4Wins42")) || 0;
practiceChallenge4Wins43 = parseInt(localStorage.getItem("practiceChallenge4Wins43")) || 0;
practiceChallenge4Wins44 = parseInt(localStorage.getItem("practiceChallenge4Wins44")) || 0;
practiceChallenge4Wins45 = parseInt(localStorage.getItem("practiceChallenge4Wins45")) || 0;
practiceChallenge4Wins46 = parseInt(localStorage.getItem("practiceChallenge4Wins46")) || 0;
practiceChallenge4Wins47 = parseInt(localStorage.getItem("practiceChallenge4Wins47")) || 0;
practiceChallenge4Wins48 = parseInt(localStorage.getItem("practiceChallenge4Wins48")) || 0;
practiceChallenge4Wins49 = parseInt(localStorage.getItem("practiceChallenge4Wins49")) || 0;

// CHALLENGE 5
practiceChallenge5Wins51 = parseInt(localStorage.getItem("practiceChallenge5Wins51")) || 0;
practiceChallenge5Wins52 = parseInt(localStorage.getItem("practiceChallenge5Wins52")) || 0;
practiceChallenge5Wins53 = parseInt(localStorage.getItem("practiceChallenge5Wins53")) || 0;
practiceChallenge5Wins54 = parseInt(localStorage.getItem("practiceChallenge5Wins54")) || 0;
practiceChallenge5Wins55 = parseInt(localStorage.getItem("practiceChallenge5Wins55")) || 0;
practiceChallenge5Wins56 = parseInt(localStorage.getItem("practiceChallenge5Wins56")) || 0;
practiceChallenge5Wins57 = parseInt(localStorage.getItem("practiceChallenge5Wins57")) || 0;
practiceChallenge5Wins58 = parseInt(localStorage.getItem("practiceChallenge5Wins58")) || 0;
practiceChallenge5Wins59 = parseInt(localStorage.getItem("practiceChallenge5Wins59")) || 0;

// CHALLENGE 6
practiceChallenge6Wins61 = parseInt(localStorage.getItem("practiceChallenge6Wins61")) || 0;
practiceChallenge6Wins62 = parseInt(localStorage.getItem("practiceChallenge6Wins62")) || 0;
practiceChallenge6Wins63 = parseInt(localStorage.getItem("practiceChallenge6Wins63")) || 0;
practiceChallenge6Wins64 = parseInt(localStorage.getItem("practiceChallenge6Wins64")) || 0;
practiceChallenge6Wins65 = parseInt(localStorage.getItem("practiceChallenge6Wins65")) || 0;
practiceChallenge6Wins66 = parseInt(localStorage.getItem("practiceChallenge6Wins66")) || 0;
practiceChallenge6Wins67 = parseInt(localStorage.getItem("practiceChallenge6Wins67")) || 0;
practiceChallenge6Wins68 = parseInt(localStorage.getItem("practiceChallenge6Wins68")) || 0;
practiceChallenge6Wins69 = parseInt(localStorage.getItem("practiceChallenge6Wins69")) || 0;

// CHALLENGE 7
practiceChallenge7Wins71 = parseInt(localStorage.getItem("practiceChallenge7Wins71")) || 0;
practiceChallenge7Wins72 = parseInt(localStorage.getItem("practiceChallenge7Wins72")) || 0;
practiceChallenge7Wins73 = parseInt(localStorage.getItem("practiceChallenge7Wins73")) || 0;
practiceChallenge7Wins74 = parseInt(localStorage.getItem("practiceChallenge7Wins74")) || 0;
practiceChallenge7Wins75 = parseInt(localStorage.getItem("practiceChallenge7Wins75")) || 0;
practiceChallenge7Wins76 = parseInt(localStorage.getItem("practiceChallenge7Wins76")) || 0;
practiceChallenge7Wins77 = parseInt(localStorage.getItem("practiceChallenge7Wins77")) || 0;
practiceChallenge7Wins78 = parseInt(localStorage.getItem("practiceChallenge7Wins78")) || 0;
practiceChallenge7Wins79 = parseInt(localStorage.getItem("practiceChallenge7Wins79")) || 0;



  updatePracticeCellTeller(); // Ã©Ã©n keer aanroepen nadat alles geladen is
});


</script>
<script>

// was om testen te doen

const startTime = performance.now();

window.addEventListener("load", () => {
  const loadTime = (performance.now() - startTime) / 1000;
  console.log("Volledige laadtijd:", loadTime.toFixed(2), "seconden");

  // Activeer knoppen
  document.querySelectorAll(".main-button").forEach(btn => btn.disabled = false);

  // Verwijder debugtekst
  const loadingText = document.getElementById("loadingText");
  if (loadingText) loadingText.remove();
});

</script>
<script>

  const debug = document.createElement("div");
  debug.id = "debugStatus";
  debug.style.cssText = "position:fixed;top:4px;left:4px;color:yellow;font-size:14px;z-index:10000;";
  debug.textContent = "Laden van speldata...";
  document.body.appendChild(debug);

  window.addEventListener("load", () => {
    setTimeout(() => {
      debug.textContent = "Klaar!";
      document.querySelectorAll(".main-button").forEach(btn => btn.disabled = false);
      setTimeout(() => debug.remove(), 2000);
    }, 100); // simulatie-wachttijd
  });

</script>
<script>

// is niet meer nodig denk ik maar w blijkbaar wel nog uitgevoerd




</script>

<script>

// animatie van de knoppen bij de opstart

window.addEventListener("DOMContentLoaded", () => {
  const paren = [
    ["number1", "teachButton"],
    ["number2", "partyTogetherButton"],
    ["number3", "proPlannerButton"],
    ["oefenen"],
    ["continueButton"]
  ];

  paren.forEach((groep, i) => {
    groep.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        setTimeout(() => {
          el.style.animation = `fromTop 0.8s ease-out forwards`;
        }, i * 1000); // 1 seconde per groep
      }
    });
  });
});



</script>

<script>
let tutorialStep = 0;

document.addEventListener('DOMContentLoaded', function() {
    updateControls();
    document.getElementById("teachButton").disabled = false;
});

const tutorialImages = [
  "images/fig94.png",
"images/fig95.png",
"images/fig96.png",
"images/fig97.png",
"images/fig98.png",
"images/fig99.png",
"images/fig100.png",
    "images/fig101.png",
"images/fig102.png",
  "images/fig103.png",
  "images/fig104.png",
  "images/fig105.png"
];

//"https://iili.io/FeBAFDl.md.png",
//"https://iili.io/FeBArzl.md.png",

const tutorialOverlay = document.getElementById("tutorialOverlay");
const tutorialImage = document.getElementById("tutorialImage");
const tutorialNextButton = document.getElementById("tutorialNextButton");

function startTutorialFromIntro1() {
  document.getElementById('startOverlay').style.display = 'none';
  tutorialStep = 0;
  tutorialInProgress = true;   // <<< BELANGRIJK: Tutorial actief
  tutorialImage.src = tutorialImages[tutorialStep];
  tutorialOverlay.style.display = "flex";
}

tutorialNextButton.addEventListener("click", function() {
  if (!tutorialInProgress) return;   // <<< BELANGRIJK: Alleen doorklikken als in tutorial

  tutorialStep++;
  if (tutorialStep < tutorialImages.length) {
    tutorialImage.src = tutorialImages[tutorialStep];
  } else {
    tutorialOverlay.style.display = "none";
    document.getElementById('startOverlay').style.display = 'flex';
    tutorialInProgress = false;      // <<< BELANGRIJK: Tutorial beÃ«indigd
  }
});


</script>

<!-- GAME OVER OVERLAY -->
<div id="gameOverOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: rgba(0, 0, 0, 0.95); z-index: 99999; flex-direction: column; justify-content: center; align-items: center;">
  <img src="images/fig106.png" alt="Game Over" style="max-width: 90vw; max-height: 70vh; border-radius: 16px; box-shadow: 0 0 20px #000;"/>
  <button onclick="returnToMenu1()" style="margin-top: 20px; background: #e88a2d; color: #FFE680; border: none; padding: 1rem 2rem; border-radius: 12px; font-size: 1.1rem; font-family: 'Baloo Bhaina 2', sans-serif; font-weight: bold; box-shadow: 0 0 10px #e88a2d; cursor: pointer;">
    BACK TO MENU
  </button>
</div>


</body>
</html>


